<h1>Projeto Blog Pessoal - Componentes CardPostagem e ListaPostagens - L√≥gica</h1>



Com a **estiliza√ß√£o** dos Componentes **CardPostagem** e **ListaPostagens** conclu√≠da, vamos implementar a **l√≥gica de cada componente** e integrar o consumo do **Recurso Postagem** do **Backend**.

Os componentes ir√£o consumir o m√©todo **Listar Todas as Postagens** da **API do Blog Pessoal**, que tem como fun√ß√£o fornecer uma listagem completa de todos as postagens persistidas no **Banco de Dados**.

Al√©m de permitir a visualiza√ß√£o das informa√ß√µes, a aplica√ß√£o tamb√©m possibilitar√° a execu√ß√£o de a√ß√µes espec√≠ficas sobre as postagens, como **atualizar** ou **deletar** cada item listado.

<br />

<h2>üë£ Passo 01 - Cadastrar uma Nova Postagem</h2>



<br />

> [!CAUTION]
>
> Caso **voc√™ j√° tenha cadastrado alguns objetos da Classe Postagem no seu Backend Remoto (Render)**, ap√≥s finalizar o Deploy, este passo pode ser ignorado.

<br />

Nosso **primeiro passo** ser√° cadastrar **pelo menos uma nova postagem** no **Backend Remoto (Render)**. Dessa forma, quando o Componente **ListaPostagens** estiver totalmente implementado, poderemos **testar se a l√≥gica est√° funcionando corretamente**, garantindo que todas as pstagens persistidas no Banco de Dados sejam exibidas na lista.

<br />

> [!IMPORTANT]
>
> Ao realizar o Deploy da aplica√ß√£o no Render, **os dados persistidos no Banco de Dados local N√ÉO ser√£o enviados para o Banco de Dados Remoto (Render)**.

<br />

1. Abra o arquivo **Service.ts**, localizada na pasta **src/services**.
2. Copie a **URL** (<u>**apenas a URL**</u>), que foi inserida na propriedade **baseURL**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/CKLX7un.png" title="source: imgur.com" /></div>

<br />

> [!IMPORTANT]
>
> **Utilize a URL do seu Deploy no Render. A URL acima √© apenas um exemplo.**

<br />

3. **Acesse o Swagger do Deploy do seu Backend** utilizando o link copiado no passo anterior no seu navegador de internet.
4. Fa√ßa o login com usu√°rio padr√£o do Backend (**root@root.com.br**), para obter o token
5. **Adicione o token no Swagger**, para que todas as requisi√ß√µes autenticadas possam ser executadas corretamente.

<br />

> [!IMPORTANT]
>
> Caso voc√™ tenha alguma d√∫vida ou n√£o se lembre como autenticar (login) e adicionar o token no Swagger, consulte o conte√∫do **Deploy do Backend no Render**, que voc√™ utilizou no Bloco 02.

<br />

6. Na tela do Swagger, localize o Recurso **Postagem**:

<div align="center"><img src="https://i.imgur.com/EvNdQrE.png" title="source: imgur.com" /></div>

7. Clique na Requisi√ß√£o <img src="https://i.imgur.com/76ZmjYV.png" title="source: imgur.com" width="7%"/>**/postagens**:

<div align="center"><img src="https://i.imgur.com/yM4p1W5.png" title="source: imgur.com" /></div>

8. Clique no Bot√£o **Try it out** para desbloquear a Requisi√ß√£o:

<div align="center"><img src="https://i.imgur.com/6FtiLII.png" title="source: imgur.com" /></div>

9. Adicione uma nova postagem, no item **Request body**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8DgH44W.png" title="source: imgur.com" /></div>

<br />

> [!WARNING]
>
> Ao cadastrar uma postagem, os dados ser√£o enviados no formato **JSON**, incluindo as informa√ß√µes do **t√≠tulo**, **texto**, al√©m da associa√ß√£o obrigat√≥ria com um **tema** e um **usu√°rio** j√° existentes no sistema.
>
> **Exemplo de corpo da requisi√ß√£o**:
>
> ```json
> {
> 	"titulo": "T√≠tulo da Postagem 01",
> 	"texto": "Texto da Postagem 01",
> 	"tema": {
> 		"id": 1
> 	},
> 	"usuario": {
> 		"id": 1
> 	}
> }
> ```
>
> üîë **Importante:** os campos `tema.id` e `usuario.id` devem referenciar a objetos tema e usuario previamente cadastrados no backend.

<br />

10. Clique no bot√£o **Execute** para criar a nova postagem.

<br />

> [!TIP]
>
> **Caso voc√™ tenha alguma d√∫vida sobre como utilizar o Swagger, consulte os conte√∫dos do Bloco 02: Documenta√ß√£o da API e Deploy do Backend Render.**

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 02 - Implementar a L√≥gica do Componente CardPostagem</h2>



Vamos configurar o nosso Componente **CardPostagem** para receber os dados das postagens:

1. Abra o Componente **CardPostagem.tsx** localizado dentro da pasta **src/components/postagem/cardpostagem**.
2. A seguir veja a implementa√ß√£o completa do Componente **CardPostagem.tsx**:

```tsx
import { Link } from 'react-router-dom'
import type Postagem from '../../../models/Postagem'

interface CardPostagensProps {
    postagem: Postagem
}

function CardPostagem({ postagem }: CardPostagensProps) {
    return (
        <div className='border-slate-900 border 
            flex flex-col rounded overflow-hidden justify-between'>
                
            <div>
                <div className="flex w-full bg-indigo-400 py-2 px-4 items-center gap-4">
                    <img
                        src={postagem.usuario?.foto}
                        className='h-12 rounded-full'
                        alt={postagem.usuario?.nome} />
                    <h3 className='text-lg font-bold text-center uppercase'>
                        {postagem.usuario?.nome}
                    </h3>
                </div>
                <div className='p-4 '>
                    <h4 className='text-lg font-semibold uppercase'>{postagem.titulo}</h4>
                    <p>{postagem.texto}</p>
                    <p>Tema: {postagem.tema?.descricao}</p>
                    <p>Data: {new Intl.DateTimeFormat("pt-BR", {
                        dateStyle: 'full',
                        timeStyle: 'medium',
                    }).format(new Date(postagem.data))}</p>
                </div>
            </div>
            <div className="flex">
                <Link to='' 
                    className='w-full text-white bg-indigo-400 
                    hover:bg-indigo-800 flex items-center justify-center py-2'>
                    <button>Editar</button>
                </Link>
                <Link to='' 
                    className='text-white bg-red-400 
                    hover:bg-red-700 w-full flex items-center justify-center'>
                    <button>Deletar</button>
                </Link>
            </div>
        </div>
    )
}

export default CardPostagem
```

**Vamos analisar os trechos mais importantes do c√≥digo acima:**

<div align="center"><img src="https://i.imgur.com/shzexBR.png" title="source: imgur.com" /></div>

**Linha 02:** Importamos a interface Model **Postagem**, como um tipo (`type`).

**Linhas 04 a 06:** Criamos uma **interface** que define todas as **propriedades (Props)** que o Componente **CardPostagem** espera receber.

A interface √© composta por um **objeto da model `Postagem`**, chamado **postagem**.

> **Lembre-se:** a Interface Model **Postagem** possui os seguintes atributos:
>
> - **id** ‚Äì identifica unicamente cada postagem;
> - **titulo** ‚Äì cont√©m o t√≠tulo da postagem.
> - **texto** ‚Äì cont√©m o texto (conte√∫do) da postagem.
> - **data** ‚Äì cont√©m a data e hora que a postagem foi criada/atualizada.
> - **tema** ‚Äì cont√©m o objeto da Model Tema, que representa  o tema associado a postagem.
> - **tema** ‚Äì cont√©m o objeto da Model Usuario, que representa  o autor da postagem.

**Linha 08:** Adicionamos a **interface `CardPostagemProps`** como **Props** do Componente (argumentos do Componente), utilizando um recurso do JavaScript chamado **Atribui√ß√£o por Desestrutura√ß√£o**.

Dessa forma, podemos acessar as propriedades do objeto **postagem** (***prop***) de forma direta, sem precisar referenciar o objeto completo a cada uso.

**Linha 16:** Adicionamos o atributo din√¢mico **`foto`**, pertencente ao objeto **usuario** associado √† postagem. Para acess√°-lo, utilizamos o caminho completo `postagem.usuario?.foto`.

O uso do **operador de encadeamento opcional (`?.`)** garante que a leitura dessa propriedade seja **segura**: se o objeto `usuario` existir dentro de `postagem`, sua propriedade `foto` ser√° exibida; caso contr√°rio, o acesso ser√° ignorado sem gerar erro na aplica√ß√£o.

**Linhas 18 e 20:** Adicionamos o atributo din√¢mico **`nome`**, pertencente ao objeto **usuario** associado √† postagem. Para acess√°-lo, utilizamos o caminho completo `postagem.usuario?.nome`. Neste atributo, tamb√©m utilizamos o **operador de encadeamento opcional**.

**Linhas 24 e 25:** Adicionamos os atributos din√¢micos **`titulo`** e **`texto`** do objeto postagem. 

**Linha 26:** Adicionamos o atributo din√¢mico **`descricao`**, pertencente ao objeto **tema** associado √† postagem. Para acess√°-lo, utilizamos o caminho completo `postagem.tema?.descricao`. Neste atributo, tamb√©m utilizamos o **operador de encadeamento opcional**.

**Linhas 27 a 30:** Adicionamos o atributo din√¢mico **`data`** do objeto postagem.

Utilizamos o objeto nativo **`Intl.DateTimeFormat`** do JavaScript para **converter a data** persistida no banco de dados, originalmente no formato ingl√™s (**en-US**), para o padr√£o brasileiro (**pt-BR**).

> O objeto **Intl** √© composto pelos seguintes elementos:
>
> - **`new Intl.DateTimeFormat("pt-BR", {...})`**: cria um formatador de data e hora configurado para o **idioma portugu√™s do Brasil**.
>   - O par√¢metro `"pt-BR"` assegura que o formato siga o padr√£o brasileiro (exemplo: **quinta-feira, 22 de agosto de 2025**).
> - **Op√ß√µes do objeto `{}`**:
>  - `dateStyle: 'full'` ‚Üí exibe a **data completa**, incluindo dia da semana, dia, m√™s e ano (exemplo: `sexta-feira, 22 de agosto de 2025`).
>   - `timeStyle: 'medium'` ‚Üí exibe a **hora em n√≠vel m√©dio de detalhe**, incluindo horas, minutos e segundos (exemplo: `16:35:42`).
> 
> - **`.format(new Date(postagem.data))`**: formata a data recebida, retornando uma **string j√° convertida** de acordo com a localidade e as op√ß√µes definidas.

Os demais elementos do **Componente CardPostagem** seguem a mesma estrutura aplicada no **Componente CardTema**.

<br />

> [!TIP]
>
> Em caso de d√∫vidas, consulte o conte√∫do sobre a implementa√ß√£o da L√≥gica dos Componentes <a href="21.md" target="_blank">**CardTema** e **ListaTemas**</a>.

<br />

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Intl" target="_blank"><b>JavaScript - Objeto Intl</b></a></div>

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 03 - Implementando a L√≥gica no Componente ListaPostagens</h2>



Com a l√≥gica do Componente **CardPostagem** implementada, vamos implementar a l√≥gica do Componente **ListaPostagens**:

1. Abra o componente **ListaPostagens.tsx** localizado dentro da pasta **src/components/postagem/listapostagens**.
2. A seguir veja a implementa√ß√£o completa do Componente  **ListaPostagens.tsx**:

```tsx
import { useContext, useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";
import { SyncLoader } from "react-spinners";
import { AuthContext } from "../../../contexts/AuthContext";
import type Postagem from "../../../models/Postagem";
import { buscar } from "../../../services/Service";
import CardPostagem from "../cardpostagem/CardPostagem";

function ListaPostagens() {

    const navigate = useNavigate();

    const [isLoading, setIsLoading] = useState<boolean>(false)

    const [postagens, setPostagens] = useState<Postagem[]>([])

    const { usuario, handleLogout } = useContext(AuthContext)
    const token = usuario.token

    useEffect(() => {
        if (token === '') {
            alert('Voc√™ precisa estar logado!')
            navigate('/')
        }
    }, [token])

    useEffect(() => {
        buscarPostagens()    
    }, [postagens.length])

    async function buscarPostagens() {
        try {

            setIsLoading(true)

            await buscar('/postagens', setPostagens, {
                headers: { Authorization: token }
            })
        } catch (error: any) {
            if (error.toString().includes('401')) {
                handleLogout()
            }
        }finally {
            setIsLoading(false)
        }
    }

    return (
        <>

            {isLoading && (
                <div className="flex justify-center w-full my-8">
                    <SyncLoader
                        color="#312e81"
                        size={32}
                    />
                </div>
            )}

            <div className="flex justify-center w-full my-4">
                <div className="container flex flex-col">

                    {(!isLoading && postagens.length === 0) && (
                            <span className="text-3xl text-center my-8">
                                Nenhuma Postagem foi encontrada!
                            </span>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 
                                    lg:grid-cols-3 gap-8">
                            {
                                postagens.map((postagem) => (
                                    <CardPostagem key={postagem.id} postagem={postagem}/>
                                ))
                            }
                    </div>
                </div>
            </div>
        </>
    )
}
export default ListaPostagens;
```

A implementa√ß√£o da L√≥gica do Componente **ListaPostagens** √© muito semelhante ao Componente **ListaTemas**. 

<br />

> [!TIP]
>
> Em caso de d√∫vidas, consulte o conte√∫do sobre a implementa√ß√£o da L√≥gica dos Componentes <a href="21.md" target="_blank">**CardTema** e **ListaTemas**</a>.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 04 - Atualizar o Componente Home</h2>



O Componente **ListaPostagens**, al√©m de estar dispon√≠vel por meio da sua pr√≥pria rota, tamb√©m ser√° exibido dentro do Componente **Home**. Assim, logo ap√≥s o login, o usu√°rio ter√° acesso a todas as postagens do Blog Pessoal diretamente na p√°gina inicial. Neste passo, vamos incluir o Componente **ListaPostagens** dentro do Componente **Home**.

1. Abra o Componente **Home** localizado dentro da pasta **src/pages/home**
2. Importe o Componente **ListaPostagens** no inicio do componente **Home**
3. Adicione o trecho de c√≥digo abaixo:

```tsx
 <ListaPostagens />
```

4. No final do componente **Home**, antes do **fragment `</>`**

**Vamos analisar as altera√ß√µes realizadas no c√≥digo:**

<div align="center"><img src="https://i.imgur.com/Ys3gXtm.png" title="source: imgur.com" /></div>

**Linha 01:** Importamos o componente **ListaPostagens** para que ele possa ser utilizado dentro do componente **Home**.

**Linha 35:** Renderizamos o componente **ListaPostagens** dentro do componente **Home**, garantindo que a listagem das postagens seja exibida diretamente na p√°gina inicial.

As demais linhas do c√≥digo do componente **Home** permanecem inalteradas.

<br>

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 05 - Testar o Componente</h2>



1. Abra o Terminal do **Visual Studio Code**.
2. Execute o projeto atrav√©s do comando abaixo:

```bash
npm run dev
```

2. Pressione a combina√ß√£o de teclas **o + enter** do seu teclado para abrir o Projeto no Navegador.
3. Com o projeto aberto no seu Navegador, fa√ßa o login na aplica√ß√£o, informando o **Usu√°rio** e a **Senha**:

<div align="center"><img src="https://i.imgur.com/U1JrXfN.png" title="source: imgur.com" /></div>

5. Observe que o Componente **ListaPostagens** ser√° carregado na p√°gina principal (Componente Home):

<div align="center"><img src="https://i.imgur.com/QpM0aUg.png" title="source: imgur.com" /></div>

6. Na sequ√™ncia, clique na op√ß√£o **Postagens** do menu:

<div align="center"><img src="https://i.imgur.com/o2yIToh.png" title="source: imgur.com" /></div>

7. Observe que inicialmente o Componente **ListaPostagens** ser√° carregado, renderizando o loader:

<div align="center"><img src="https://i.imgur.com/F1FGMZz.png" title="source: imgur.com" /></div>

8. Assim que todas as postagens s√£o adicionadas no array, os Cards contendo os dados de cada postagem ser√£o renderizados dentro do Componente **ListaPostagens**.

<div align="center"><img src="https://i.imgur.com/pAWvY9J.png" title="source: imgur.com" /></div>

9. Caso voc√™ n√£o tenha cadastrado nenhuma postagem ou o seu Backend n√£o retorne nenhuma postagem, ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/qC63umP.png" title="source: imgur.com" /></div>

10. Clique na op√ß√£o **Sair**, para efetuar logout da aplica√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_v19/tree/19_Lista_Postagens_Logica" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
