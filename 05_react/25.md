<h1>Projeto Blog Pessoal - Componente Deletar Tema - Lógica</h1>



Com o componente **`DeletarTema`** criado, vamos agora implementar sua lógica, permitindo remover temas já cadastrados no backend.

O componente irá consumir o método **Deletar Tema** da API do Blog Pessoal, cuja função é **excluir um tema específico do banco de dados**, identificado pelo seu `id`.

<br />

> [!WARNING]
>
> **Atenção ao usar o método de exclusão de temas (HTTP DELETE)**
>
> A exclusão de um **Tema** é uma ação **irreversível** e pode afetar outras partes da aplicação, pois todas as **Postagens associadas** a ele também serão removidas.
>
> Por esse motivo, é essencial **informar o usuário claramente sobre as consequências** e solicitar uma **confirmação explícita** antes de concluir a exclusão.

<br />

<h2><img src="https://i.imgur.com/izFuHID.png" title="source: imgur.com" width="5%"/>Passo 01 - Atualizar a Service</h2>



Antes de implementar a lógica no componente, **devemos primeiro criar na Service a função** responsável por **Deletar um objeto de um Recurso**. 

Essa função será responsável por consumir o endpoint do backend e manipular os dados no Banco de dados, garantindo que o componente possa interagir corretamente com o Recurso Tema.

1. Abra o arquivo **Service.ts** localizado dentro da pasta **src/service**.
2. Abaixo da **Service Atualizar**, adicione as seguintes funções:

```ts
export const deletar = async (url: string, header: Object) => {
    await api.delete(url, header)
}
```

**Vamos analisar a nova função:**

<div align="center"><img src="https://i.imgur.com/ly5Fa4A.png" title="source: imgur.com" /></div>

**Linhas 33 a 25:** Criamos a função assíncrona **deletar**, que se será responsável por excluir dados do Banco de dados da aplicação, de qualquer recurso do backend.

**Linha 33:** A função **deletar** foi definida como uma Arrow Function, que receberá dois argumentos:

- **url:** É uma string que representa o endereço do endpoint da API, que receberá a Requisição HTTP DELETE. Essa URL será anexada à URL base definida anteriormente na instância do Axios (baseURL). Na Requisição DELETE, enviaremos o id do Objeto que será excluído através da URL.
- **header:** É um objeto que contém o Cabeçalho da Requisição HTTP(Header). Nós o utilizaremos para enviar o Token de Autenticação no Cabeçalho da Requisição HTTP.

**Linha 34:** A palavra reservada **await** é usada para esperar a conclusão da Requisição, ou seja, o término da função assíncrona **delete**. 

Note que utilizamos método **delete**, da Biblioteca Axios, para enviarmos a Requisição DELETE, para a **url** especificada no parâmetro url, através da instância do Axios, que possui o endereço do **backend**. Além da URL, enviaremos também o objeto **header**. 

<br />

> [!IMPORTANT]
>
> Na função **deletar**, **nenhum dado é enviado no corpo da requisição**, pois o objetivo é apenas **deletar um registro pelo id**. 
>
> O retorno da função inclui o **status da operação**, indicando se a requisição foi **bem-sucedida** ou **falhou**.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 02 - Implementar a Lógica do Componente Deletar Tema</h2>



Com a função **deletar** adicionada na Service, vamos implementar a Lógica do Componente **DeletarTema**:

1. Abra o componente **DeletarTema.tsx**, localizado dentro da pasta **src/components/temas/deletartema**.
1. Localize o trecho de código indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/uoYMm9F.png" title="source: imgur.com" /></div>

3. No local indicado na imagem acima, insira o código abaixo:

<div align="center"><img src="https://i.imgur.com/fifN8bS.png" title="source: imgur.com" /></div>

4. Não esqueça de fazer as respectivas importações dos componentes e bibliotecas.

**Vamos analisar as alterações realizadas no código:**

<br />

✅ **Importações**

<div align="center"><img src="https://i.imgur.com/rBQhLL5.png" title="source: imgur.com" /></div>

**Linhas 01 a 05:** Importamos todos os recursos necessários para o funcionamento do componente **DeletarTema**, incluindo hooks, contextos, serviços e estilos que serão utilizados.

<div align="center"><img src="https://i.imgur.com/zGyp8UY.png" title="source: imgur.com" /></div>

**Linha 09:** Criamos a constante **`navigate`**, definida como uma função do **hook `useNavigate()`**. Com ela, podemos **redirecionar o usuário para outras rotas** da aplicação de forma programática.

**Linha 11:** Criamos o estado **`tema`**, inicializado como um objeto vazio (`{}`), mas **tipado como `Tema`** por meio do operador **`as`** do TypeScript.

Esse estado é responsável por armazenar os dados do tema que será deletado.

**Linha 13:** Criamos o estado **`isLoading`**, do tipo booleano, utilizando o **hook `useState`**, com valor inicial `false`.

Esse estado controla a exibição do **loader** (componente `ClipLoader` da biblioteca **React Spinners**) durante as requisições ao backend:

- `true` → loader visível (aguardando resposta da API).
- `false` → loader oculto (requisição concluída).

**Linha 15:** Utilizamos o **hook `useContext`** para acessar diretamente o **AuthContext**. Por meio da desestruturação, extraímos:

- **`usuario`** → dados do usuário autenticado.
- **`handleLogout`** → função para encerrar a sessão e redirecionar o usuário para o login.

**Linha 16:** Definimos a constante **`token`**, que recebe o valor do **JWT** armazenado dentro de `usuario.token`.

**Linha 18:** Utilizamos o **hook `useParams`** para acessar o parâmetro **`id`** da rota **`/deletartema/:id`**.

- Esse parâmetro estará presente **sempre que o usuário clicar no botão "Deletar" de um CardTema**, permitindo que o componente carregue os dados do tema que será deletado.
- A desestruturação **`const { id }`** extrai o valor do parâmetro da URL.
- A tipagem genérica **`useParams<{ id: string }>()`** garante ao TypeScript que o parâmetro `id` será tratado como **string**.

<br />

✅ **Função Buscar Tema por id**

<div align="center"><img src="https://i.imgur.com/UfuMFrO.png" title="source: imgur.com" /></div>

**Linhas 20 a 32:** Criamos a função **`buscarPorId`**, que consome o endpoint **Consultar Tema por Id**. Essa função é responsável por carregar os dados de um tema específico que será deletado.

<div align="center"><img src="https://i.imgur.com/AwZmYi4.png" title="source: imgur.com" /></div>

<br />

✅ **Validação do Token**

**Linhas 35 a 40:** Criamos o primeiro **useEffect**, que monitora o valor do **token**.

- Se o token estiver vazio → o usuário não está autenticado → exibimos um alerta e redirecionamos para o login.

<br />

✅ **Carregamento do Tema no componente (busca por id)**

**Linhas 42 a 46:** Criamos o segundo **useEffect**, que executa **`buscarPorId(id)`** sempre que o valor de `id` mudar.

- Isso acontece quando o usuário clica no botão **Deletar** de qualquer tema → o `id` muda na URL → os dados do tema são buscados e carregados no componente.

<br />

✅ **Função Deletar Tema**

<div align="center"><img src="https://i.imgur.com/v8ynB0E.png" title="source: imgur.com" /></div>

**Linhas 47 a 69:** Cria a função assíncrona **deletarTema**, responsável por excluir um tema da aplicação a partir do **id**.

**Linha 48:** Alteramos o estado **`isLoading`** para **`true`**, indicando visualmente que o processo de cadastro ou atualização está em andamento.

**Linhas 50 a 65:** Estrutura **try/catch** para tratar possíveis erros na requisição de atualização.

**Linhas 51 a 58:** Dentro do bloco **`try`**, chamamos a função assíncrona **`deletar`**, da **Service**, passando os seguintes parâmetros:

- **URL do endpoint de exclusão do tema**, concatenada com o **id** recebido na rota;
- **`token`**, enviado no cabeçalho da requisição (**Authorization**) para autenticação.

Se a exclusão for bem-sucedida, exibimos um **alerta de confirmação**, informando que o tema foi deletado com sucesso.

**Linhas 59 a 65:** No **`catch`**, verificamos se o erro possui status **401 (Unauthorized)**, indicando que o token expirou.

- Se verdadeiro, o usuário é desconectado e redirecionado para a página de login usando **`handleLogout()`** do **AuthContext**.
- Caso contrário, exibimos um alerta informando que ocorreu outro tipo de erro.

**Linha 67:** Chamamos **`setIsLoading(false)`**, indicando que o processo de cadastro ou atualização foi concluído, independentemente do sucesso da operação.

**Linha 68:** Executamos a função **`retornar`**, que redireciona o usuário para a rota do **Componente Listar Temas**, finalizando o fluxo do componente.

<br />

✅ **Função Retornar**

<div align="center"><img src="https://i.imgur.com/8fPQTav.png" title="source: imgur.com" /></div>

**Linhas 73 a 75:** Criamos a função **`retornar`**, responsável por redirecionar o usuário de volta para a listagem de temas após concluir o cadastro ou edição.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 03 - Integração entre a Lógica do Componente DeletarTema e a Interface Gráfica</h2>



Agora que criamos a lógica do componente **DeletarTema**, vamos integrá-la a Interface Gráfica do Componente:

<br />

✅ **Importar o Loader**

Vamos importar o componente `Cliploader` da biblioteca **React Spinners**, como indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/6nCLpHH.png" title="source: imgur.com" /></div>

<br />

✅ **Adicionando os atributos do objeto `tema` no card**

1. Localize o trecho de código indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/m62c3xE.png" title="source: imgur.com" /></div>

2. Substitua a linha indicada na imagem acima, pelo trecho de código abaixo:

```tsx
<p className='p-8 text-3xl bg-slate-200 h-full'>{tema.descricao}</p>
```

3. O resultado, você confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/FJMHCno.png" title="source: imgur.com" /></div>

**Linha 86:**  Como o atributo **`descricao`** é dinâmico — cada renderização do componente **DeletarTema** receberá um valor diferente, de acordo com o **id** objeto tema recebido via rota —, adicionamos o atributo dentro da tag de parágrafo (`<p>`).

<br />

✅ **Botão Não - Adicionar função `retornar`**

No botão **Não**, adicionamos o **evento `onClick`** para acionar a função **`retornar`**:

<div align="center"><img src="https://i.imgur.com/DzhEIkb.png" title="source: imgur.com" /></div>

**Linha 90:** Configuramos o evento **`onClick`** para chamar a função **`retornar`**, que será executada sempre que o botão **“Não”** for clicado. Essa função cancela a exclusão do tema e redireciona a aplicação para a **Página de Listagem de Temas**.

<br />

✅ **Botão Sim - Adicionar função `deletarTema` e o Loader**

No botão **Cadastrar**, adicionamos o **loader**, controlado pelo estado **`isLoading`** e o evento **`onClick`**:

<div align="center"><img src="https://i.imgur.com/P57tawh.png" title="source: imgur.com" /></div>

**Linha 96:** Configuramos o evento **`onClick`** para chamar a função **`deletarTema`**, que será executada sempre que o botão **“Sim”** for clicado. O fluxo é o seguinte:

- O usuário clica no botão **“Sim”** → o evento **`onClick`** é disparado;
- A função **`deletarTema`** é chamada, enviando uma **requisição HTTP DELETE**;
- O backend processa a requisição e executa a exclusão do tema correspondente.

**Linhas 98 a 104:** Aplicamos uma **expressão ternária** para definir dinamicamente o conteúdo do botão:

- Se **`isLoading`** for `true` → exibimos o **loader `ClipLoader`** da biblioteca **React Spinners**;
- Se **`isLoading`** for `false` → exibimos o texto **“Sim”**.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 04 - Atualizar o Componente CardTema</h2>



Agora vamos atualizar o Componente **CardTema**, inserindo a rota de exclusão do tema no botão **Deletar**.

Assim, sempre que o usuário clicar no botão **Deletar**, ele será redirecionado para o Componente **DeletarTema**, que será carregado com os dados do tema selecionado, permitindo a sua exclusão.

1. Abra o Componente **CardTema**, localizado dentro da pasta **src/components/tema/cardtema**.
2. Localize o trecho de código onde o botão **Deletar** está envolvido pelo componente `Link`:

<div align="center"><img src="https://i.imgur.com/RBHhD5a.png" title="source: imgur.com" /></div>

3. Substitua o valor da propriedade `to` do componente `Link` pelo seguinte trecho de código:

```tsx
{`/deletartema/${tema.id}`} 
```

4. O resultado você confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/XFlBKp6.png" title="source: imgur.com" /></div>

**Linha 23:** Atualizamos a rota do componente `Link`, definindo-a como **/deletartema/${tema.id}**, para que cada botão **Deletar** direcione corretamente ao componente **DeletarTema** o tema correspondente.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 05 - Testar o Componente</h2>



1. Abra o Terminal do **Visual Studio Code**.
2. Execute o projeto através do comando abaixo:

```bash
npm run dev
```

3. Pressione a combinação de teclas **o + enter** do seu teclado para abrir o Projeto no Navegador.
4. Com o projeto aberto no seu Navegador, faça o login na aplicação, informando o **Usuário** e a **Senha**:

<div align="center"><img src="https://i.imgur.com/U1JrXfN.png" title="source: imgur.com" /></div>

5. Na sequência, clique na opção **Temas** do menu:

<div align="center"><img src="https://i.imgur.com/HSCuzGw.png" title="source: imgur.com" /></div>

6. Clique no botão **Deletar** do tema indicado:

<div align="center"><img src="https://i.imgur.com/ZqZsduq.png" title="source: imgur.com" /></div>

7. Na sequência, você será redirecionado para a Tela de Exclusão do tema. Note que os dados do tema serão exibidos, pois a lógica do componente já foi implementada:

<div align="center"><img src="https://i.imgur.com/ay3mvqM.png" title="source: imgur.com" /></div>

8. Clique no botão **Não**, para cancelar a exclusão. Na sequência você será redirecionado para Página contendo a Listagem de temas.
9. Clique no botão **Sim**, para deletar o tema.
10. Se a exclusão for bem sucedida, será exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/X8CiGHZ.png" title="source: imgur.com" /></div>

11. Na sequência, você será redirecionado para Página contendo a Listagem de temas. Note que o tema deletado não estará mais disponível na Listagem de temas.

<div align="center"><img src="https://i.imgur.com/oREozMq.png" title="source: imgur.com" /></div>

12. Clique na opção **Sair**, para efetuar logout da aplicação.

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_v19/tree/17_Deletar_Tema_Logica" target="_blank"><b>Código fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
