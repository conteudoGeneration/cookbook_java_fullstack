<h1>Projeto¬†Blog¬†Pessoal¬†- Contexto AuthContext</h1>



Com a estiliza√ß√£o do **Componente Login** conclu√≠da, vamos implementar sua l√≥gica para **autenticar o usu√°rio** usando o backend do Blog Pessoal.

O componente consumir√° o m√©todo **Autenticar Usu√°rio**, respons√°vel por **autorizar o acesso** do usu√°rio √† aplica√ß√£o.

Para isso, vamos criar o **`AuthContext`**, que gerenciar√° o contexto da aplica√ß√£o e **compartilhar√° os dados do usu√°rio autenticado** com todos os componentes.

<br />

<h2>üë£ Passo 01 - Criar a pasta Contexts</h2>



Antes de criarmos o Componente **AuthContext**, vamos criar a pasta **contexts**:

1. Na pasta **src**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta).
2. O nome da pasta ser√° **contexts**. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir.
3. Ao concluir, voc√™ dever√° ter a seguinte estrutura dentro da pasta **src**:

<div align="center"><img src="https://i.imgur.com/jE2axX7.png" title="source: imgur.com" /></div>

<br>

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 02 - Criar o Contexto AuthContext</h2>



Vamos criar o Contexto **AuthContext**, dentro da pasta **contexts**:

1. Na pasta **contexts**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New File** (Novo Arquivo).
2. O nome do arquivo ser√° **AuthContext.tsx**. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir.
3. Na sequ√™ncia, adicione o c√≥digo abaixo no Componente **AuthContext**:

<div align="center"><img src="https://i.imgur.com/0YCvGS9.png" title="source: imgur.com" /></div>

**Vamos analisar o nosso c√≥digo:**

<div align="center"><img src="https://i.imgur.com/Kn0hFP3.png" title="source: imgur.com" /></div>

<br />

‚úÖ **Importa√ß√µes**

**Linha 01:** Importamos os m√≥dulos e fun√ß√µes do React necess√°rios:

- **ReactNode**: tipagem que representa **qualquer elemento renderiz√°vel** no React, como `string`, `number`, `JSX.Element` ou `null`. √â √∫til para tipar a propriedade **`children`**.
- **createContext**: fun√ß√£o usada para **criar um novo Contexto**, permitindo compartilhar dados entre componentes sem precisar passar *props* manualmente em cada n√≠vel da √°rvore.
- **useState**: **hook de estado** do React, usado para armazenar e atualizar valores no componente.

**Linhas 03 e 04:** Importamos a **model `UsuarioLogin`** e a **service `Login`**, que ser√£o usadas para estruturar os dados do usu√°rio e realizar a autentica√ß√£o.

<br />

‚úÖ **Defini√ß√£o de Tipos**

**Linhas 05 a 10:** Criamos a interface **`AuthContextProps`**, que define os dados e fun√ß√µes que podem ser acessados em qualquer parte da aplica√ß√£o. Ela possui quatro propriedades principais:

- **usuario**: objeto do tipo **`UsuarioLogin`**, que armazena os dados do usu√°rio autenticado. Inicialmente pode estar vazio, mas ap√≥s o login conter√° informa√ß√µes como id, nome, e-mail, foto e token.
- **handleLogout()**: fun√ß√£o que realiza o **logout**, limpando os dados do estado e, se necess√°rio, removendo informa√ß√µes do *localStorage* ou *sessionStorage*.
- **handleLogin(usuario: UsuarioLogin): Promise<void>**: fun√ß√£o ass√≠ncrona que recebe as credenciais do usu√°rio, valida com o backend e atualiza o estado com os dados completos do usu√°rio. Retorna uma **Promise** para permitir que outras partes da aplica√ß√£o aguardem a conclus√£o.
- **isLoading**: estado booleano que indica se a aplica√ß√£o est√° processando alguma a√ß√£o (como autentica√ß√£o), permitindo exibir um **loader** ou indicador visual de carregamento.

<br />

> [!IMPORTANT]
>
> Em projetos TypeScript, definir interfaces como `AuthContextProps` ajuda a manter **consist√™ncia e previsibilidade** ao usar o contexto.

<br />

**Linhas 12 a 14:** Definimos a interface **`AuthProviderProps`**, que descreve as propriedades esperadas pelo **`AuthProvider`**. Ela possui apenas uma propriedade:

- **`children: ReactNode`** ‚Üí representa os componentes filhos que ser√£o encapsulados pelo `AuthProvider`, garantindo que todos tenham acesso ao contexto.

> **ReactNode** √© uma tipagem do React que representa **qualquer elemento que possa ser renderizado** dentro de um componente. 
>
> Isso inclui **JSX/TSX Elements**, **strings**, **n√∫meros**, **arrays de elementos**, **fragmentos** e at√© **null** ou **undefined**. 

Esse padr√£o √© essencial para que o **Context API** funcione corretamente: o `Provider` envolve a √°rvore de componentes e disponibiliza os estados e fun√ß√µes definidas no contexto.

<div align="center"><img src="https://i.imgur.com/0XP4r8H.png" title="source: imgur.com" /></div>

<br />

‚úÖ **Criar o Contexto**

**Linha 16:** Nesta linha, criamos e exportamos o **contexto da aplica√ß√£o** usando o **`createContext`** e aplicamos a tipagem da interface **`AuthContextProps`**. 

Isso define os dados e fun√ß√µes que podem ser acessados em qualquer parte da aplica√ß√£o. 

<br />

> [!IMPORTANT]
>
> Tipar o contexto com TypeScript garante que apenas os valores definidos na interface possam ser compartilhados, aumentando a seguran√ßa e previsibilidade do c√≥digo.

<br />

‚úÖ **Definir o Provedor**

**Linhas 18 a 61:** Criamos e exportamos o componente **`AuthProvider`**, respons√°vel por:

- **Gerenciar o contexto da aplica√ß√£o**, armazenando estados como informa√ß√µes de autentica√ß√£o;
- **Compartilhar estados e fun√ß√µes** com todos os componentes descendentes;
- **Implementar a l√≥gica das fun√ß√µes compartilhadas**, como login e logout;
- **Atualizar estados centralizadamente**, permitindo que qualquer componente consumindo o contexto reaja √†s mudan√ßas sem precisar passar props manualmente.

O `AuthProvider` recebe a propriedade **`children`** do tipo **`ReactNode`**, que representa todos os componentes que ter√£o acesso ao contexto. 

Esse padr√£o √© essencial: somente os componentes dentro do `AuthProvider` poder√£o acessar os valores do contexto.

**Linhas 20 a 27:** Criamos o estado **`usuario`** e sua fun√ß√£o de atualiza√ß√£o **`setUsuario`** usando o **hook `useState`**.

- O estado **`usuario`** armazena os dados do usu√°rio autenticado ap√≥s o login;
- Inicialmente, cont√©m valores vazios conforme a model **`UsuarioLogin`**, indicando que ainda n√£o h√° usu√°rio logado;
- A tipagem **`useState<UsuarioLogin>({...})`** garante que o estado siga a estrutura da interface, evitando atribui√ß√µes ou acessos incorretos a propriedades.

<br />

> [!TIP]
>
> **Boas pr√°ticas:**
>
> - Inicializar o estado de acordo com a interface previne erros de execu√ß√£o;
> - Tipar explicitamente o `useState` √© recomendado em autentica√ß√£o, pois o objeto `usuario` possui atributos cr√≠ticos como `id`, `usuario` e `token`, que precisam de valida√ß√£o est√°tica.

<br />

<div align="center"><img src="https://i.imgur.com/a8zcMon.png" title="source: imgur.com" /></div>

**Linha 29:** Criamos o estado **`isLoading`**, do tipo **boolean**, com valor inicial **`false`**, usando o hook **`useState`**.

Esse estado controla a exibi√ß√£o do **loader** (da biblioteca **React Spinners**) enquanto aguardamos a resposta do Backend no login do usu√°rio:

- Quando a requisi√ß√£o est√° em andamento, `isLoading = true` ‚Üí o loader aparece.
- Quando a requisi√ß√£o termina, `isLoading = false` ‚Üí o loader desaparece.

A fun√ß√£o **`setIsLoading`** serve para atualizar o valor desse estado.

<br />

‚úÖ **Fun√ß√£o Autenticar Usu√°rio (`handleLogin`)**

**Linhas 31 a 43:** Implementamos a fun√ß√£o **`handleLogin()`**, respons√°vel por autenticar o usu√°rio na aplica√ß√£o. Ela concentra toda a l√≥gica de login, incluindo o envio de credenciais, atualiza√ß√£o de estados e tratamento de erros.

**Fluxo da fun√ß√£o:**

- **Linha 31:** **`async function handleLogin(userLogin: UsuarioLogin)`**: Fun√ß√£o ass√≠ncrona que recebe o objeto **`userLogin`**, contendo e-mail e senha do usu√°rio.
- **Linha 32:** **`setIsLoading(true)`**: Ativa o estado de carregamento, mostrando um **loader** ou desabilitando bot√µes, indicando que a autentica√ß√£o est√° em andamento.
- **Linhas 34 a 39:** **`try { ... }`**: Estrutura para capturar e tratar erros sem quebrar a aplica√ß√£o.
  - **Linha 35:** **`await login('/usuarios/logar', userLogin, setUsuario)`**: Chama a **Service `login`**, que consome o endpoint `/usuarios/logar` no backend:
    - `usuarioLogin`: credenciais do usu√°rio;
    - `setUsuario`: atualiza o estado `usuario` no contexto com os dados retornados (id, nome, foto, token).
       A palavra-chave **`await`** garante que a autentica√ß√£o seja conclu√≠da antes de prosseguir.
  - **Linha 36:** **`alert("Usu√°rio logado com sucesso")`**: Confirma√ß√£o visual de login bem-sucedido.
- **Linhas 37 a 39:** **`catch (error) { ... }`**: Captura os erros e exibe uma mensagem de erro ao usu√°rio.
- **Linha 41:** **`setIsLoading(false)`**: Desativa o estado de carregamento ao final do processo, independentemente de sucesso ou falha.

<br />

> [!IMPORTANT]
>
> Esse fluxo garante que a autentica√ß√£o seja realizada de forma segura, com feedback visual ao usu√°rio e atualiza√ß√£o consistente do estado da aplica√ß√£o.

<br />

‚úÖ **Fun√ß√£o Logout do Usu√°rio (`handleLogout`)**

<div align="center"><img src="https://i.imgur.com/LtG0PXG.png" title="source: imgur.com" /></div>

**Linhas 45 a 54:** Criamos a fun√ß√£o **`handleLogout()`**, respons√°vel por **deslogar o usu√°rio** e reinicializar o estado `usuario` para seus valores padr√£o. 

Isso garante que **nenhum dado sens√≠vel permane√ßa acess√≠vel** ap√≥s o logout, exigindo novo login para continuar usando a aplica√ß√£o e refor√ßando a seguran√ßa.

**Fluxo da fun√ß√£o:**

- **Linha 45:** **`function handleLogout() { ... }`**: Fun√ß√£o s√≠ncrona que desconecta o usu√°rio.
- **Linhas 46 a 53:** **`setUsuario({ ... })`**: Atualiza o estado `usuario` com todos os campos da interface `UsuarioLogin` redefinidos, garantindo consist√™ncia e evitando erros em componentes dependentes do estado.

<br />

‚úÖ **Renderiza√ß√£o do Provedor `AuthProvider`**

**Linhas 56 a 60:** Renderizamos o **`AuthProvider`**, que envolve os **componentes filhos (`children`)** e fornece o **contexto configurado**.

- **Linha 57:** A propriedade **`value`** do **`AuthContext.Provider`** cont√©m todos os valores definidos na interface **`AuthContextProps`** (`usuario`, `handleLogin`, `handleLogout`, `isLoading`), permitindo que qualquer componente descendente acesse esses dados via **`useContext(AuthContext)`**.
- **Linha 58:** A propriedade **`children`** representa todos os componentes encapsulados dentro do Provider. Ao renderizar `{children}`, esses componentes t√™m acesso direto ao contexto, sem a necessidade de repassar props manualmente, garantindo que estados e fun√ß√µes compartilhadas estejam dispon√≠veis em toda a √°rvore de componentes envolvida.

<br />

> [!IMPORTANT]
>
> Esse √© o funcionamento b√°sico do **Provider** na Context API: ele **injeta os dados do contexto** na √°rvore de componentes, permitindo que os **consumidores** acessem esses dados sem precisar passar props manualmente (*prop drilling*).

<br />

> [!WARNING]
>
> üì¢ **Alerta Importante sobre Persist√™ncia de Sess√£o**
>
> Na implementa√ß√£o do Blog Pessoal, por quest√µes did√°ticas e de simplifica√ß√£o da implementa√ß√£o, ap√≥s o login, o usu√°rio √© mantido apenas em **estado vol√°til**, o que significa que, ao recarregar a p√°gina no navegador, a sess√£o √© perdida. 
>
> Para garantir uma experi√™ncia consistente e segura em produ√ß√£o, √© recomendado implementar a **persist√™ncia de dados no `localStorage` ou na `sessionStorage`**, permitindo que a sess√£o seja mantida mesmo ap√≥s atualiza√ß√£o do navegador. 
>
> Al√©m disso, √© indispens√°vel realizar a **remo√ß√£o segura dessas informa√ß√µes no processo de logout**, evitando que dados sens√≠veis permane√ßam armazenados indevidamente. 

<br />

<div align="left"><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/> <a href="https://react.dev/reference/react/createContext" target="_blank"><b>Documenta√ß√£o - Context API</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API" target="_blank"><b>Documenta√ß√£o - Web Storage API</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank"><b>Documenta√ß√£o - Local Storage</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage" target="_blank"><b>Documenta√ß√£o - Session Storage</b></a></div>

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 03 - Atualizar o Componente App</h2>



1. Abra o Componente **App**, localizado dentro da pasta **src**.
2. fa√ßa as altera√ß√µes indicadas na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/sGYazs5.png" title="source: imgur.com" /></div>

**Vamos analisar o nosso c√≥digo:**

**Linha 04:** Importamos o componente **`AuthProvider`**, respons√°vel por fornecer o contexto de autentica√ß√£o para toda a aplica√ß√£o.

**Linhas 12 a 24:** No componente raiz **`App`**, envolvemos todos os componentes dentro do **`AuthProvider`**.

- Isso garante que **todos os componentes descendentes** possam acessar os estados e fun√ß√µes do contexto, como `usuario`, `isLoading`, `handleLogin` e `handleLogout`.
- O `AuthProvider` atua como um **‚Äúcontainer global‚Äù** de autentica√ß√£o, permitindo o acesso aos dados sem precisar repass√°-los manualmente via *props* (*prop drilling*).

<br />

> [!TIP]
>
> **Boas pr√°ticas:**
>
> - Declare o `AuthProvider` no n√≠vel mais alto da aplica√ß√£o (geralmente em `App.tsx`) para que o contexto esteja dispon√≠vel em todas as rotas.
> - Outros contextos, como carrinho ou idioma, podem ser organizados em uma hierarquia de Providers ao redor do `App`, mantendo a estrutura clara e acess√≠vel para todos os componentes.

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_v19/tree/10_Contexts" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
