<h1>Projeto Blog Pessoal - P√°gina de Cadastro - L√≥gica</h1>



Vamos implementar a l√≥gica do Componente, que ser√° respons√°vel por consumir o Recurso Usuario do nosso Backend. O Componente Cadastro ir√° consumir o M√©todo **Cadastrar Usu√°rio** do Backend do Blog Pessoal, cuja a fun√ß√£o √© persistir os dados de um novo usu√°rio no Banco de dados. 

<br />

<h2>üë£ Passo 01 - Iniciar o Backend no Render</h2>



No Bloco 02, realizamos o Deploy do Backend no **Render**. Por se tratar de uma conta gratuita, se a API permanecer em torno de 15 minutos sem receber nenhuma Requisi√ß√£o HTTP, para economizar os recursos do servidor, o Render finaliza a aplica√ß√£o e reinicia apenas quando receber uma nova Requisi√ß√£o HTTP. 

Este processo √© um pouco demorado e acaba interferindo no processo de Desenvolvimento da nossa aplica√ß√£o. Neste passo veremos como manter o Render "acordado" por mais tempo, enviando Requisi√ß√µes HTTP automatizadas, atrav√©s do Insomnia:

1. Acesse o site do **[Render](https://render.com)**
2. Fa√ßa o login utilizando a sua conta criada no Render.
3. No **Dashboard do Render**, clique no Servi√ßo do Blog Pessoal:

<div align="center"><img src="https://i.imgur.com/w2Bh3Sx.png" title="source: imgur.com" /></div>

4. Na sequ√™ncia, clique no link do seu Deploy, para inicializar a sua API:

<div align="center"><img src="https://i.imgur.com/TlY7nP5.png" title="source: imgur.com" /></div>

5. Depois que a API carregar, abra o **Insomnia** e acesse a Collection **Blog Pessoal**.
6. Clique na pasta **Blog Pessoal - Render (c√≥pia das Requisi√ß√µes com o endere√ßo do Render)** e abra a Requisi√ß√£o **Autenticar Usu√°rio**, dentro da pasta **Usu√°rio**.
7. Fa√ßa o Login utilizando o usu√°rio padr√£o **root@root.com**:

<div align="center"><img src="https://i.imgur.com/KQJMson.png" title="source: imgur.com" /></div>

8. Copie o Token da Requisi√ß√£o **Autenticar Usu√°rio** e atualize o Token da Requisi√ß√£o **Listar todos os Usu√°rios** da pasta **Render**.
9. Teste a Requisi√ß√£o **Listar todos os Usu√°rios** e verifique se a Lista de usu√°rios foi exibida.

Na sequ√™ncia, vamos configurar o Insomnia para enviar esta Requisi√ß√£o automaticamente a cada 300 segundos (5 minutos):

1. Na Requisi√ß√£o **Listar todos os Usu√°rios**, observe que ao lado do bot√£o **Send**, tem uma seta, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/PfauCMU.png" title="source: imgur.com" /></div>

2. Clique nesta seta e selecione a op√ß√£o **Repeat on Interval**

<div align="center"><img src="https://i.imgur.com/zqB3MPz.png" title="source: imgur.com" /></div>

3. Na janela **Send on Interval**, indique o tempo de intervalo (**300 segundos**), como mostra a imagem abaixo e clique no bot√£o **Start** para come√ßar o envio autom√°tico.

<div align="center"><img src="https://i.imgur.com/fOHQxsv.png" title="source: imgur.com" /></div>

4. Durante **1 hora** (tempo de expira√ß√£o do Token), o Insomnia enviar√° a Requisi√ß√£o para o Deploy no Render a cada 5 minutos. Ap√≥s este per√≠odo, o Insomnia come√ßar√° a receber Respostas HTTP indicando que o token expirou e o envio autom√°tico ser√° finalizado. 
5. Para continuar o envio autom√°tico da Requisi√ß√£o depois que o Token expirar:
   - Refa√ßa o Login;
   - Atualize o Token da Requisi√ß√£o **Listar todos os Usu√°rios**; 
   - Configure novamente o envio autom√°tico, atrav√©s da op√ß√£o **Send on Interval** da Requisi√ß√£o **Listar todos os Usu√°rios**.

<br />

<h2>üë£ Passo 02 - Instalar a Biblioteca React Loader Spinner</h2>



Antes de atualizarmos o Componente **Cadastro**, precisamos instalar o pacote **React Loader Spinner**, respons√°vel por fornecer um componente de carregamento de conte√∫do (Loader), que ser√° utilizado para indicar ao usu√°rio que uma opera√ß√£o ass√≠ncrona ainda n√£o foi conclu√≠da e precisa aguardar que o processamento seja conclu√≠do.

> **Loader** √© um elemento visual utilizado em p√°ginas da web para fornecer feedback visual aos usu√°rios durante o processo de carregamento de uma p√°gina ou a espera pela resposta de uma Requisi√ß√£o HTTP, por exemplo. Essas anima√ß√µes ajudam a tornar a espera mais agrad√°vel e envolvente. Quando voc√™ acessa um site e v√™ um √≠cone girat√≥rio ou uma barra de progresso enquanto o conte√∫do est√° sendo carregado, s√£o bons exemplos de um CSS Loader.
>
> **Exemplos de CSS Loaders - Sp√≠nners:**
>
> | <img src="https://i.imgur.com/Q9SSgha.gif" title="source: imgur.com" /> | <img src="https://i.imgur.com/ACNBnkx.gif" title="source: imgur.com" /> | <img src="https://i.imgur.com/cWKUASE.gif" title="source: imgur.com" /> |
> | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
>
> 

1. Para instalar a Biblioteca **React Loader Spinners**, abra o Terminal do Visual Studio Code
2. Digite o comando abaixo:

```bash
yarn add react-loader-spinner
```

<br />

> [!IMPORTANT]
>
> **A vers√£o atual Biblioteca React Loader Spinner pode ser diferente da vers√£o instalada, quando este material foi escrito.**

<br />

<div align="left"><img src="https://i.imgur.com/yVXGtb2.png" title="source: imgur.com" width="4%"/> <a href="https://mhnpd.github.io/react-loader-spinner/docs/intro" target="_blank"><b>React Loader Spinners - Documenta√ß√£o Oficial</b></a></div>

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 03 - Implementar a L√≥gica do Componente Cadastro</h2>



1. Abra o componente **Cadastro.tsx** localizado dentro da pasta **src/pages/cadastro**.
2. Substitua o C√≥digo do Componente **Cadastro** pelo c√≥digo abaixo:

```tsx
import { useState, useEffect, ChangeEvent, FormEvent } from 'react'
import { useNavigate } from 'react-router-dom'
import Usuario from '../../models/Usuario'
import { cadastrarUsuario } from '../../services/Service'
import './Cadastro.css'
import { RotatingLines } from 'react-loader-spinner'

function Cadastro() {

  const navigate = useNavigate()
  
  const [isLoading, setIsLoading] = useState<boolean>(false)

  const[confirmaSenha, setConfirmaSenha] = useState<string>("")

  const [usuario, setUsuario] = useState<Usuario>({
    id: 0,
    nome: '',
    usuario: '',
    senha: '',
    foto: ''
  })
  
  useEffect(() => {
    if (usuario.id !== 0){
      retornar()
    }
  }, [usuario])

  function retornar(){
    navigate('/login')
  }

  function atualizarEstado(e: ChangeEvent<HTMLInputElement>){
    setUsuario({
      ...usuario,
      [e.target.name]: e.target.value
    })

  }

  function handleConfirmarSenha(e: ChangeEvent<HTMLInputElement>){
    setConfirmaSenha(e.target.value)
  }

  async function cadastrarNovoUsuario(e: FormEvent<HTMLFormElement>){
    e.preventDefault()

    if(confirmaSenha === usuario.senha && usuario.senha.length >= 8){

      setIsLoading(true)

      try{
        await cadastrarUsuario(`/usuarios/cadastrar`, usuario, setUsuario)
        alert('Usu√°rio cadastrado com sucesso!')
      }catch(error){
        alert('Erro ao cadastrar o usu√°rio!')
      }
    }else{
      alert('Dados do usu√°rio inconsistentes! Verifique as informa√ß√µes do cadastro.')
      setUsuario({...usuario, senha: ''})
      setConfirmaSenha('')
    }

    setIsLoading(false)
  }
  
  return (
    <>
      <div className="grid grid-cols-1 lg:grid-cols-2 h-screen 
            place-items-center font-bold">
        <div className="fundoCadastro hidden lg:block"></div>
        <form className='flex justify-center items-center flex-col w-2/3 gap-3' 
          onSubmit={cadastrarNovoUsuario}>
          <h2 className='text-slate-900 text-5xl'>Cadastrar</h2>
          <div className="flex flex-col w-full">
            <label htmlFor="nome">Nome</label>
            <input
              type="text"
              id="nome"
              name="nome"
              placeholder="Nome"
              className="border-2 border-slate-700 rounded p-2"
             value = {usuario.nome}
             onChange={(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)}
            />
          </div>
          <div className="flex flex-col w-full">
            <label htmlFor="usuario">Usuario</label>
            <input
              type="text"
              id="usuario"
              name="usuario"
              placeholder="Usuario"
              className="border-2 border-slate-700 rounded p-2"
              value = {usuario.usuario}
             onChange={(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)}
            />
          </div>
          <div className="flex flex-col w-full">
            <label htmlFor="foto">Foto</label>
            <input
              type="text"
              id="foto"
              name="foto"
              placeholder="Foto"
              className="border-2 border-slate-700 rounded p-2"
              value = {usuario.foto}
             onChange={(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)}
            />
          </div>
          <div className="flex flex-col w-full">
            <label htmlFor="senha">Senha</label>
            <input
              type="password"
              id="senha"
              name="senha"
              placeholder="Senha"
              className="border-2 border-slate-700 rounded p-2"
              value = {usuario.senha}
             onChange={(e: ChangeEvent<HTMLInputElement>) => atualizarEstado(e)}
            />
          </div>
          <div className="flex flex-col w-full">
            <label htmlFor="confirmarSenha">Confirmar Senha</label>
            <input
              type="password"
              id="confirmarSenha"
              name="confirmarSenha"
              placeholder="Confirmar Senha"
              className="border-2 border-slate-700 rounded p-2"
              value={confirmaSenha}
              onChange={(e: ChangeEvent<HTMLInputElement>) => handleConfirmarSenha(e)}
            />
          </div>
          <div className="flex justify-around w-full gap-8">
            <button className='rounded text-white bg-red-400 
                  hover:bg-red-700 w-1/2 py-2' onClick={retornar}>
              Cancelar
            </button>
            <button 
                type='submit'
                className='rounded text-white bg-indigo-400 
                           hover:bg-indigo-900 w-1/2 py-2
                           flex justify-center' 
                >
                  {isLoading ? <RotatingLines
                    strokeColor="white"
                    strokeWidth="5"
                    animationDuration="0.75"
                    width="24"
                    visible={true}
                  /> :
                    <span>Cadastrar</span>
                  }
              
            </button>
          </div>
        </form>
      </div>
    </>
  )
}

export default Cadastro

```

**Vamos analisar as altera√ß√µes realizadas no c√≥digo:**

<div align="center"><img src="https://i.imgur.com/I86NeY8.png" title="source: imgur.com" /></div>

**Linhas 01 a 07:** Importamos os Componentes, Interfaces e Fun√ß√µes necess√°rias para a constru√ß√£o do Componente Cadastro.

<div align="center"><img src="https://i.imgur.com/hUBc5h4.png" title="source: imgur.com" /></div>

**Linha 11:** Cria a constante chamada **navigate**, que ser√° definida como uma fun√ß√£o, que receber√° o **hook useNavigate()**. Atrav√©s da fun√ß√£o **navigate, o usu√°rio ser√° redirecionado para outras rotas da aplica√ß√£o, conforme a necessidade.**

<br />

> [!TIP]
>
> **Caso voc√™ tenha alguma d√∫vida em rela√ß√£o ao Hook useNavigate(), consulte o conte√∫do sobre Rotas, clicando <a href="09.md">aqui</a>.**

<br />

**Linha 13:** Criamos um Estado chamado **isLoading**, do tipo **boolean**, atrav√©s do Hook **UseState**, com o valor inicial **false**. Este Estado ser√° utilizado para controlar se a Requisi√ß√£o enviada para o endpoint **Cadastrar Usu√°rio** retornou alguma Resposta do Backend. Desta forma, o React saber√° quando exibir o Loader, gerado pela Biblioteca **React Loader Spinners** dentro bot√£o Cadastrar do Formul√°rio. 

- Enquanto a Requisi√ß√£o n√£o receber uma Resposta, o Estado permanecer√° com o valor **true**, ou seja, exibir√° o Loader. 

- Quando a Requisi√ß√£o receber uma Resposta, a vari√°vel receber√° o valor **false**, ou seja, finaliza a anima√ß√£o CSS Loader.

Para modificar o valor do Estado **isLoading** (true/false), foi criada a fun√ß√£o **setIsLoading**, respons√°vel por atualizar o valor do Estado **isLoading**, seguindo a sintaxe b√°sica do **Hook useState**.

<br />

> [!TIP]
>
> **Caso voc√™ tenha alguma d√∫vida em rela√ß√£o ao Hook useState, consulte o conte√∫do sobre Hooks, clicando <a href="05.md">aqui</a>.**

<br />

**Linha 15:** Criamos um Estado chamado **confirmaSenha**, do tipo **string**, atrav√©s do Hook **UseState**, com o valor inicial **vazio**. Este Estado ser√° utilizado para armazenar e controlar o valor do input **confirmarSenha** do formul√°rio. 

Este Estado ser√° utilizado para fazer uma compara√ß√£o entre os valores do inputs **senha** e **confirmarSenha** do formul√°rio. 

- Caso os valores de ambos os campos sejam iguais, a Requisi√ß√£o de Cadastro do Usu√°rio ser√° enviada para o Backend. 
- Caso contr√°rio, ser√° exibida uma mensagem pedindo para o Usu√°rio digitar a senha e a confirma√ß√£o da senha novamente. Neste caso, a Requisi√ß√£o de Cadastro do Usu√°rio n√£o ser√° enviada para o Backend.

Para modificar o valor do Estado **confirmaSenha**, foi criada a fun√ß√£o **setConfirmaSenha**, respons√°vel por atualizar o valor do Estado **confirmaSenha**, seguindo a sintaxe b√°sica do **Hook useState**.

**Linhas 17 a 23:** Criamos um Estado chamado **usuario**, do tipo **Usuario** (Interface Model), atrav√©s do Hook **UseState**, com todos os atributos da Interface Usuario,  inicializados com o valor **vazio ou zero**, de acordo com as respectivas tipagens de cada atributo. Para modificar o valor do Estado, foi criada a fun√ß√£o **setUsuario**, seguindo a sintaxe b√°sica do **Hook useState**.

O **objetivo do Estado usuario √© armazenar as informa√ß√µes do usu√°rio que ser√° cadastrado na aplica√ß√£o**, ou seja, **aqui ser√£o guardados todos os dados digitados pelo usu√°rio nos campos do formul√°rio**. 

<div align="center"><img src="https://i.imgur.com/TTr2V22.png" title="source: imgur.com" /></div>

**Linhas 25 a 29:** Adicionamos o **Hook useEffect**, que **ser√° executado sempre que houver uma mudan√ßa no  Estado usuario**. 

Todas as vezes que ocorrer uma mudan√ßa no Estado usuario, **o La√ßo Condicional verificar√° se o ID do usuario continua com o seu valor inicial (zero). **

- Se o ID for diferente de zero, significa que o usu√°rio foi cadastrado com sucesso e o Banco de dados retornou um ID (Chave Prim√°ria). 
- Se o ID permanecer com o valor zero, significa que o usu√°rio n√£o foi cadastrado com sucesso. 

Uma vez que o usu√°rio foi cadastrado com sucesso, vamos redirecionar o usu√°rio para a p√°gina de login, para que ele possa logar na aplica√ß√£o, atrav√©s da fun√ß√£o **retornar()**.

> [!TIP]
>
> **Caso voc√™ tenha alguma d√∫vida em rela√ß√£o ao Hook useEffect, consulte o conte√∫do sobre Hooks, clicando <a href="05.md">aqui</a>.**

**Linhas 31 a 33:** Cria a fun√ß√£o **retornar()**, que ser√° respons√°vel por redirecionar o usu√°rio para o Componente Login, ap√≥s o cadastro do usu√°rio ser bem sucedido. Para efetuar o redirecionamento, ser√° utilizada a fun√ß√£o **navigate()**, que receber√° como par√¢metro a rota **/login**.

O bot√£o **Cancelar** do formul√°rio de cadastro, tamb√©m utilizar√° esta mesma fun√ß√£o, para redirecionar o usu√°rio para o Componente Login, caso ele desista de efetuar o Cadastro.

**Linhas 35 a 41:** Cria a fun√ß√£o `atualizarEstado(e: ChangeEvent<HTMLInputElement>)`, que ser√° utilizada para atualizar dinamicamente o Estado **usuario**, de acordo com os valores inseridos nos inputs do formul√°rio. 

Quando um elemento input tem o seu valor modificado, ou seja, o usu√°rio digitar alguma coisa no input, esta fun√ß√£o criar√° um novo objeto **usuario**, mantendo todos os valores armazenados anteriormente, atrav√©s do Operador Spread. Al√©m disso, o atributo associado ao input que teve o seu valor modificado, ser√° atualizado com o novo valor digitado pelo usu√°rio.

Como as propriedades name de todos os inputs, possuem os mesmos nomes dos atributos definidos no Estado usuario (Model Usuario), o valor do input que foi modificado, ser√° atribu√≠do ao respectivo atributo do Estado **usuario**.

**Linha 35:** Criamos a assinatura da fun√ß√£o **atualizarEstado()**, definindo um argumento, denominado **e** (Evento), do tipo `ChangeEvent<HTMLInputElement>`. Isso significa que a fun√ß√£o **atualizarEstado()** ter√° a responsabilidade de lidar com os eventos de mudan√ßa nos valores dos elementos **input** (evento onChange). Em outras palavras, todas as vezes que um input tiver seu conte√∫do alterado, a fun√ß√£o **atualizarEstado()** ser√° executada, atualizando o Estado **usuario** com os novos valores recebidos. 

A fun√ß√£o **atualizarEstado()** ser√° associada ao evento **onChange** de todos os inputs do formul√°rio.

> O **HTMLInputElement** √© um componente interno do React, que permite renderizar diferentes tipos de inputs em um formul√°rio HTML. Al√©m disso, voc√™ pode transformar um input em um input controlado, especificando  valores para as suas propriedades (id, name, value, por exemplo) e um manipulador de eventos, como o **onChange**, por exemplo, que monitora todas as mudan√ßas no valor do elemento input. 
>
> O **ChangeEvent()** do React √© um tipo gen√©rico, que representa um evento de mudan√ßa em um elemento do DOM. Ele √© frequentemente usado para lidar com eventos de entrada. O **ChangeEvent** √© usado para detectar quando o valor de um elemento de entrada muda. Por exemplo, quando o usu√°rio digita algo em um campo de texto ou seleciona uma op√ß√£o em um select, o evento de mudan√ßa √© acionado.
>
> O **ChangeEvent** √© uma ferramenta poderosa para lidar com intera√ß√µes do usu√°rio em seus aplicativos React. Use-o para atualizar o Estado, validar entradas ou executar outras a√ß√µes conforme necess√°rio.

**Linha 36:** Chamamos a fun√ß√£o **setUsuario** para atualizar o objeto usuario. Por este motivo inserimos as chaves { } dentro dos par√™nteses, ou seja, indica que vamos modificar o objeto.

**Linha 37:** Para simplificar o nosso trabalho, utilizamos o **Spread Operator, caracterizado pelo uso de 3 pontos antes do objeto usuario**. Dentro da fun√ß√£o, estamos criando um novo objeto usuario, mantendo todos os valores previamente armazenados. Ao mesmo tempo, atualizaremos o atributo associado ao input, cujo valor foi modificado. 

> O **Spread Operator** (Operador de Espalhamento) √© uma sintaxe do JavaScript/TypeScript, que permite a expans√£o de arrays e objetos iter√°veis em v√°rios elementos. A sintaxe do Operador Spread utiliza tr√™s pontos consecutivos (...) ao lado do array ou do objeto e pode ser usado de v√°rias maneiras. 
>
> O **Operador Spread** nos permite copiar rapidamente todo ou parte de objeto existente para um novo objeto, al√©m de permitir a combina√ß√£o de v√°rios objetos em um √∫nico objeto. Um uso muito comum do Operador Spread √© criar novos objetos, baseados em objetos existentes, com algumas altera√ß√µes em rela√ß√£o aos objetos originais.
>
> **Exemplo:**
>
> ```javascript
> let pessoa = {
> nome: 'John',
> idade: 30
> };
> 
> let {nome, idade} = {...person};
> console.log(nome); // John
> console.log(idade); // 30
> ```
>
> *No exemplo acima, "espalhamos" os atributos do objeto pessoa em vari√°veis individuais.*
>
> <br />
>
> <div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax" target="_blank"><b>JavaScript - Operador Spread</b></a></div>
>
> <br />

**Linha 38:** Nesta linha criamos uma atualiza√ß√£o din√¢mica no objeto resultante, que nos permite atualizar dinamicamente os valores dos atributos do Estado usuario, correspondente ao input que disparou o evento **onChange**. O nome do atributo que ser√° atualizado √© definido com o valor da propriedade **e.target.name** (nome do input, que sofreu a modifica√ß√£o), que corresponde ao atributo **name** do elemento **input**. O novo valor do atributo √© definido como o valor da propriedade **e.target.value**, que √© o valor atual do input que disparou o evento de mudan√ßa.

Por exemplo, se o valor (value) do `<input>` **nome** for alterado, ser√° criado um novo Estado **usuario**, atrav√©s do **Operador Spread**, com o valor original do atributo **nome** substitu√≠do pelo valor que o usuario digitou no input **nome**.

> **Trabalhando com eventos no React**
>
> Os eventos no **React** s√£o uma parte fundamental para lidar com intera√ß√µes do usu√°rio em seus aplicativos WEB. Manipular eventos em elementos React √© muito semelhante a manipular eventos em elementos do DOM, entretanto existem algumas diferen√ßas, que veremos no decorrer do treinamento.
>
> Os eventos no React s√£o chamados de **SyntheticEvents**. Eles s√£o uma camada de abstra√ß√£o em torno dos eventos nativos do navegador, que garantem a compatibilidade entre diferentes navegadores.
>
> Na fun√ß√£o **atualizarEstado()**, repare que foi criado um argumento chamado **e**. Este argumento **e** vem de **event.target**, que refere-se ao elemento do formul√°rio, que disparou o evento **onChange**, que no caso do Componente Cadastro, ser√£o elementos **input** (HTMLInputElement). 
>
> O atributo **event.target.name** refere-se a propriedade `name` (nome) do elemento input do formul√°rio, que acionou o evento **onChange**.
>
> O atributo **event.target.value** refere-se a propriedade `value` (valor), que armazena o novo valor do elemento input do formul√°rio, que acionou o evento **onChange**, ou seja, o valor que foi digitado pelo usu√°rio.

**Linhas 43 a 46:** Criamos a fun√ß√£o **handleConfirmaSenha(e: ChangeEvent<HTMLInputElement>)**, que ser√° utilizada para atualizar o Estado **confirmaSenha**, com o valor inserido pelo usu√°rio no input **confirmarSenha**. Sempre que o usu√°rio digitar alguma coisa no input **confirmarSenha**, a fun√ß√£o **handleConfirmaSenha** ser√° chamada para atualizar o Estado **confirmaSenha**. 

A fun√ß√£o **handleConfirmaSenha** ser√° associada ao evento **onChange** do input **confirmarSenha** do formul√°rio.

<div align="center"><img src="https://imgur.com/uaBEvp8.png" title="source: imgur.com" /></div>

**Linhas 48 a 68:** A fun√ß√£o **cadastrarNovoUsuario(e: FormEvent<HTMLFormElement>)** √© respons√°vel por lidar com o processo de cadastro de um novo usu√°rio na aplica√ß√£o. 

Enquanto o processo de cadastro est√° em andamento, a fun√ß√£o exibe um indicador de carregamento (Loader), valida as senhas, trata os erros do processo, exibe alertas de sucesso ou falha do processo e atualiza o Estado da aplica√ß√£o, incluindo a atualiza√ß√£o dos dados do Estado usuario ap√≥s o cadastro bem-sucedido.

**Linha 48:** Na assinatura da fun√ß√£o, indicamos que ela ir√° lidar com o evento do envio de um formul√°rio. Observe que definimos um argumento, denominado **e** (Evento), do tipo **FormEvent**. Isso significa que a fun√ß√£o **cadastrarNovoUsuario()** ter√° a responsabilidade de lidar com os eventos de mudan√ßa de valores no elemento **form**, como um todo. Em outras palavras, no Projeto Blog Pessoal, todas as vezes que o **form** for enviado (clicar no bot√£o Cadastrar, neste exemplo), ser√° disparado um evento do formul√°rio, chamado **onSubmit**, que ser√° respons√°vel por disparar a fun√ß√£o **cadastrarNovoUsuario**, que se encarregar√° de enviar os dados para o Backend.

> O **FormEvent** no **React** √© um tipo gen√©rico que representa um evento relacionado a um formul√°rio. O **FormEvent** √© usado para lidar com eventos relacionados a formul√°rios, como o evento `onSubmit`. Ele √© tipicamente usado quando voc√™ deseja executar uma a√ß√£o quando um formul√°rio √© enviado. 
>
> O **FormEvent** √© uma ferramenta √∫til para lidar com intera√ß√µes de formul√°rios em seus aplicativos React. Use-o para validar entradas, atualizar o Estado ou executar outras a√ß√µes conforme necess√°rio. 
>
> O **HTMLFormElement** √© uma interface no **DOM**, que representa um elemento `<form>`. Ele permite o acesso e em alguns casos, a modifica√ß√£o de aspectos do formul√°rio, bem como o acesso aos seus elementos e propriedades.
>
> O evento **onSubmit** √© normalmente associado a formul√°rios HTML. Ele √© acionado quando um usu√°rio envia um formul√°rio clicando no bot√£o Enviar ou pressionando a tecla Enter enquanto se concentra em um campo de formul√°rio. Esse evento √© crucial para valida√ß√£o de formul√°rios, envio de dados e outras funcionalidades relacionadas a formul√°rios.

Observe que na assinatura da fun√ß√£o **cadastrarNovoUsuario** foi adicionada a palavra **async**, que indica que esta fun√ß√£o ser√° **ass√≠ncrona**. Como vimos anteriormente, os m√©todos da Biblioteca Axios s√£o todos ass√≠ncronos. Logo, a fun√ß√£o que executar√° m√©todos ass√≠ncronos, obrigatoriamente tamb√©m deve ser ass√≠ncrona.

> Quando falamos de processamento ass√≠ncrono no TypeScript, estamos falando de **Promises**.
>
> **Promise:** √â um objeto usado para  processamento ass√≠ncrono. Uma Promise na pr√°tica √© uma promessa, que  representa um valor que pode estar dispon√≠vel agora, no futuro ou nunca. Uma Promise √© como um "procurador" para um valor que n√£o √©  necessariamente conhecido quando a promessa √© criada. Isso permite a  associa√ß√£o de m√©todos de tratamento para eventos da a√ß√£o ass√≠ncrona num caso eventual de sucesso ou de falha. Isto permite que os m√©todos  ass√≠ncronos retornem valores como m√©todos s√≠ncronos: ao inv√©s do valor  final, o m√©todo ass√≠ncrono retorna uma *promessa* ao valor em algum momento no futuro.
>
> Observe na imagem abaixo, que uma **Promise** possui tr√™s estados:
>
> <div align="center"><img src="https://i.imgur.com/CoxH7Yw.png" title="source: imgur.com" /><figcaption><i>Estados de uma Promise</i></figcaption></div>
>
> - *pending* (pendente): Estado inicial, que n√£o foi realizada nem rejeitada.
> - *fulfilled* (resolvida): sucesso na opera√ß√£o.
> - *rejected* (rejeitado):  falha na opera√ß√£o.
>
>
>   **Sintaxe:**
>
>   ```ts
>   new Promise( ( resolve, reject ) => { } )
>   ```
>
>   - **resolve**: fun√ß√£o, geralmente uma **Arrow Function**, que ser√° utilizada para retornar o resultado da Promise.
>   - **reject**: fun√ß√£o, geralmente uma **Arrow Function**, que ser√° utilizada para para retornar o erro da Promise.
>
> As palavras-chave **async** e **await**, representam uma sintaxe (outra forma de escrever uma Promise), criada com objetivo de simplificar a programa√ß√£o ass√≠ncrona, facilitando o fluxo de escrita e leitura do c√≥digo. 
>
> Em outras palavras, **torna poss√≠vel escrever um c√≥digo que funciona de forma ass√≠ncrona, por√©m √© lido e estruturado de forma s√≠ncrona**. O **async/await** tamb√©m trabalha com o c√≥digo ass√≠ncrono baseado em Promises, por√©m esconde as promessas para que a leitura e a escrita sejam mais limpas.
>
> Ao declarar uma fun√ß√£o com a palavra reservada **async**, n√≥s poderemos utilizar a palavra-chave **await** antes de qualquer fun√ß√£o que retorne uma promise. Dessa forma, a execu√ß√£o da fun√ß√£o externa (a fun√ß√£o async), ser√° pausada at√© que a Promise seja resolvida.
>
> A palavra-chave **await** recebe uma Promise e a transforma em um valor de retorno (ou lan√ßa uma exce√ß√£o em caso de erro). Quando utilizamos o **await**, o TypeScript vai aguardar at√© que a Promise seja finalizada. Se for finalizada com sucesso (o termo utilizado √© *fulfilled*), o valor obtido √© retornado. Se a Promise for rejeitada (o termo utilizado √© *rejected*), √© retornado o erro lan√ßado pela exce√ß√£o.
>
> Na pr√°tica, Isso significa que uma Requisi√ß√£o HTTP criada pelo Axios, ser√° feita em segundo plano, enquanto a aplica√ß√£o continua  funcionando normalmente, sem bloquear o Frontend. Quando o processamento da Requisi√ß√£o for conclu√≠do, o React em conjunto com o Axios, se encarregar√° de receber a Resposta HTTP com o respectivo Status, indicando o sucesso ou a falha.

**Linha 49:** Ao executar o evento **onSubmit**, o comportamento padr√£o de um formul√°rio HTML √© recarregar a p√°gina para atualizar o conte√∫do da DOM. Entretanto, no React, que utiliza o conceito Single Page Application (SPA), a p√°gina n√£o deve ser recarregada integralmente e sim atualizada pela Virtual DOM, que como vimos anteriormente, atualizar√° apenas os elementos da DOM que foram modificados. Caso a p√°gina seja recarregada, os dados do formul√°rio ser√£o perdidos. 

Para desabilitar este comportamento, voc√™ deve executar a fun√ß√£o **e.preventDefault** explicitamente. Desta forma a fun√ß√£o **cadastrarNovoUsuario** executar√° a l√≥gica necess√°ria, sem recarregar a p√°gina e perder os dados digitados pelo usu√°rio.

**Linha 51:** O la√ßo condicional **if (confirmaSenha === usuario.senha && usuario.senha.length >= 8)** verifica se a senha digitada no input **senha** e a senha digitada no input **confirmarSenha** s√£o iguais, al√©m de verificar se as senhas possuem pelo menos 8 caracteres. Se estas 2 condi√ß√µes forem satisfeitas, o c√≥digo dentro do La√ßo Conficional ser√° executado. 

**Linha 53** A fun√ß√£o **setIsLoading(true)** modifica o valor do Estado **isLoading** para true, indicando que o processo de cadastro est√° em andamento, exibindo o Loader.

**Linha 55 e 65:** Adicionamos a estrutura de tratamento de erros Try/Catch para lidarmos com os erros que possam acontecer ao enviarmos a Requisi√ß√£o POST para o Backend.

**Linha 56:** Dentro do bloco **TRY**, invocamos a fun√ß√£o **cadastrarUsuario**, do Script **Service**. Seguindo a sua estrutura, passamos como argumentos:

- A **URL** do endpoint de cadastro ('/usuarios/cadastrar'), definida no recurso Usuario do Backend;
- O Estado **usuario**, contendo os dados que ser√£o persistidos no Banco de dados;
- A fun√ß√£o **setUsuario**, que ser√° utilizada para atualizar o Estado do objeto usuario, com os dados recebidos na Resposta da Requisi√ß√£o HTTP. 

A palavra chave **await** indica que essa opera√ß√£o √© ass√≠ncrona. 

O comando **await** indica que a fun√ß√£o **cadastrarUsuario** seguir√° o seu fluxo at√© ser conclu√≠da, somente depois que receber uma Resposta do Backend. Como se trata de uma fun√ß√£o ass√≠ncrona, as demais funcionalidades da aplica√ß√£o continuar√£o funcionando normalmente, enquanto a fun√ß√£o ass√≠ncrona continuar√° sendo executada em segundo plano.

**Linha 57:** Se o processo for bem-sucedido, esta linha exibe um alerta informando que o usu√°rio foi cadastrado com sucesso.

**Linha 58:** Caso ocorra algum tipo de erro no processo dentro do bloco **TRY**, a estrutura **CATCH** captura o erro, prevenindo um exce√ß√£o que possa travar ou comprometer o funcionamento da aplica√ß√£o, al√©m de exibir um alerta, informando que ocorreu algum erro no processo.

**Linhas 61 a 65:** Atrav√©s da estrutura **ELSE**, que ser√° executada: 

- Se as senhas digitadas nos campos de senha e confirma√ß√£o de senha n√£o foremm iguais
- Se a senha digitada possuir menos de 8 caracteres. 

Ser√° disparado um alerta ao usu√°rio, todos os campos relacionados a senha ser√£o reiniciados e finalizaremos o processo de carregamento.

**Linha 67:** Independentemente do sucesso ou falha do login, o objeto **isLoading** ter√° o seu Estado modificado para false, indicando que o processo de carregamento foi conclu√≠do, ou seja, desabilita o CSS Loader.

<div align="center"><img src="https://i.imgur.com/p8q13jS.png" title="source: imgur.com" /></div>

**Linha 76:** Adicionamos o **evento onSubmit()** no formul√°rio, passando como argumento a fun√ß√£o **cadastrarNovoUsuario**, ou seja, quando o usu√°rio enviar o formul√°rio, este evento ir√° disparar a fun√ß√£o definida dentro dos par√™nteses. 

**Linhas 86, 98, 110, 122 e 134:** Atrav√©s da propriedade `value`, estamos definindo que o valor dentro desse input deve ser o mesmo que estiver dentro da respectiva propriedade do objeto **usuario**. E no input de confirma√ß√£o de senha, ele deve ser igual ao Estado **confirmarSenha**.

**Linhas 87, 99, 111, 123:** O evento **onChange()** dispara uma fun√ß√£o sempre que o input muda seu Estado original. **Exemplo: o input come√ßa com o valor vazio (Estado inicial), e ao digitarmos alguma coisa nele, o seu Estado ser√° modificado, e o evento onChange() ser√° acionado.** Quando a pessoa usu√°ria digitar alguma coisa, ser√° **executada uma arrow function**. A arrow function receber√° um objeto chamado **event** que cont√©m as informa√ß√µes sobre o evento, que enviar√° o que foi digitado para o a fun√ß√£o **atualizarEstado().**

**Linha 135:** Neste ponto foi implementada a mesma l√≥gica descrita na instru√ß√£o anterior, com a √∫nica diferen√ßa que ao inv√©s de invocarmos a fun√ß√£o **atualizarEstado()**, chamamos a fun√ß√£o **handleConfirmarSenha()**.

**Linha 140:** Adicionamos no bot√£o **Cancelar** o evento **onClick** para executar a fun√ß√£o **retornar()**.

> O evento **onClick** √© acionado quando um elemento HTML √© clicado. Isso permite que desenvolvedores adicionem comportamentos espec√≠ficos a elementos como bot√µes, imagens ou links, tornando a experi√™ncia do usu√°rio mais envolvente.

**Linhas 149 a 157:** Atrav√©s de uma express√£o tern√°ria, utilizamos a propriedade **isLoading** para definir se o Componente loader **RotatingLines** ser√° exibido, indicando que existe um processo que est√° em andamento, que no caso se refere a chamada a API para fazer o Cadastro do usu√°rio. Se **isLoading** estiver com o valor false, mostramos o texto Cadastrar. Toda essa l√≥gica √© aplicada dentro da tag `button` do HTML.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 04 - Atualizar o Componente Login</h2>



Vamos criar um link na P√°gina de Login, atrav√©s do Componente <Link />, da Biblioteca React Router Dom, para abrir o Componente Cadastro, a partir da sua rota:

1. Ainda o componente **Login**, localizado na pasta **src/pages/cadastro**
2. localize o trecho de c√≥digo indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/sLNWgt0.png" title="source: imgur.com" /></div>

3. Substitua o trecho de c√≥digo acima, pelo trecho de c√≥digo abaixo:

```tsx
<p>
	Ainda n√£o tem uma conta?{' '}
    <Link to="/cadastro" className="text-indigo-800 hover:underline">
    	Cadastre-se
	</Link>
</p>
```

**Vamos analisar o trecho de c√≥digo:**

<div align="center"><img src="https://i.imgur.com/VVdyyBG.png" title="source: imgur.com" /></div>

**Linhas 44 a 46:** Adicionamos o **componente Link** envolvendo o texto **Cadastre-se.** Observe que o Link recebe uma **propriedade** chamada **to**, que serve para indicar a rota que a pessoa usu√°ria ser√° redirecionada. Neste caso, a rota do Componente **Cadastro**.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="5%"/>Passo 05 - Testar o Componente Cadastro</h2>



1. Abra o Terminal do **Visual Studio Code**.
2. Execute o projeto atrav√©s do comando abaixo:

```
yarn dev
```

3. Pressione a combina√ß√£o de teclas **o + enter** do seu teclado para abrir o Projeto no Navegador.
4. Com o projeto aberto no seu Navegador, a P√°gina de Login ser√° exibida, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/2CNlVz4.png" title="source: imgur.com" /></div>

5. Clique no link **Cadastre-se**, indicado na imagem abaixo, para abrir a P√°gina de Cadastro:

<div align="center"><img src="https://i.imgur.com/zckBHFJ.png" title="source: imgur.com" /></div>

6. Voc√™ deve ser√° redirecionado para a P√°gina de Cadastro.

<div align="center"><img src="https://i.imgur.com/E6xuD6Q.png" title="source: imgur.com" /></div>

7. Preencha os campos do formul√°rio para criar um novo Usu√°rio e na sequ√™ncia clique no bot√£o **Cadastrar**.

<div align="center"><img src="https://i.imgur.com/OPJC567.png" title="source: imgur.com" /></div>

8. Caso o Cadastro do Usu√°rio tenha sido bem sucedido, ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/kHQVE3D.png" title="source: imgur.com" /></div>

9. Depois de clicar no bot√£o **OK** da mensagem acima, voc√™ ser√° redirecionado novamente para a **P√°gina de Login**.
10. Caso tenha acontecido algum erro, ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/Fw1Escn.png" title="source: imgur.com" /></div>

11. Para verificar qual foi o erro que aconteceu, abra as **Ferramentas de Desenvolvimento** do seu Navegador, clique na op√ß√£o **Rede ou Network** e verifique as mensagens de erro no **Console**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/qvSjvjh.png" title="source: imgur.com" /></div>

*No exemplo acima, observe que a Requisi√ß√£o retornou um HTTP Status 400 - Bad Request, porque o atributo usuario deve ser um e-mail.*

<br />

## ‚ùåErros comuns:



- **HTTP Status 400 - Bad Request:** Voc√™ est√° tentado persistir dados, que n√£o satisfazem as Regras de Valida√ß√£o do seu Backend. Lembre-se que foram criadas algumas regras de valida√ß√£o para o Objeto Usu√°rio:

| Atributo    | Regras                                                       |
| ----------- | ------------------------------------------------------------ |
| **Nome**    | Preenchimento Obrigat√≥rio <br />N√£o pode ser branco ou nulo  |
| **Usu√°rio** | Preenchimento Obrigat√≥rio <br />N√£o pode ser branco ou nulo <br />Deve ser um endere√ßo de e-mail |
| **Senha**   | Preenchimento Obrigat√≥rio <br />N√£o pode ser branco ou nulo <br />Deve ter no m√≠nimo 8 caracteres |
| **Foto**    | Deve ser um link apontando para a foto<br />O link pode ter no m√°ximo 5000 caracteres |

- **HTTP Status 500 - Internal Server Error:** Geralmente √© retornado quando ocorre algum erro interno no Render, como por exemplo, a sua API ainda n√£o foi inicializada (Passo 01).
- **Erros do React:** Erros relacionados a cria√ß√£o do Componente React. Verifique o seu c√≥digo.

<br />

<div align="left"><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/> <a href="https://pt-br.react.dev/reference/react-dom/components#form-components" target="_blank"><b>Documenta√ß√£o: Forms</b></a></div>

<div align="left"><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/> <a href="https://pt-br.react.dev/reference/react-dom/components/input" target="_blank"><b>Documenta√ß√£o: Change Event</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank"><b>Documenta√ß√£o: Fun√ß√µes Ass√≠ncronas</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_2024/tree/09_L%C3%B3gica_Cadastro_Usu%C3%A1rio" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
