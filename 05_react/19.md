<h1>Projeto Blog Pessoal - Página de Login - Lógica</h1>



Vamos implementar a **lógica do Componente Login**, cuja função é **verificar as credenciais e permitir o acesso do usuário à aplicação**.

<br />

> [!CAUTION]
>
> Não esqueça de inicializar e manter ativo o deploy do Backend no Render. Caso tenha alguma dúvida, consulte o conteúdo: **<a href="16.md">Página de  Cadastro - Lógica</a>**.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 01 - Implementar a Lógica do Componente Login</h2>



1. Abra o componente **Login.tsx** localizado dentro da pasta **src/pages/login**.
2. Localize o trecho de código indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/2bY8HMn.png" title="source: imgur.com" /></div>

3. No local indicado na imagem acima, insira o código abaixo:

<div align="center"><img src="https://i.imgur.com/ULPKS9K.png" title="source: imgur.com" /></div>

4. Não se esqueça de importar os componentes e bibliotecas necessários.

**Vamos analisar as alterações realizadas no código:**

<br />

✅ **Importações**

<div align="center"><img src="https://i.imgur.com/wkTqGob.png" title="source: imgur.com" /></div>

**Linhas 01 a 04:** Importamos os **Componentes**, **Interfaces** e **Funções** necessárias para a construção do **Componente Login**.

<br />

> [!IMPORTANT]
>
> Note que além do tipo `Usuario`, os tipos **`ChangeEvent`** e **`FormEvent`** são importados usando a palavra-chave **`type`**, porque se tratam de **tipos do TypeScript** e não de valores ou funções que serão executados.

<br />

<div align="center"><img src="https://i.imgur.com/qoDA1pH.png" title="source: imgur.com" /></div>

**Linha 08:** Criamos a constante **`navigate`**, que usa o hook **`useNavigate()`**. Com ela, conseguimos redirecionar o usuário para outras páginas da aplicação sempre que necessário.

**Linha 10:** Realizamos a **desestruturação** para acessar diretamente os valores fornecidos pelo contexto **`AuthContext`** usando o **hook `useContext`**.

- Extraímos os estados **`usuario`** e **`isLoading`**, além da função **`handleLogin`**, que foram definidos e compartilhados dentro do provedor **`AuthProvider`**.
- O hook **`useContext(AuthContext)`** permite que qualquer componente filho do **`AuthProvider`** use os dados e funções do contexto sem precisar recebê-los via *props*.

<br />

> [!IMPORTANT]
>
> O hook `useContext` deve sempre ser usado dentro de um componente **filho de um Provider**. Se chamado fora do escopo do `AuthProvider`, o React retornará o valor padrão definido no `createContext`.

<br />

**Linhas 12 a 14:** Criamos o estado **`usuarioLogin`**, inicializado como um objeto vazio (`{}`), mas tipado como **`UsuarioLogin`** usando o operador **`as`** do TypeScript.

- O operador **`as`** informa ao compilador que o objeto vazio deve ser tratado como do tipo **`UsuarioLogin`**, mesmo que ainda não possua todas as propriedades da interface.
- Isso é útil para criar um **placeholder** que será preenchido posteriormente com dados válidos.

Inicialmente, o estado **`usuarioLogin`** armazena apenas as **credenciais digitadas pelo usuário** (usuário e senha).

- Durante a digitação, o estado é atualizado em tempo real;
- Após o login bem-sucedido, os demais atributos do objeto (**id**, **nome**, **foto**, **token**) são preenchidos com os dados retornados pelo backend, mantendo o estado consistente com a interface **`UsuarioLogin`**.

<br />

> [!IMPORTANT]
>
> Essa abordagem permite separar temporariamente os **dados de input** dos **dados completos do usuário**, evitando expor informações sensíveis antes da autenticação e facilitando o controle do estado no contexto.

<br />

<div align="center"><img src="https://i.imgur.com/K2tpshM.png" title="source: imgur.com" /></div>

**Linhas 16 a 20:** Usamos o **hook `useEffect`** para observar mudanças no estado **`usuario`**.

- Se o **token** for diferente de uma string vazia (`""`), significa que o login foi bem-sucedido e o backend retornou um token válido;
- Se o **token** continuar vazio, o login **não foi realizado**.

Quando o login é bem-sucedido, a função **`navigate('/home')`** redireciona o usuário automaticamente para a página principal da aplicação.

<br />

> [!IMPORTANT]
>
> Essa abordagem garante que **apenas usuários autenticados possam acessar determinadas rotas**, reforçando a segurança da aplicação.

<br />

✅ **Função Atualizar Estado Usuario**

<div align="center"><img src="https://i.imgur.com/X8hK8Kd.png" title="source: imgur.com" /></div>

**Linhas 22 a 27:** Criamos a função **`atualizarEstado(e: ChangeEvent<HTMLInputElement>)`**, que atualiza o estado **`usuarioLogin`** conforme o usuário digita nos campos do formulário.

O fluxo é o seguinte:

1. O usuário digita em um input → o evento **onChange** é disparado;
2. A função **`atualizarEstado`** é chamada com o evento;
3. O estado **`usuarioLogin`** é clonado com o **Spread Operator (`...usuarioLogin`)**;
4. O campo alterado é identificado por **`e.target.name`** e atualizado com **`e.target.value`**;
5. O React re-renderiza o componente com o valor atualizado.

<br />

> [!IMPORTANT]
>
> Para que a atualização funcione corretamente, **é essencial que os atributos `id` e `name` de cada input tenham o mesmo nome do atributo correspondente no estado `usuarioLogin`**.

<br />

**Linha 22:** A função `atualizarEstado` recebe o evento do tipo **`ChangeEvent<HTMLInputElement>`**, tipagem fornecida pelo React.

**Linha 23:** Chamamos a função **`setUsuarioLogin`** para atualizar o estado `usuarioLogin`.

**Linha 24:** O **Spread Operator (`...usuarioLogin`)** clona o estado atual, mantendo os valores existentes.

**Linha 25:** O campo alterado é identificado por **`e.target.name`** e atualizado com o valor armazenado em **`e.target.value`**.

**Onde:**

- O `e` representa o **evento** ( `onChange`).
- O `target` é o **elemento HTML** que disparou o evento (`<input>`).
- `name` (nome do input) e `value` (valor digitado pelo usuário) são **propriedades do elemento** HTML.

<br />

✅ **Função Autenticar Usuário (Login)**

<div align="center"><img src="https://i.imgur.com/xcj0ZfL.png" title="source: imgur.com" /></div>

**Linhas 29 a 32:** Criamos a função **`login`**, que gerencia todo o processo de autenticação do usuário.

- **Linha 29:** Recebe o evento `e` do tipo **`FormEvent<HTMLFormElement>`**, que representa o envio do formulário. A função é **assíncrona** (`async`) porque utiliza o **Axios**, que trabalha com **Promises**.
- **Linha 30:** **`e.preventDefault()`** impede o comportamento padrão do navegador, que é recarregar a página ao submeter um formulário;
- **Linha 31:** Chamamos a função **`handleLogin()`**, disponibilizada pelo **AuthContext**, passando como parâmetro o objeto **`usuarioLogin`** com as credenciais digitadas;

Dessa forma, o processo de autenticação é executado de forma assíncrona, e o estado do usuário será atualizado no contexto após o login bem-sucedido.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 02 - Integração da Lógica do Componente com o Formulário</h2>



Agora que criamos a lógica do componente **Login**, vamos integrá-la ao formulário do componente:

<br />

✅ **Importar o Loader**

Vamos importar o componente `Cliploader` da biblioteca **React Spinners**, como indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/K3PzXsz.png" title="source: imgur.com" /></div>

<br />

✅ **Evento `onSubmit`**

1. Localize o trecho de código abaixo, que inicializa o elemento `form`:

<div align="center"><img src="https://i.imgur.com/TXwqQzU.png" title="source: imgur.com" /></div>

2. Vamos adicionar o **evento `onSubmit`** para acionar a função `login`, conforme o código abaixo:

<div align="center"><img src="https://i.imgur.com/yyEaoKA.png" title="source: imgur.com" /></div>

**Linha 39:** Adicionamos o **evento `onSubmit`** ao formulário, passando a função **`login`**. O fluxo é o seguinte:

- O usuário clica no botão **Cadastrar** → o evento **submit** é disparado;
- O React controla o envio do formulário, evitando recarregar a página;
- A função **`login`** é executada, que por sua vez:
  - Chama a função **`handleLogin()`** do contexto `AuthContext`;
  - A função **`handleLogin()`** é executada, enviando uma **requisição POST** com as credenciais do usuário (usuario e senha);
- O backend processa a requisição e tenta autenticar o usuário e retornando os dados completos (como `id`, `nome`, `foto` e `token`) caso o login seja bem-sucedido.

<br />

✅ **Input `usuario`**

1. Localize o trecho de código abaixo, que contém o **`input` usuario** , que receberá o **e-mail do usuário**, conforme indicado no código abaixo:

<div align="center"><img src="https://i.imgur.com/TzNJ2rH.png" title="source: imgur.com" /></div>

2. Vamos adicionar a **propriedade `value`** ao input `usuario`, associando ao atributo `usuario` do estado `usuarioLogin`, e o **evento `onChange`** para disparar a função `atualizarEstado`, conforme indicado no código abaixo:

<div align="center"><img src="https://i.imgur.com/5gr1zBC.png" title="source: imgur.com" /></div>

**Linha 50:** A propriedade **`value`** garante que o valor do input `usuario` esteja sempre sincronizado com o estado **`usuarioLogin.usuario`**, tornando-o um **componente controlado**.

**Linha 51:** O **evento `onChange`** no input `usuario`, com a função **`atualizarEstado`**, funciona assim:

- O usuário digita algo → o evento **onChange** é disparado;
- A função **`atualizarEstado`** recebe o evento `e`;
- O valor do atributo `usuario` no estado **usuarioLogin** é atualizado com o que foi digitado;
- Os demais atributos do estado permanecem inalterados;
- O React re-renderiza o input, mantendo a propriedade **`value`** sincronizada com o estado.

A variável `e` permite identificar **qual campo do estado deve ser atualizado**, usando a propriedade **`name`** do input, que corresponde ao atributo correto no estado **usuario**.

<br />

✅ **Input `senha`**

Adicione a **propriedade `value`** ao input `senha`, associando ao atributo `senha` do estado `usuarioLogin`, e o **evento `onChange`** para disparar a função `atualizarEstado`, conforme indicado no código abaixo:

<div align="center"><img src="https://i.imgur.com/iO6BpPL.png" title="source: imgur.com" /></div>

Dessa forma, qualquer alteração no input **`senha`**, assim como no campo **`usuario`**, atualiza diretamente o estado **usuarioLogin**, mantendo os valores sempre sincronizados com a interface.

<br />

> [!WARNING]
>
> É importante que os atributos **`name`** e **`id`** de cada input tenham o **mesmo nome do atributo** correspondente no estado **usuario**.
>

<br />

✅ **Botão Entrar - Adicionar Loader**

No botão **Entrar**, adicionamos o **loader**, controlado pelo estado **`isLoading`**:

<div align="center"><img src="https://i.imgur.com/0R3XMdP.png" title="source: imgur.com" /></div>

**Linhas 70 a 76:** Utilizamos uma **expressão ternária** para definir o conteúdo do botão:

- Se **`isLoading`** for `true` → exibe o **loader `Cliploader`** da biblioteca **React Spinners**;
- Se **`isLoading`** for `false` → exibe o texto **Entrar**.

Essa lógica garante **feedback visual** ao usuário durante o envio do formulário e evita múltiplos cliques enquanto a requisição está em andamento.

No componente **`Cliploader`**, configuramos:

- **`color`**: branco, para contraste com o botão;
- **`size`**: 24, tamanho proporcional ao botão.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 03 - Atualizar o Componente Navbar</h2>



Vamos criar um link no Componente **Navbar**, através do Componente `<Link />`, da Biblioteca **React Router Dom**, para efetuar o logout da aplicação ao clicar na opção **Sair**:

1. Abra o Componente Navbar localizado dentro da pasta **src/components/navbar**
2. Localize o trecho de código indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/xKB8b8G.png" title="source: imgur.com" /></div>

3. No local indicado na imagem acima, insira o código abaixo:

<div align="center"><img src="https://i.imgur.com/1C0kz6c.png" title="source: imgur.com" /></div>

4. Não esqueça de fazer as respectivas importações dos componentes e bibliotecas.

**Vamos analisar as alterações realizadas no código:**

<div align="center"><img src="https://i.imgur.com/jkcX0Jp.png" title="source: imgur.com" /></div>

**Linhas 01 a 03:** Importamos os **Componentes**, **Interfaces** e **Funções** necessárias para a construção do **Componente Login**.

**Linha 07:** Criamos a constante **`navigate`**, que usa o hook **`useNavigate()`**. Com ela, conseguimos redirecionar o usuário para outras páginas da aplicação sempre que necessário.

**Linha 09:** Realizamos a **desestruturação** para acessar diretamente os valores fornecidos pelo contexto **`AuthContext`** usando o **hook `useContext`**.

- Extraímos a função **`handleLogin`**, que foi definida e compartilhada dentro do provedor **`AuthProvider`**.

**Linhas 11 a 16:** Criamos a função **`logout()`**, responsável por gerenciar o processo de **logout do usuário** na aplicação.

- **Linha13:** A função **`logout()`** chama a função **`handleLogout()`** do **`AuthContext`**, que:
  - Reinicializa o estado **`usuario`**, retornando todos os atributos aos valores iniciais;
  - Garante que **nenhum dado sensível fique acessível** após o logout.
- **Linha14:** Em seguida, a função exibe um **alerta** informando que o logout foi realizado com sucesso;
- **Linha15:** Por fim, a função usa a constante **`navigate`** para redirecionar o usuário à **página de login**, bloqueando o acesso a rotas protegidas até que um novo login seja efetuado.

<br />

> [!IMPORTANT]
>
> Esse padrão é importante para manter a **consistência da navegação** e a **segurança da aplicação**, evitando que usuários possam acessar informações restritas após encerrarem a sessão.

<br />

5. Para finalizar, localize o trecho de código indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/YDppKXH.png" title="source: imgur.com" /></div>

6. No local indicado na imagem acima, insira o código abaixo:

<div align="center"><img src="https://i.imgur.com/FSNupVM.png" title="source: imgur.com" /></div>

**Linha 31:** Envolvemos o texto **`Sair`** com o componente **`Link`** do React Router DOM, permitindo navegar entre páginas **sem recarregar a aplicação**.

- O evento **`onClick`** dispara a função **`logout()`** quando o usuário clica no link;
- A classe **`hover:underline`** do **Tailwind CSS** adiciona um **efeito de sublinhado** ao passar o mouse sobre o texto, melhorando a experiência do usuário e indicando que o elemento é clicável.

<br />

<h2><img src="https://i.imgur.com/H9wEgsJ.png" title="source: imgur.com" width="4%"/>Passo 04 - Testar o Componente Login</h2>



1. Abra o Terminal do **Visual Studio Code**.
2. Execute o projeto através do comando abaixo:

```bash
npm run dev
```

3. Pressione a combinação de teclas **o + enter** do seu teclado para abrir o Projeto no Navegador.
4. Com o projeto aberto no seu Navegador, a Página de **Login** será exibida, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/2CNlVz4.png" title="source: imgur.com" /></div>

5. Faça o login na aplicação, informando o **Usuário** e a **Senha**.
6. Será exibida a mensagem abaixo confirmando o login:

<div align="center"><img src="https://i.imgur.com/lSNPSo1.png" title="source: imgur.com" /></div>

7. Caso ocorra algum erro, será exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/QBO0oHW.png" title="source: imgur.com" /></div>

8. Depois de clicar no botão **OK**, você será redirecionado para a Página **Home**:

<div align="center"><img src="https://i.imgur.com/aE8lJZ2.png" title="source: imgur.com" /></div>

9. Clique na opção **Sair**, para efetuar **logout**:

<div align="center"><img src="https://i.imgur.com/8qXw8en.png" title="source: imgur.com" /></div>

10. Será exibida a mensagem abaixo, indicando que o logout foi bem-sucedido:

<div align="center"><img src="https://i.imgur.com/FdmXfBG.png" title="source: imgur.com" /></div>

11. Depois de clicar no botão **OK**, você será redirecionado para a Página de **Login**:

<div align="center"><img src="https://i.imgur.com/2CNlVz4.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="https://github.com/rafaelq80/blogpessoal_react_v19/tree/11_Login_Logica" target="_blank"><b>Código fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
