<h1>Projeto 02 - Blog Pessoal - Spring Security - Ecossistema da Seguran√ßa - Parte 03</h1>



O que veremos por aqui:

1. A Classe SecurityConfig

Dando continuidade √† implementa√ß√£o do **Ecossistema de Seguran√ßa**, vamos criar a √∫ltima classe respons√°vel pelas configura√ß√µes gerais do **Spring Security**: a **`SecurityConfig`**.

<br />

<h2>üë£ Passo 01 - Criar a Classe SecurityConfig</h2>



A classe **`SecurityConfig`** √© respons√°vel por sobrescrever as configura√ß√µes padr√£o do **Spring Security** e definir como o sistema de seguran√ßa da aplica√ß√£o ir√° funcionar.

Nela, vamos especificar:

- As formas de autentica√ß√£o que ser√£o utilizadas;
- Quais endpoints estar√£o protegidos pelo Token JWT;
- Outras configura√ß√µes relevantes para o controle de acesso.

Ap√≥s a implementa√ß√£o desta classe, a tela de login padr√£o que aparecia no navegador ser√° desativada e passaremos a utilizar as novas configura√ß√µes definidas como padr√£o.

Vamos criar e implementar a Classe **SecurityConfig**:

1. Clique com o bot√£o direito do mouse sobre o **pacote com.generation.blogpessoal.security**, na source folder principal (**src/main/java**), e clique na op√ß√£o **New ü°™ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da Classe (**SecurityConfig**), e na sequ√™ncia clique no bot√£o **Finish** para concluir.

Vejamos abaixo a implementa√ß√£o da Classe **SecurityConfig**:

<div align="center"><img src="https://imgur.com/rlI8MbT.png" title="source: imgur.com" /></div>

**Linha 1:** Atrav√©s do comando **`package`**, estamos informando o nome do pacote (camada) onde a classe foi criada. Essa informa√ß√£o √© inserida automaticamente pelo STS (Spring Tool Suite) ao criar a classe, e serve para organizar o c√≥digo dentro do projeto.

**Linhas 3 a 17:** Atrav√©s do comando **`import`**, estamos indicando os pacotes que cont√™m as classes utilizadas dentro da **`SecurityConfig`**. Esses imports permitem que possamos acessar recursos de outras bibliotecas ou m√≥dulos sem precisar escrever seus caminhos completos a cada uso.

<div align="center"><img src="https://i.imgur.com/W2Xhs6E.png" title="source: imgur.com" /></div>

**Linhas 17 e 18:** A classe **`SecurityConfig`** possui duas anota√ß√µes importantes:

- **`@Configuration`** ‚Äì Indica que a classe √© do tipo configura√ß√£o, ou seja, √© uma fonte de defini√ß√µes de *Beans*. Essa anota√ß√£o √© essencial quando utilizamos configura√ß√£o baseada em Java no Spring.
- **`@EnableWebSecurity`** ‚Äì Habilita a seguran√ßa de forma global (para toda a aplica√ß√£o) e permite sobrescrever m√©todos para redefinir as regras de seguran√ßa da aplica√ß√£o.

> **Bean no Spring**
>
> No Spring, um *Bean* √© um objeto que comp√µe a espinha dorsal da aplica√ß√£o e que √© totalmente gerenciado pelo *Spring Container*.
>
> Um *Bean* pode ser criado de diversas formas:
>
> - Por meio de anota√ß√µes como **`@Configuration`**, **`@Service`**, **`@Component`**, **`@Repository`**, entre outras (registro autom√°tico);
> - Ou com a anota√ß√£o **`@Bean`** em m√©todos de classes de configura√ß√£o (registro manual).
>
> Para utiliz√°-los em outras partes da aplica√ß√£o, √© necess√°rio recorrer √† **inje√ß√£o de depend√™ncia**, que pode ser feita com **`@Autowired`**, via construtor ou de forma program√°tica pelo `ApplicationContext`.

**Linha 21:** Define um **array constante** chamado `PUBLIC_ENDPOINTS`, que cont√©m uma lista de caminhos (URLs) que representam os **endpoints p√∫blicos** da aplica√ß√£o. Esses endpoints podem ser acessados sem a necessidade de autentica√ß√£o ou autoriza√ß√£o, ou seja, qualquer usu√°rio, mesmo n√£o autenticado, poder√° fazer requisi√ß√µes para eles.

Esse atributo possui os modificadores:

- **`private`:** s√≥ pode ser acessado dentro da pr√≥pria classe.
- **`static`:** indica que o atributo pertence √† classe, e n√£o a um objeto espec√≠fico, permitindo seu acesso sem criar inst√¢ncias.
- **`final`:** torna o valor imut√°vel, ou seja, ele n√£o pode ser alterado ap√≥s a inicializa√ß√£o.

**Linhas 22 a 25:** Entre chaves `{ ... }`, temos a lista de **endere√ßos de endpoints p√∫blicos** da aplica√ß√£o. Esses caminhos n√£o exigem autentica√ß√£o para serem acessados, permitindo que qualquer usu√°rio (autenticado ou n√£o) utilize esses recursos:

- **`/usuarios/logar`** ‚Üí endere√ßo de autentica√ß√£o (login), se n√£o for p√∫blico ningu√©m conseguir√° logar.
- **`/usuarios/cadastrar`** ‚Üí endere√ßo para criar um novo usu√°rio, se n√£o for p√∫blico ningu√©m conseguir√° se cadastrar.
- **`/error/**`** ‚Üí permite que as *Exceptions* lan√ßadas por meio do comando **throw** sejam propagadas corretamente.
- **`/docs`, `/swagger-ui/**`, `/v3/api-docs/**`, `/swagger-resources/\**`** ‚Üí endere√ßos relacionados √† documenta√ß√£o da API via Swagger.
- **`/`** ‚Üí rota raiz da aplica√ß√£o, que ser√° utilizada pelo Swagger.

Este atributo ser√° utilizado na configura√ß√£o de seguran√ßa para **definir quais rotas ter√£o acesso p√∫blico** no *Spring Security*. Caso seja necess√°rio liberar outros endpoints, basta adicion√°-los ao array, garantindo que fiquem acess√≠veis **mesmo sem autentica√ß√£o**.

<br />

> [!WARNING]
>
> **A aus√™ncia da configura√ß√£o do endpoint `/error/**` na lista de rotas p√∫blicas pode causar comportamentos inesperados.** 
>
> Por exemplo, no m√©todo **atualizarUsuario()**, ao tentar atualizar o atributo **usuario** com um e-mail que j√° pertence a outro usu√°rio, a *Exception* esperada n√£o seria lan√ßada. Nesse cen√°rio, em vez de retornar a mensagem de erro correspondente, a aplica√ß√£o responderia com o status HTTP **401 ‚Äì Acesso Negado**, mesmo quando o *Token JWT* fornecido fosse v√°lido. Isso pode confundir o cliente da API e dificultar a identifica√ß√£o da causa real do problema.

<br />

> [!NOTE]
>
> **Alerta de BSM**
>
> *Mantenha a Orienta√ß√£o ao Futuro*
>
> O **Swagger** √© uma ferramenta que facilita a documenta√ß√£o e o teste de APIs, permitindo visualizar e interagir com os endpoints diretamente pelo navegador. Em breve, faremos sua configura√ß√£o para que possamos explorar nossa API de forma pr√°tica e organizada.

<br />

**Linhas 28 e 29:** Foi realizada a inje√ß√£o de depend√™ncia da classe **`JwtAuthFilter`**, permitindo o acesso e uso do filtro JWT dentro da configura√ß√£o de seguran√ßa.

<br />

<div align="center"><img src="https://i.imgur.com/nqUSVIr.png" title="source: imgur.com" /></div>

**Linhas 31 a 34:** Foi implementado o m√©todo **`passwordEncoder`**, que retorna uma inst√¢ncia da classe **`BCryptPasswordEncoder`**. Essa classe utiliza o algoritmo de criptografia do tipo **hash** chamado **BCrypt**. Utilizaremos esse m√©todo para criptografar e validar a senha dos usu√°rios durante o processo de autentica√ß√£o.

O par√¢metro passado para o construtor do **`BCryptPasswordEncoder`** ‚Äî no caso, o n√∫mero **10** ‚Äî representa a quantidade de **salt rounds** (ou saltos). Isso indica quantas vezes o algoritmo ir√° aplicar a transforma√ß√£o de hash, aumentando a complexidade e a seguran√ßa da criptografia. Quanto maior esse n√∫mero, mais seguro ser√° o hash, mas tamb√©m maior ser√° o tempo necess√°rio para gerar e validar a senha.

**10 √© o valor padr√£o** do n√∫mero de salt rounds usado pelo `BCryptPasswordEncoder` no Spring Security, porque representa um equil√≠brio entre seguran√ßa e desempenho, oferecendo prote√ß√£o adequada contra ataques de for√ßa bruta, sem impactar muito o tempo de processamento.

> **Hash** √© um algoritmo que transforma dados de tamanho vari√°vel em uma sa√≠da de tamanho fixo, codificada de forma √∫nica para aquele conte√∫do.
>
> O **bcrypt** √© um algoritmo de criptografia especificamente projetado para proteger senhas, tornando a tarefa de descriptograf√°-las muito dif√≠cil.

**Linhas 36 a 39:** O m√©todo **`authenticationManager`** configura a autentica√ß√£o da aplica√ß√£o. 

Ele utiliza o m√©todo **`getAuthenticationManager`** para obter uma implementa√ß√£o da interface **`UserDetailsService`**, que √© respons√°vel por validar se o usu√°rio √© leg√≠timo ou n√£o. No projeto Blog Pessoal, essa implementa√ß√£o ser√° feita pela classe **`UserDetailsServiceImpl`**, que realiza a valida√ß√£o diretamente no banco de dados.

√â importante notar que o m√©todo pode lan√ßar uma exce√ß√£o gen√©rica do tipo **`Exception`**, pois diversas situa√ß√µes podem gerar erros durante a configura√ß√£o da seguran√ßa. Optamos por capturar essa exce√ß√£o mais gen√©rica para simplificar o tratamento.

<br />

> [!IMPORTANT]
>
> Note que m√©todos anotados com **`@Bean`** n√£o precisam do modificador `public`, pois o Spring consegue detect√°-los automaticamente independentemente do modificador de acesso.

<br />

<div align="center"><img src="https://imgur.com/WkC64hP.png" title="source: imgur.com" /></div>

**Linhas 43 a 64:** O m√©todo **`filterChain`** informa ao Spring que a configura√ß√£o padr√£o do Spring Security ser√° substitu√≠da por uma nova configura√ß√£o personalizada. Essa nova configura√ß√£o permite customizar a autentica√ß√£o da aplica√ß√£o, desabilitando o formul√°rio de login padr√£o e habilitando a autentica√ß√£o via HTTP, adequada para o uso de tokens JWT.

O m√©todo `filterChain` recebe um objeto do tipo **`HttpSecurity`** que √© utilizado para configurar as regras de seguran√ßa da aplica√ß√£o para todas as requisi√ß√µes HTTP recebidas.

√â importante notar que o m√©todo pode lan√ßar uma exce√ß√£o gen√©rica do tipo **`Exception`**, pois diversas situa√ß√µes podem gerar erros durante a configura√ß√£o da seguran√ßa. Optamos por capturar essa exce√ß√£o mais gen√©rica para simplificar o tratamento.

> Neste m√©todo, usamos **Express√µes Lambda**, que fazem parte da linguagem Java desde a vers√£o 8, para definir de forma mais clara e concisa as regras de seguran√ßa. No contexto do Spring Security, essas express√µes s√£o chamadas de **Lambda DSL (Domain Specific Language)**, pois s√£o lambdas adaptadas para configurar especificamente a seguran√ßa da aplica√ß√£o, deixando o c√≥digo mais limpo e menos verboso.

**Linhas 45 e 46:** Usando o objeto `http` e o m√©todo **`sessionManagement`**, configuramos a pol√≠tica de sess√£o para **`SessionCreationPolicy.STATELESS`**. Isso significa que a aplica√ß√£o n√£o ir√° manter sess√µes entre as requisi√ß√µes; cada requisi√ß√£o deve conter todas as informa√ß√µes necess√°rias para que o servidor a processe, como o token JWT, sem depender de estados anteriores.

**Linha 47:** Com o m√©todo **`csrf(csrf -> csrf.disable())`**, desabilitamos a prote√ß√£o contra ataques do tipo **CSRF (Cross-Site Request Forgery)**, que, em sistemas com sess√£o, exige um token especial para validar requisi√ß√µes POST, PUT e DELETE. Como estamos usando autentica√ß√£o por token JWT, essa prote√ß√£o n√£o √© necess√°ria e sua desativa√ß√£o evita bloqueios indevidos, especialmente em produ√ß√£o.

**Linha 48:** A chamada **`cors(cors -> {})`** habilita o suporte a **CORS (Cross-Origin Resource Sharing)**, permitindo que a API aceite requisi√ß√µes provenientes de dom√≠nios diferentes daquele onde est√° hospedada. Essa configura√ß√£o √© essencial para que o front-end e o back-end, quando hospedados em servidores distintos, possam se comunicar sem bloqueios.

<br />

>### CORS na Pr√°tica
>
>Configurar o **Cross-Origin Resource Sharing** (CORS) no Spring √© fundamental para permitir que as classes controladoras da aplica√ß√£o aceitem requisi√ß√µes feitas de dom√≠nios diferentes daquele onde o backend est√° hospedado. Durante o desenvolvimento local, esse dom√≠nio normalmente √© o **localhost**, mas, ao migrar para a produ√ß√£o, ser√° o endere√ßo p√∫blico da aplica√ß√£o na nuvem.
>
>Essa configura√ß√£o √© essencial para que o front-end ‚Äî que geralmente roda em outro servidor ou porta ‚Äî possa acessar e consumir a API sem ser bloqueado pelo navegador. Al√©m de liberar as **origens das requisi√ß√µes** (**allowed origins**), a configura√ß√£o CORS tamb√©m permite especificar quais **cabe√ßalhos das requisi√ß√µes** (**allowed headers**) podem ser recebidos, o que √© importante para permitir o envio de informa√ß√µes sens√≠veis, como tokens de seguran√ßa.
>
>Um exemplo cr√≠tico √© o **token JWT** utilizado para autenticar e autorizar o acesso seguro a endpoints protegidos. Para que o token seja enviado corretamente pelo navegador em requisi√ß√µes cross-origin, o CORS deve estar configurado para aceitar os cabe√ßalhos onde esse token √© enviado (normalmente o cabe√ßalho `Authorization`).
>
>> [!TIP]
>
>> **Recomenda√ß√£o para produ√ß√£o:** Ao migrar para ambientes de produ√ß√£o, √© altamente recomend√°vel restringir as origens permitidas definindo explicitamente o endere√ßo do frontend na anota√ß√£o `@CrossOrigin` nas classes controladoras. Essa pr√°tica aumenta a seguran√ßa da aplica√ß√£o, limitando quem pode acessar a API.
>
>Enquanto backend e frontend estiverem rodando localmente (exemplo: ambos em `localhost`), n√£o haver√° problemas de CORS, pois a origem das requisi√ß√µes √© a mesma:
>
><div align="center"><img src="https://i.imgur.com/5LNZ19i.png" title="source: imgur.com" /></div>
>
>Por√©m, ao fazer o deploy, o frontend e backend geralmente estar√£o em servidores diferentes, como ilustrado abaixo:
>
><div align="center"><img src="https://i.imgur.com/wcO0LS5.png" title="source: imgur.com" /></div>
>
>Nesse cen√°rio, quando o frontend envia uma requisi√ß√£o para o backend, o navegador pode bloquear essa requisi√ß√£o por causa da pol√≠tica de CORS, exibindo uma mensagem semelhante a esta:
>
>`Access to fetch at 'http://frontend.vercel.app/postagens' from origin 'http://frontend.vercel.app'` 
>`has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.` 
>
>Para evitar esse bloqueio, o Spring oferece a anota√ß√£o **`@CrossOrigin`**, que pode ser aplicada √†s classes controladoras ou m√©todos espec√≠ficos para liberar as origens autorizadas. Ao configurar essa anota√ß√£o, o backend inclui os cabe√ßalhos necess√°rios para que o navegador permita o compartilhamento de recursos entre diferentes dom√≠nios.
>
><div align="center"><img src="https://i.imgur.com/4Yi7bjw.png" title="source: imgur.com" /></div>
>
>Com o CORS configurado corretamente, o backend estar√° preparado para aceitar requisi√ß√µes do frontend hospedado em outro dom√≠nio, garantindo a comunica√ß√£o segura e sem bloqueios entre as duas partes da aplica√ß√£o.

<br />

**Linha 50:** O m√©todo `.authorizeHttpRequests(auth -> auth ...)` inicia a configura√ß√£o das regras de autoriza√ß√£o para as requisi√ß√µes HTTP. Ele recebe uma express√£o lambda que permite definir quais endpoints ser√£o liberados para acesso sem autentica√ß√£o e quais exigir√£o que o usu√°rio esteja autenticado.

**Linha 51:** O m√©todo `.requestMatchers(PUBLIC_ENDPOINTS).permitAll()` indica que todos os endpoints listados na constante `PUBLIC_ENDPOINTS` podem ser acessados livremente, sem necessidade de autentica√ß√£o. Normalmente, esses endpoints incluem rotas p√∫blicas como login e cadastro do usu√°rio.

**Linha 52:** A chamada `.requestMatchers(HttpMethod.OPTIONS).permitAll()` libera o acesso para requisi√ß√µes do tipo OPTIONS. Essas requisi√ß√µes s√£o usadas pelo navegador para verificar as permiss√µes de comunica√ß√£o entre o front-end e o back-end, especialmente em contextos CORS, e precisam ser liberadas para o correto funcionamento da aplica√ß√£o.

> [!WARNING]
>
> Se as requisi√ß√µes OPTIONS n√£o forem liberadas, o Spring Security bloquear√° a requisi√ß√£o pr√©via (preflight) enviada pelo navegador, impedindo que m√©todos como POST e PUT sejam reconhecidos e executados, o que pode causar falha na comunica√ß√£o entre front-end e back-end em ambientes cross-origin, principalmente em produ√ß√£o.

**Linha 53:** O m√©todo `.anyRequest().authenticated()` especifica que todas as outras requisi√ß√µes, que n√£o correspondam aos padr√µes anteriores e dever√£o obrigatoriamente estar autenticadas para serem aceitas pela aplica√ß√£o.

**Linha 56:** O m√©todo `.exceptionHandling(exceptions -> exceptions ...)` configura como o Spring Security tratar√° as exce√ß√µes relacionadas √† seguran√ßa da aplica√ß√£o. Ele recebe uma express√£o lambda que permite personalizar o comportamento quando ocorrem falhas de autentica√ß√£o ou autoriza√ß√£o durante o processamento das requisi√ß√µes.

**Linha 57:** O m√©todo `.authenticationEntryPoint((request, response, authException) -> ...)` define o ponto de entrada para tratamento de falhas de autentica√ß√£o. Este m√©todo √© invocado automaticamente pelo Spring Security sempre que um usu√°rio n√£o autenticado tenta acessar um recurso protegido, ou quando a autentica√ß√£o falha por qualquer motivo. A express√£o lambda recebe tr√™s par√¢metros: `request` (a requisi√ß√£o HTTP que falhou), `response` (a resposta HTTP que ser√° enviada ao cliente) e `authException` (a exce√ß√£o que causou a falha de autentica√ß√£o).

**Linhas 58 e 59:** O m√©todo `response.sendError(HttpServletResponse.SC_UNAUTHORIZED, "N√£o autorizado - Token JWT ausente ou inv√°lido")` configura a resposta de erro que ser√° enviada ao cliente. A constante `HttpServletResponse.SC_UNAUTHORIZED` possui o valor 401, que √© o c√≥digo HTTP correto para indicar que a requisi√ß√£o n√£o possui credenciais de autentica√ß√£o v√°lidas. 

A mensagem personalizada ajuda o cliente a entender o motivo da falha. Sem esta configura√ß√£o, o Spring Security retornaria 403 (Forbidden) por padr√£o, o que √© semanticamente incorreto, pois 403 indica que o usu√°rio est√° autenticado mas n√£o tem permiss√£o, enquanto 401 indica que a autentica√ß√£o √© necess√°ria mas n√£o foi fornecida ou √© inv√°lida.

**Linha 62:** A chamada `.addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)` adiciona o filtro personalizado `jwtAuthFilter` antes do filtro padr√£o de autentica√ß√£o do Spring Security. Isso garante que o token JWT presente nas requisi√ß√µes ser√° validado antes do processamento padr√£o da autentica√ß√£o.

**Linha 63:** Por fim, o m√©todo `.build()` finaliza a configura√ß√£o e retorna a cadeia de filtros de seguran√ßa pronta para ser utilizada pelo Spring Security em todas as requisi√ß√µes da aplica√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="4%"/> <a href="https://medium.com/reprogramabr/uma-breve-introdu%C3%A7%C3%A3o-sobre-bcrypt-f2fad91a7420" target="_blank"><b>Artigo: <i>Uma breve introdu√ß√£o sobre o BCrypt</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="4%"/> <a href="https://bcrypt-generator.com" target="_blank"><b>Site: <i>Codificador BCrypt</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Authentication" target="_blank"><b>Documenta√ß√£o: HTTP Basic Authentication</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/CORS" target="_blank"><b>Documenta√ß√£o: CORS</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="4%"/> <a href="https://reflectoring.io/complete-guide-to-csrf/" target="_blank"><b>Artigo: Complete Guide to CSRF/XSRF (Cross-Site Request Forgery)</b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/password/PasswordEncoder.html" target="_blank"><b>Documenta√ß√£o: <i>Interface PasswordEncoder</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html" target="_blank"><b>Documenta√ß√£o: <i>Classe BCryptPasswordEncoder</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/authentication/AuthenticationManager.html" target="_blank"><b>Documenta√ß√£o: <i>AuthenticationManager</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/authentication/configuration/AuthenticationConfiguration.html" target="_blank"><b>Documenta√ß√£o: <i>AuthenticationConfiguration</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/web/AuthenticationEntryPoint.html" target="_blank"><b>Documenta√ß√£o: <i>AuthenticationEntryPoint</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html" target="_blank"><b>Documenta√ß√£o: <i>HttpSecurity</i></b></a></div>

<div align="left"><img src=https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://spring.io/blog/2019/11/21/spring-security-lambda-dsl" target="_blank"><b>Documenta√ß√£o: <i>Express√µes Lambda DSL</i></b></a></div>

<br />

üíæ **Salve as altera√ß√µes antes de prosseguir ( File ü°™ Save All )!**

A seguir, veja a implementa√ß√£o completa da classe **`SecurityConfig`**:

```java
package com.generation.blogpessoal.security;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

import jakarta.servlet.http.HttpServletResponse;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    private static final String[] PUBLIC_ENDPOINTS = {
        "/usuarios/logar",
        "/usuarios/cadastrar",
        "/error/**",
        "/", "/docs", "/swagger-ui/**", "/v3/api-docs/**", "/swagger-resources/**"
    };

    @Autowired
    private JwtAuthFilter jwtAuthFilter;

    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder(10);
    }

    @Bean
    AuthenticationManager authenticationManager(AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }

    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
            .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
            .csrf(csrf -> csrf.disable())
            .cors(cors -> {})
            
            .authorizeHttpRequests(auth -> auth
                .requestMatchers(PUBLIC_ENDPOINTS).permitAll()
                .requestMatchers(HttpMethod.OPTIONS).permitAll()
                .anyRequest().authenticated()
            )
            
            .exceptionHandling(exceptions -> exceptions
                    .authenticationEntryPoint((request, response, authException) -> 
                        response.sendError(HttpServletResponse.SC_UNAUTHORIZED, 
                            "N√£o autorizado - Token JWT ausente ou inv√°lido"))
            )
            
            .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)
            .build();
    }
    
}
```

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_spring/tree/11_Spring_Security" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
