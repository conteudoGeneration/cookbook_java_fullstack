<h1>Projeto 02 - Blog Pessoal - Spring Security - Ecossistema da Seguranﾃｧa - Parte 03</h1>



O que veremos por aqui:

1. A Classe BasicSecurityConfig

Dando continuidade a implementaﾃｧﾃ｣o do **Ecossistema da Seguranﾃｧa**, vamos implementar a ultima Classe com as configuraﾃｧﾃｵes gerais da Spring Security, a Classe **BasicSecurityConfig**.

<br />

<h2>促 Passo 01 - Criar a Classe BasicSecurityConfig</h2>



A **Classe BasicSecurityConfig** ﾃｩ responsﾃ｡vel por sobrescrever a configuraﾃｧﾃ｣o padrﾃ｣o da **Spring Security** e definir como ela irﾃ｡ funcionar. Nesta Classe vamos definir quais serﾃ｣o as formas de autenticaﾃｧﾃ｣o, quais endpoints serﾃ｣o protegidos pelo Token JWT, entre outras configuraﾃｧﾃｵes. Depois da implementaﾃｧﾃ｣o desta Classe, aquela tela de login, que apareceu no Navegador vai ser desativada e uma nova configuraﾃｧﾃ｣o serﾃ｡ definida como padrﾃ｣o.

Vamos criar e implementar a Classe **BasicSecurityConfig**:

1. Clique com o botﾃ｣o direito do mouse sobre o **Pacote Security** (**com.generation.blogpessoal.security**), na Source Folder Principal (**src/main/java**), e clique na opﾃｧﾃ｣o **New ｡ｪ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da Classe (**BasicSecurityConfig**), e na sequﾃｪncia clique no botﾃ｣o **Finish** para concluir.

Vejamos abaixo a implementaﾃｧﾃ｣o da Classe **BasicSecurityConfig**:

<div align="center"><img src="https://i.imgur.com/tsAlsFm.png" title="source: imgur.com" /></div>

**Linha 1:** Atravﾃｩs do comando **package**, estamos informando o nome do pacote (camada), onde a Classe foi criada. Esta informaﾃｧﾃ｣o ﾃｩ inserida automaticamente pelo STS ao criar a Classe.

**Linhas 3 a 20:** Atravﾃｩs do comando **import**, estamos indicando todos os pacotes que contﾃｩm as Classes que estﾃ｣o sendo utilizadas na Classe **BasicSecurityConfig**.

**Linhas 22 e 23:** A Classe **BasicSecurityConfig** possui 2 anotaﾃｧﾃｵes: 

- **@Configuration:** indica que a  Classe ﾃｩ do tipo configuraﾃｧﾃ｣o, ou seja, define uma Classe como fonte de  definiﾃｧﾃｵes de Beans, alﾃｩm de ser uma das anotaﾃｧﾃｵes essenciais ao utilizar uma configuraﾃｧﾃ｣o baseada em Java.
- **@EnableWebSecurity:** habilita a seguranﾃｧa de forma Global (toda a aplicaﾃｧﾃ｣o) e sobrescreve os Mﾃｩtodos que irﾃ｣o redefinir as regras de Seguranﾃｧa da sua aplicaﾃｧﾃ｣o.

> **Bean:** No Spring, os objetos que formam a espinha dorsal da sua aplicaﾃｧﾃ｣o e que sﾃ｣o gerenciados pelo Spring sﾃ｣o chamados de **Beans**. Um Bean ﾃｩ um objeto que ﾃｩ instanciado, montado e gerenciado pelo Spring. 
>
> Existem diversas formas de se criar Beans no Spring. Vocﾃｪ pode criar Classes anotadas com **@Configuration** ou **@Service** para serem gerenciadas pelo Spring, assim como pode usar a anotaﾃｧﾃ｣o **@Bean** em um Mﾃｩtodo, e transformar a instﾃ｢ncia retornada pelo Mﾃｩtodo em um Objeto gerenciado pelo Spring (seja de uma Classe prﾃｳpria ou de terceiros).
>
> Estas Classes, que na visﾃ｣o do Spring sﾃ｣o os Beans, para vocﾃｪ nada mais sﾃ｣o do que Classes que vocﾃｪ irﾃ｡ escrever as regras de funcionamento da sua aplicaﾃｧﾃ｣o, que poderﾃ｣o ser utilizadas em qualquer Classe, diferente da **Injeﾃｧﾃ｣o de Dependﾃｪncia** criada pela anotaﾃｧﾃ｣o **@Autowired**, que sﾃｳ permite o uso dentro da Classe em que foi criada.

<div align="center"><img src="https://i.imgur.com/ojvsmCS.png" title="source: imgur.com" /></div>

**Linhas 24 e 25:** Foi inserida 1 Injeﾃｧﾃ｣o de Dependﾃｪncias da Classe **JwtAuthFilter**, para ter acesso ao Filtro de Servlet JWT.

**Linhas 27 a 31:** Foi implementado o Mﾃｩtodo **userDetailsService**, que retornarﾃ｡ uma instﾃ｢ncia da Classe **UserDetailsServiceImpl**, que implementa a Interface **userDetailsService**. Nﾃｳs utilizaremos este Mﾃｩtodo para validar se o usuﾃ｡rio que estﾃ｡ tentando se autenticar estﾃ｡ persistido no Banco de dados da aplicaﾃｧﾃ｣o.

**Linhas 33 a 37:** Foi implementado o Mﾃｩtodo ***passwordEncoder()***, que retornarﾃ｡ uma instﾃ｢ncia da Classe  **BCryptPasswordEncoder()**, que utiliza o algoritmo de criptografia do tipo **hash**, chamado **BCrypt**. Nﾃｳs utilizaremos este Mﾃｩtodo para Criptografar e Validar a senha do usuﾃ｡rio.

> **Hash** ﾃｩ um algoritmo que transforma dados de comprimento variﾃ｡vel em dados de comprimento fixo codificados.


| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">Dica: No primeiro link abaixo vocﾃｪ pode conhecer mais sobre o algoritmo BCrypt e no segundo link vocﾃｪ pode testar a codificaﾃｧﾃ｣o e a decodificaﾃｧﾃ｣o de Strings geradas atravﾃｩs do algoritmo BCrypt.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://medium.com/reprogramabr/uma-breve-introdu%C3%A7%C3%A3o-sobre-bcrypt-f2fad91a7420" target="_blank"><b>Artigo: <i>Uma breve introduﾃｧﾃ｣o sobre o BCrypt</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://bcrypt-generator.com" target="_blank"><b>Site: <i>Codificador BCrypt</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/password/PasswordEncoder.html" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Interface PasswordEncoder</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/4.2.4.RELEASE/apidocs/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Classe BCryptPasswordEncoder</i></b></a></div>

<br />

<div align="center"><img src="https://i.imgur.com/CIvXyVK.png" title="source: imgur.com" /></div>

**Linhas 38 e 39:** Foi implementado o Mﾃｩtodo **authenticationProvider**, que retornarﾃ｡ uma instﾃ｢ncia da Classe **AuthenticationProvider**, informando o Mﾃｩtodo de autenticaﾃｧﾃ｣o que serﾃ｡ utilizado.

**Linha 40:** Cria um Objeto da Classe **DaoAuthenticationProvider**, chamado **authenticationProvider**. A Classe **DaoAuthenticationProvider** ﾃｩ utilizada para autenticar um Objeto da Classe Usuario atravﾃｩs do usuario (e-mail) e a senha, validando os dados no Banco de dados de aplicaﾃｧﾃ｣o, atravﾃｩs da Classe **UserDetailsServiceImpl**.

**Linha 41:** Adiciona um Objeto da Classe **UserDetailsServiceImpl** atravﾃｩs do Mﾃｩtodo **setUserDetailsService()**, que serﾃ｡ utilizado para validar o **usuario (e-mail)** do Objeto da Classe Usuario.

**Linha 42:** Adiciona um Objeto da Classe **PasswordEncoder** atravﾃｩs do Mﾃｩtodo **setPasswordEncoder()**, que serﾃ｡ utilizado para validar a **senha** do Usuﾃ｡rio.

**Linha 43:** Retorna o Objeto **authenticationProvider**.

<div align="center"><img src="https://i.imgur.com/kVyvuOK.png" title="source: imgur.com" /></div>

**Linhas 46 a 50:** O Mﾃｩtodo ***authenticationManager(AuthenticationConfiguration authenticationConfiguration)***, implementa a confguraﾃｧﾃ｣o de autenticaﾃｧﾃ｣o. Este Mﾃｩtodo utiliza o Mﾃｩtodo ***authenticationConfiguration.getAuthenticationManager()*** para procurar uma implementaﾃｧﾃ｣o da Interface **UserDetailsService** e utilizﾃ｡-la para identificar se o usuﾃ｡rio ﾃｩ vﾃ｡lido ou nﾃ｣o. Em nosso projeto Blog Pessoal, serﾃ｡ utilizada a Classe **UserDetailsServiceImpl**, que valida o usuﾃ｡rio no Banco de dados.

<br />

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/authentication/AuthenticationManager.html" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>AuthenticationManager</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/authentication/configuration/AuthenticationConfiguration.html" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>AuthenticationConfiguration</i></b></a></div>

<br />

<div align="center"><img src="https://i.imgur.com/4I2vmuP.png" title="source: imgur.com" /></div>

**Linhas 54 a 76:** O Mﾃｩtodo ***SecurityFilterChain filterChain(HttpSecurity http)***, estamos informando ao Spring que a configuraﾃｧﾃ｣o  padrﾃ｣o da Spring Security serﾃ｡ substituﾃｭda por uma nova configuraﾃｧﾃ｣o. Nesta configuraﾃｧﾃ｣o iremos customizar a autenticaﾃｧﾃ｣o da aplicaﾃｧﾃ｣o desabilitando o formulﾃ｡rio de login e habilitando a autenticaﾃｧﾃ｣o via HTTP. 

Observe que o Mﾃｩtodo **SecurityFilterChain filterChain(HttpSecurity http)** pode lanﾃｧar (throws) uma Exception de **qualquer tipo da Classe Exception**. Como existem muitas possibilidades, simplificamos chamando a Classe **Exception**, que ﾃｩ a mﾃ｣e de todas as Exceptions.

Em nosso projeto Blog Pessoal, customizamos a nossa configuraﾃｧﾃ｣o em 2 partes:

**Parte 01 - Configuraﾃｧﾃｵes essenciais**

Observe que neste Mﾃｩtodo estamos utilizando Expressﾃｵes Lambda para definirmos todas as configuraﾃｧﾃｵes especﾃｭficas da aplicaﾃｧﾃ｣o. As Expressﾃｵes Lambda utilizadas na configuraﾃｧﾃ｣o da Spring Security sﾃ｣o chamadas de **Lambda DSL (Domain Specific Language -  Linguagem de Domﾃｭnio Especﾃｭfico)**, ou seja, ﾃｩ uma Expressﾃ｣o Lambda explicitamente adaptada para um uso especﾃｭfico na Spring Security, com o objetivo de reduzir a verbosidade do cﾃｳdigo, tornando-o mais limpo.

**Linha 57:** Atravﾃｩs do Objeto **http**, da **Classe HttpSecurity**, vamos configurar a seguranﾃｧa baseada na Web (protocolo HTTP), para todas Requisiﾃｧﾃｵes HTTP enviadas para esta aplicaﾃｧﾃ｣o. Por padrﾃ｣o, serﾃ｡ aplicado a todas as requisiﾃｧﾃｵes que forem recebidas, mas pode ser restringido para apenas alguns endpoints, como veremos abaixo.

**Linhas 58 e 59:** Atravﾃｩs do Mﾃｩtodo **.sessionManagement(management -> management).sessionCreationPolicy(SessionCreationPolicy.STATELESS)**, definiremos que o nosso sistema nﾃ｣o guardarﾃ｡ sessﾃｵes para o cliente. Quando o cliente fizer uma Requisiﾃｧﾃ｣o HTTP, ela deverﾃ｡ ter todas as informaﾃｧﾃｵes necessﾃ｡rias para o servidor atender ﾃ Requisiﾃｧﾃ｣o e a mesma serﾃ｡ finalizada com a Resposta HTTP do servidor. O servidor nunca dependerﾃ｡ de informaﾃｧﾃｵes de Requisiﾃｧﾃｵes HTTP anteriores para processar uma nova Requisiﾃｧﾃ｣o HTTP. 

**Linha 60:** Atravﾃｩs do Mﾃｩtodo **.csrf(csrf -> csrf.disable())**, iremos desabilitar a proteﾃｧﾃ｣o que vem ativa contra ataques do tipo **CSRF (Cross-Site-Request-Forgery)**, que seria uma interceptaﾃｧﾃ｣o dos dados de autenticaﾃｧﾃ｣o antes da Requisiﾃｧﾃ｣o chegar ao servidor. Esta configuraﾃｧﾃ｣o foi desabilitada porquﾃｪ o Spring Security fica procurando por um *parﾃ｢metro oculto adicional* em **qualquer** requisiﾃｧﾃ｣o do tipo **POST / PUT / DELETE**, chamado **Token CSRF**. Como ele nﾃ｣o vai encontrar, todas as requisiﾃｧﾃｵes diferentes de **GET** seriam bloqueadas.

**Linha 61:** Atravﾃｩs do Mﾃｩtodo **.cors(*withDefaults*())**, vamos liberar o acesso de outras origens (Requisiﾃｧﾃｵes de outros servidores HTTP), desta forma nossa aplicaﾃｧﾃ｣o poderﾃ｡ ser acessada por outros domﾃｭnios, ou seja, de outros endereﾃｧos, alﾃｩm do endereﾃｧo onde a aplicaﾃｧﾃ｣o estﾃ｡ hospedada.  O Mﾃｩtodo **.withDefaults()** inicializa o CORS seguindo os padrﾃｵes fornecidos pela Spring Security.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATENﾃﾃグ:** *Caso o Mﾃｩtodo .withDefaults() nﾃ｣o seja reconhecido, verifique se a linha destacada na imagem abaixo foi importada na Classe BasicSecurityConfig.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="center"><img src="https://i.imgur.com/k5FldbA.png" title="source: imgur.com" /></div>

<br />

> **Entendendo o CORS**
>
> Enquanto vocﾃｪ estiver rodando o Back-end e o Front-end Localmente (localhost), nﾃ｣o haverﾃ｡ nenhum problema, como mostra a imagem abaixo:
>
> <div align="center"><img src="https://i.imgur.com/3xYVwLt.png" title="source: imgur.com" /></div>
>
> Todas as Requisiﾃｧﾃｵes tem como origem o mesmo Servidor (localhost). Agora ao efetuar o Deploy, o seu Front-end estarﾃ｡ em um Servidor e o seu Back-end estarﾃ｡ em outro:
>
> <div align="center"><img src="https://i.imgur.com/KKWo2Kv.png" title="source: imgur.com" /></div>
>
> No exemplo acima, o Front-end estﾃ｡ em um servidor diferente do Back-end, logo quando o Front-end enviar uma Requisiﾃｧﾃ｣o para o Back-end, vocﾃｪ receberﾃ｡ uma mensagem de erro de CORS. Para evitar este erro e permitir o recebimento de Requisiﾃｧﾃｵes HTTP de outras origens (servidores), habilitamos o CORS em todas as Classes Controladoras da aplicaﾃｧﾃ｣o e na Classe **BasicSecurityConfig**.
>
> <div align="center"><img src="https://i.imgur.com/GFqpXeG.png" title="source: imgur.com" /></div>
>
> Com o CORS habilitado, nosso Back-end estarﾃ｡ pronto para receber Requisiﾃｧﾃｵes do Front-end.

<br />

**Linha 63:** Atravﾃｩs do Objeto **http**, da **Classe HttpSecurity**, vamos criar a Expressﾃ｣o Lambda para configurar a autenticaﾃｧﾃ｣o da nossa aplicaﾃｧﾃ｣o.

**Linha 64:** Atravﾃｩs do Mﾃｩtodo **.authorizeHttpRequests((auth) -> auth)**, vamos implementar a Expressﾃ｣o Lambda para definir quais endpoints poderﾃ｣o acessar o sistema sem precisar de autenticaﾃｧﾃ｣o. O Objeto **auth** recebe o endereﾃｧo (URI) da Requisiﾃｧﾃ｣o e checa se o endpoint necessita ou nﾃ｣o de autenticaﾃｧﾃ｣o.

**Linhas 65 e 66:** Atravﾃｩs dos Mﾃｩtodos **.requestMatchers("/usuarios/logar").permitAll() e .requestMatchers("/usuarios/cadastrar").permitAll()**, indicaremos os endereﾃｧos (URI) dos endpoints, que estarﾃ｣o acessﾃｭveis sem autenticaﾃｧﾃ｣o. No projeto Blog Pessoal foi definido que apenas os endpoints **logar e cadastrar** serﾃ｣o livres de autenticaﾃｧﾃ｣o. 

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="250px"/> | <div align="left"> **ATENﾃﾃグ:** *Os endpoints cadastrar e logar foram liberados porquﾃｪ caso contrﾃ｡rio ninguﾃｩm conseguirﾃ｡ acessar a aplicaﾃｧﾃ｣o.* Os endereﾃｧos dos endpoints: /usuarios/logar e /usuarios/cadastrar devem estar obrigatoriamente definidos na implementaﾃｧﾃ｣o da Classe UsuarioController.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 67:** Atravﾃｩs do Mﾃｩtodo <img src="https://i.imgur.com/sbalAQm.png" title="source: imgur.com" width="45%"/>, o parﾃ｢metro <img src="https://i.imgur.com/mDl6vKk.png" title="source: imgur.com" width="13%"/> permite que as Exceptions lanﾃｧadas atravﾃｩs do comando **throw** sejam lanﾃｧadas. Sem esta linha, a Exception lanﾃｧada no Mﾃｩtodo **atualizarUsuario()**, quando vocﾃｪ tenta atualizar o atributo **usuario** com um e-mail que pertence a outro usuﾃ｡rio, nﾃ｣o serﾃ｡ lanﾃｧada. Ao invﾃｩs de lanﾃｧar a Exception, serﾃ｡ retornado o HTTP Status acesso negado (**UNAUTHORIZED ｡ｪ 401**), mesmo com o Token JWT sendo vﾃ｡lido.

**Linha 68:** Atravﾃｩs do Mﾃｩtodo **.requestMatchers(HttpMethod.OPTIONS).permitAll()**, o parﾃ｢metro **HttpMethod.OPTIONS** permite que o cliente (front-end), possa descobrir quais sﾃ｣o as opﾃｧﾃｵes permitidas e/ou obrigatﾃｳrias no cabeﾃｧalho da Requisiﾃｧﾃ｣o HTTP. Se o parﾃ｢metro **HttpMethod.OPTIONS** nﾃ｣o for liberado, a aplicaﾃｧﾃ｣o nﾃ｣o receberﾃ｡ o **Token JWT** atravﾃｩs do Cabeﾃｧalho da Requisiﾃｧﾃ｣o (Header), impedindo a aplicaﾃｧﾃ｣o de responder as Requisiﾃｧﾃｵes protegidas.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ATENﾃﾃグ:** *Liberar o parﾃ｢metro HttpMethod.OPTIONS de autenticaﾃｧﾃ｣o ﾃｩ essencial para o correto funcionamento do aplicaﾃｧﾃ｣o na nuvem, em especial na integraﾃｧﾃ｣o com o front-end. Sem essa configuraﾃｧﾃ｣o as requisiﾃｧﾃｵes do front-end nﾃ｣o serﾃ｣o autorizadas.*</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 69:** Atravﾃｩs do Mﾃｩtodo **.anyRequest().authenticated()**, informamos ao sistema que todos os endpoints que nﾃ｣o estiverem especificados na lista acima, a autenticaﾃｧﾃ｣o serﾃ｡ obrigatﾃｳria.

**Linha 70:** Atravﾃｩs do Mﾃｩtodo **.authenticationProvider(authenticationProvider())**, chamamos o Mﾃｩtodo **autheticationProvider()**, para efetuar a autenticaﾃｧﾃ｣o do usuﾃ｡rio, atravﾃｩs do Banco de dados.

**Linha 71:** Atravﾃｩs do Mﾃｩtodo **.addFilterBefore(authFilter, UsernamePasswordAuthenticationFilter.class)**, informamos que o Filtro de Servlet **JwtAuthFilter**, deve ser aplicado antes de efetuar a autenticaﾃｧﾃ｣o do usuﾃ｡rio, para validar a existﾃｪncia de um Token JWT na requisiﾃｧﾃ｣o HTTP. Neste momento, existem 2 posibilidades:

1. Se houver um Token JWT, o Filtro de Servlet JwtAuthFilter farﾃ｡ a validaﾃｧﾃ｣o;
2. Se nﾃ｣o houver um Token, o processo de autenticaﾃｧﾃ｣o do usuﾃ｡rio e geraﾃｧﾃ｣o do Token, seguirﾃ｡ o seu fluxo.

**Linha 72:** Atravﾃｩs do Mﾃｩtodo **.httpBasic(*withDefaults*())**, informamos ao sistema que o servidor irﾃ｡ receber requisiﾃｧﾃｵes que devem ter o esquema HTTP Basic de autenticaﾃｧﾃ｣o. O Mﾃｩtodo **.withDefaults()** inicializa o esquema de autenticaﾃｧﾃ｣o HTTP Basic seguindo os padrﾃｵes fornecidos pela Spring Security.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATENﾃﾃグ:** *Caso o Mﾃｩtodo .withDefaults() nﾃ｣o seja reconhecido, verifique se a linha destacada na imagem abaixo foi importada na Classe BasicSecurityConfig.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="center"><img src="https://i.imgur.com/k5FldbA.png" title="source: imgur.com" /></div>

<br />

Ao abrir a sua aplicaﾃｧﾃ｣o no navegador da Internet, ao invﾃｩs de abrir o formulﾃ｡rio que foi exibido ao habilitar a Spring Security, serﾃ｡ aberta a janela abaixo:

 <div align="center"><img src="https://i.imgur.com/mBRxYd8.png" title="source: imgur.com" width="50%"/></div>

**Linha 74:** Atravﾃｩs do Mﾃｩtodo **return http.build()**, o Objeto **http** com as configuraﾃｧﾃｵes implementadas serﾃ｡ instanciado.

<br />

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>HttpSecurity</i></b></a></div>

<div align="left"><img src=https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://spring.io/blog/2019/11/21/spring-security-lambda-dsl" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Expressﾃｵes Lambda DSL</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Authentication" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Basic Authentication</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/CORS" target="_blank"><b>Documentaﾃｧﾃ｣o: CORS</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://reflectoring.io/complete-guide-to-csrf/" target="_blank"><b>Artigo: Complete Guide to CSRF/XSRF (Cross-Site Request Forgery)</b></a></div>

<br />

Para concluir, nﾃ｣o esqueﾃｧa de Salvar o cﾃｳdigo (**File ｡ｪ Save All**).

A Implementaﾃｧﾃ｣o completa da **Classe BasicSecurityConfig**, vocﾃｪ confere abaixo:

```java
package com.generation.blogpessoal.security;

import static org.springframework.security.config.Customizer.withDefaults;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@Configuration
@EnableWebSecurity
public class BasicSecurityConfig {

    @Autowired
    private JwtAuthFilter authFilter;

    @Bean
    UserDetailsService userDetailsService() {

        return new UserDetailsServiceImpl();
    }

    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    AuthenticationProvider authenticationProvider() {
        DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider();
        authenticationProvider.setUserDetailsService(userDetailsService());
        authenticationProvider.setPasswordEncoder(passwordEncoder());
        return authenticationProvider;
    }

    @Bean
    AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration)
            throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }

    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

    	http
	        .sessionManagement(management -> management
	                .sessionCreationPolicy(SessionCreationPolicy.STATELESS))
	        		.csrf(csrf -> csrf.disable())
	        		.cors(withDefaults());

    	http
	        .authorizeHttpRequests((auth) -> auth
	                .requestMatchers("/usuarios/logar").permitAll()
	                .requestMatchers("/usuarios/cadastrar").permitAll()
	                .requestMatchers("/error/**").permitAll()
	                .requestMatchers(HttpMethod.OPTIONS).permitAll()
	                .anyRequest().authenticated())
	        .authenticationProvider(authenticationProvider())
	        .addFilterBefore(authFilter, UsernamePasswordAuthenticationFilter.class)
	        .httpBasic(withDefaults());

		return http.build();

    }

}
```

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_v3/tree/13_Spring_Security" target="_blank"><b>Cﾃｳdigo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
