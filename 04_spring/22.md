<h1>Teste de Software com JUnit 5 - Configurando o Ambiente de testes</h1>



Este conteÃºdo apresenta, de forma prÃ¡tica e objetiva, os passos necessÃ¡rios para configurar o ambiente de testes em um projeto **Spring Boot**, utilizando **JUnit 5** e o banco de dados em memÃ³ria **H2**.

<br />


<h2>ğŸ‘£ Passo 01 - ConfiguraÃ§Ãµes das DependÃªncias</h2>



Neste passo, vamos **ajustar a dependÃªncia** `spring-boot-starter-test` (adicionada automaticamente na criaÃ§Ã£o do projeto) e **incluir** a dependÃªncia do banco de dados em memÃ³ria **H2** para uso nos testes.

<br />

<h3>1. Configurar a DependÃªncia Spring Testing</h3>



O objetivo deste passo Ã© garantir que o projeto utilize **apenas o JUnit 5** nos testes e remover bibliotecas que nÃ£o serÃ£o utilizadas.

No arquivo `pom.xml`, **localize** a dependÃªncia original:

```xml
	<dependency>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-test</artifactId>
		<scope>test</scope>
	</dependency>
```

E **Substitua pelo trecho de cÃ³digo abaixo:**

```xml
		<dependency>
	    	<groupId>org.springframework.boot</groupId>
	    	<artifactId>spring-boot-starter-test</artifactId>
	    	<scope>test</scope>
	    	<exclusions>
	    		<exclusion>
	    			<groupId>org.junit.vintage</groupId>
	    			<artifactId>junit-vintage-engine</artifactId>
	    		</exclusion>
	    		<exclusion>
            		<groupId>org.mockito</groupId>
            		<artifactId>mockito-core</artifactId>
        		</exclusion>
	    	</exclusions>
	    </dependency>
```
A exclusÃ£o do **`junit-vintage-engine`** Ã© recomendada pela prÃ³pria documentaÃ§Ã£o do Spring Boot para evitar conflitos entre o JUnit 4 (Vintage) e o JUnit 5 (Jupiter).

A exclusÃ£o do **`mockito-core`** remove o Mockito, que nÃ£o serÃ¡ utilizado neste projeto, evitando o carregamento desnecessÃ¡rio de bibliotecas e eliminando os avisos de *Java Agent* exibidos durante a execuÃ§Ã£o dos testes.

<br />

<h3>2. Adicionar a DependÃªncia do Banco de Dados H2</h3>



Para utilizar o banco de dados **H2** nos testes do projeto, Ã© necessÃ¡rio incluir a dependÃªncia no arquivo `pom.xml`. Adicione o seguinte bloco de cÃ³digo:

```xml
<!-- DependÃªncia do Banco de dados H2 -->
<dependency>
	<groupId>com.h2database</groupId>
	<artifactId>h2</artifactId>
	<scope>test</scope>
</dependency>
```

insira esta dependÃªncia logo abaixo da dependÃªncia do MySQL para manter a organizaÃ§Ã£o do `pom.xml`.

ğŸ’¾ **Salve as alteraÃ§Ãµes antes de prosseguir ( File ğŸ¡ª Save All )!**

<br />

<h2>ğŸ‘£ Passo 02 - Configurar a Source Folder src/test/resources</h2>



Agora vamos configurar o banco de dados **H2** para que os testes sejam executados sem impactar o banco de dados principal da aplicaÃ§Ã£o.

Como o projeto ainda nÃ£o possui a pasta **resources** dentro da source folder de testes (`src/test`), vamos criÃ¡-la e, em seguida, adicionar o arquivo `application.properties` para configurar o **banco de dados de testes (H2)**.

<br />

> [!IMPORTANT]
>
> A configuraÃ§Ã£o serÃ¡ feita **somente** no diretÃ³rio de testes (`src/test/resources`), garantindo que o H2 seja utilizado apenas durante a execuÃ§Ã£o dos testes automatizados.

<br />

1) No lado esquerdo superior, na Guia **Package Explorer**, clique sobre a pasta do projeto com o botÃ£o direito do mouse e clique na opÃ§Ã£o **New ğŸ¡ª Source folder**

<div align="center"><img src="https://i.imgur.com/HPjOwdn.png" title="source: imgur.com" width="85%"/></div>

2) Em **Source Folder**, no item **Folder name**, informe o caminho como mostra a figura abaixo (**src/test/resources**), e clique em **Finish**:

<div align="center"><img src="https://i.imgur.com/bHilbvh.png" title="source: imgur.com" /></div>

3. Note que a Source Folder **src/test/resources** foi criada: 

<div align="center"><img src="https://i.imgur.com/tgLKBsI.png" title="source: imgur.com" /></div>

<br />

> <h2>âŒ Erro ao criar a Source Folder src/test/resources</h2>
>
> 
>
> Se durante o processo de criaÃ§Ã£o da **Source Folder** `src/test/resources` aparecer a mensagem de erro **The folder is already a source folder.**, como vemos na imagem abaixo, significa que vocÃª estÃ¡ tentando adicionar  uma pasta como Source Folder do projeto, mas ela jÃ¡ estÃ¡ configurada como tal no projeto.
>
> <div align="center"><img src="https://i.imgur.com/htzQbY2.png" title="source: imgur.com" width="65%"/></div>
>
> Este erro pode acontecer nas seguintes situaÃ§Ãµes:
>
> - Ao tentar adicionar manualmente (pelo STS) uma pasta jÃ¡ listada no `build path` do projeto, que pode nÃ£o ter sido criada fisicamente, que pode ter sido excluÃ­da do projeto ou simplesmente ignorada nas configuraÃ§Ãµes do projeto;
> - Quando a mesma pasta estÃ¡ configurada duas vezes no `build path`;
> - Se o `pom.xml` estÃ¡ tentando redefinir algo que jÃ¡ foi configurado na IDE.
>
> Para resolver este problema, vamos seguir os passos abaixo:
>
> 1. Na **Guia Package Explorer**, clique com o botÃ£o direito do mouse na pasta do **Projeto Blog Pessoal** e no menu que serÃ¡ aberto, clique na opÃ§Ã£o **Buld Path ğŸ¡² Configure Build Path...**
>
> <div align="center"><img src="https://i.imgur.com/lK8vtAy.png" title="source: imgur.com" /></div>
>
> 2. SerÃ¡ aberta a janela **Properties for blogpessoal**:
>
> <div align="center"><img src="https://i.imgur.com/3Ocmgt2.png" title="source: imgur.com" /></div>
>
> 3. Clique na **Guia Source** e localize a pasta `blogpessoal/src/test/resources`
>
> <div align="center"><img src="https://i.imgur.com/LhReU52.png" title="source: imgur.com" /></div>
>
> 4. Observe que ela estarÃ¡ com um **X** na cor vermelha e a palavra **missing** entre parÃªnteses, indicando que ela nÃ£o estÃ¡ presente no projeto.
>
> <div align="center"><img src="https://i.imgur.com/jVxq95M.png" title="source: imgur.com" /></div>
>
> 5. Abra as opÃ§Ãµes da pasta, localize e selecione a propriedade **Excluded**, e na sequÃªncia clique no botÃ£o **Remove**, para limpar os valores atuais da propriedade.
>
> <div align="center"><img src="https://i.imgur.com/X8oR98K.png" title="source: imgur.com" /></div>
>
> A propriedade **Excluded** indica que a pasta estava sendo ignorada pelo projeto, ou seja, mesmo que ela existisse o Java  e o Spring iriam ignorar a sua existÃªncia. 
>
> 6. Observe que a propriedade **Excluded** estarÃ¡ com o valor **(None)**, como mostra a imagem abaixo:
>
> <div align="center"><img src="https://i.imgur.com/FjczgxF.png" title="source: imgur.com" /></div>
>
> 7. Depois de aplicar a alteraÃ§Ã£o, note que a pasta serÃ¡ automaticamente exibida na **Guia Package Explorer**, como mostra a imagem abaixo:
>
> <div align="center"><img src="https://i.imgur.com/tgLKBsI.png" title="source: imgur.com" /></div>

<br />

<h2>ğŸ‘£ Passo 03 - Configurar o Banco de dados H2</h2>



ApÃ³s criarmos a Source Folder **src/test/resources**, vamos criar o arquivo **application.properties**, onde vamos adicionar as configuraÃ§Ãµes necessÃ¡rias para conectar com o Banco de dados H2:

1. No lado esquerdo superior, na Guia **Package explorer**, na Source Folder **src/test/resources**, clique com o botÃ£o direito do mouse e clique na opÃ§Ã£o **New ğŸ¡ª File**.
2. No item **File name**, digite o nome do arquivo (**application.properties**) e clique em **Finish**. 

<div align="center"><img src="https://i.imgur.com/VSZCPTR.png" title="source: imgur.com" /></div>

3. Veja o arquivo criado na  **Package Explorer**:

<div align="center"><img src="https://i.imgur.com/vpbrBCc.png" title="source: imgur.com" /></div>

4. Insira no arquivo **application.properties** criado em **src/test/resources** o cÃ³digo abaixo, para configurar o Banco de dados H2:

```properties
spring.datasource.url=jdbc:h2:mem:test;MODE=MySQL
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=sa
```
<br />

| Linha                                   | DescriÃ§Ã£o                                                    |
| --------------------------------------- | ------------------------------------------------------------ |
| **spring.datasource.url**               | Informa a URL de conexÃ£o com o banco de dados. Aqui usamos o **H2** no modo **memÃ³ria** (`mem:test`), o que significa que o banco sÃ³ existe enquanto a aplicaÃ§Ã£o estiver rodando. O parÃ¢metro `MODE=MySQL` faz o H2 imitar o MySQL, facilitando testes se vocÃª usa MySQL em produÃ§Ã£o. |
| **spring.datasource.driver-class-name** | Indica qual **driver JDBC** serÃ¡ usado para conectar ao banco. No caso do H2, Ã© o `org.h2.Driver`. |
| **spring.datasource.username**          | Define o **usuÃ¡rio** de acesso ao banco. `sa` Ã© o usuÃ¡rio padrÃ£o do H2. |
| **spring.datasource.password**          | Define a **senha** do usuÃ¡rio. TambÃ©m Ã© `sa` por padrÃ£o no H2. Em ambientes reais, use senhas mais seguras. |

<br />

ğŸ’¾ **Salve as alteraÃ§Ãµes antes de prosseguir ( File ğŸ¡ª Save All )!**

<br />

<h2>ğŸ‘£ Passo 04 - Criar os pacotes controller e util em src/test/java</h2>



Na Source Folder de Testes (**src/test/java**), observe que existe a mesma estrutura de pacotes da Source Folder Principal (**src/main/java**). 

<div align="center"><img src="https://i.imgur.com/SkJ4D76.png" title="source: imgur.com" width="45%"/></div>

Vamos criar os pacotes `controller` e `util` dentro da Source Folder `src/test/java`, seguindo a estrutura do pacote principal.

1. No lado esquerdo superior, na Guia **Package explorer**, clique com o botÃ£o direito do mouse sobre o package **com.generation.blogpessoal**, na Source Folder **src/test/java** e clique na opÃ§Ã£o  **New ğŸ¡ª Package**.

2. Na janela **New Java Package**, no item **Name**, acrescente no final do nome do pacote **.controller**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/uso8FfA.png" title="source: imgur.com" /></div>

3. Clique no botÃ£o **Finish** para concluir.

4. O Resultado vocÃª confere na imagem abaixo:


<div align="center"><img src="https://i.imgur.com/EarBjJP.png" title="source: imgur.com" width="45%"/></div>

5. No lado esquerdo superior, na Guia **Package explorer**, clique com o botÃ£o direito do mouse sobre o package **com.generation.blogpessoal**, na Source Folder **src/test/java** e clique na opÃ§Ã£o  **New ğŸ¡ª Package**.
6. Na janela **New Java Package**, no item **Name**, acrescente no final do nome do pacote **.util**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/Mhx4IMD.png" title="source: imgur.com" /></div>

7. Clique no botÃ£o **Finish** para concluir.
8. O Resultado vocÃª confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/nYl4hpL.png" title="source: imgur.com" width="45%"/></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_spring/tree/12_Testes" target="_blank"><b>CÃ³digo fonte do projeto</b></a></div>

<br /><br />
	

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
