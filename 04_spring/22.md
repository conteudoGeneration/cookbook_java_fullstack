<h1>Teste de Software com JUnit 5 - Configurando o Ambiente de testes</h1>

<br />

Este conteÃºdo apresenta, de forma prÃ¡tica e objetiva, os passos necessÃ¡rios para configurar o ambiente de testes em um projeto Spring Boot utilizando JUnit 5 e o Banco de dados em memÃ³ria H2.

<br />


<h2>ğŸ‘£ Passo 01 - ConfiguraÃ§Ãµes das DependÃªncias</h2>

Neste passo vamos configurar a DependÃªncia Spring Boot Starter Test (adicionada na criaÃ§Ã£o do projeto) e adicionar a DependÃªncia do Banco de dados em memÃ³ria H2.

<h3>1. Configurar a DependÃªncia Spring Testing</h3>

Vamos Configurar a DependÃªncia Spring Boot Starter Test para permitir cÃ³digos criados  apenas com **JUnit versÃ£o 5**. No arquivo, **pom.xml**, vamos **substituir** a dependÃªncia **Spring Boot Starter Test**:

**Localize as linhas abaixo:**

```xml
	<dependency>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-test</artifactId>
		<scope>test</scope>
	</dependency>
```

**Substitua por:**

```xml
    <dependency>
    	<groupId>org.springframework.boot</groupId>
    	<artifactId>spring-boot-starter-test</artifactId>
    	<scope>test</scope>
    	<exclusions>
    		<exclusion>
    			<groupId>org.junit.vintage</groupId>
    			<artifactId>junit-vintage-engine</artifactId>
    		</exclusion>
    	</exclusions>
    </dependency>
```
A exclusÃ£o do `junit-vintage-engine` evita conflitos entre JUnit 4 e JUnit 5. Essa exclusÃ£o Ã© recomendada na documentaÃ§Ã£o oficial do Spring Boot.

<br />

<h3>2. Adicionar a DependÃªncia do Banco de Dados H2</h3>

Para utilizar o Banco de dados H2 no seu projeto serÃ¡ necessÃ¡rio inserir a DependÃªncia no seu arquivo **pom.xml**. No arquivo, **pom.xml**, vamos adicionar as linhas abaixo:

```xml
<!-- DependÃªncia do Banco de dados H2 -->
<dependency>
	<groupId>com.h2database</groupId>
	<artifactId>h2</artifactId>
	<scope>test</scope>
</dependency>
```

*Sugerimos adicionar esta dependÃªncia logo abaixo da dependÃªncia do MySQL.

Para concluir, nÃ£o esqueÃ§a de Salvar o cÃ³digo (**File ğŸ¡ª Save All**).

<br />

<h2>ğŸ‘£ Passo 02 - Configurar a Source Folder src/test/resources</h2>

Agora vamos configurar o Banco de dados H2 para executar os nossos testes sem alterar o Banco de dados principal da aplicaÃ§Ã£o. Como nÃ£o temos em nosso projeto a pasta **resources**, dentro da **Source Folder src/test**, vamos criar a pasta e na sequÃªncia inserir o arquivo **application.properties** para configurarmos o Banco de dados de testes (H2). 

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <p align="justify"> **ATENÃ‡ÃƒO:** *A configuraÃ§Ã£o do Banco de dados H2 serÃ¡ feita na Source Folder Testes (src/test). Mantenha atenÃ§Ã£o aos detalhes para nÃ£o errar na configuraÃ§Ã£o.* </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

1) No lado esquerdo superior, na Guia **Package Explorer**, clique sobre a pasta do projeto com o botÃ£o direito do mouse e clique na opÃ§Ã£o **New ğŸ¡ª Source folder**

<div align="center"><img src="https://i.imgur.com/HPjOwdn.png" title="source: imgur.com" width="85%"/></div>

2) Em **Source Folder**, no item **Folder name**, informe o caminho como mostra a figura abaixo (**src/test/resources**), e clique em **Finish**:

<div align="center"><img src="https://i.imgur.com/bHilbvh.png" title="source: imgur.com" /></div>

3. Note que a Source Folder **src/test/resources** foi criada: 

<div align="center"><img src="https://i.imgur.com/tgLKBsI.png" title="source: imgur.com" /></div>

<br />

> <h2>âŒ Erro ao criar a Source Folder src/test/resources</h2>
>
> 
>
> Se durante o processo de criaÃ§Ã£o da **Source Folder** `src/test/resources` aparecer a mensagem de erro **The folder is already a source folder.**, como vemos na imagem abaixo, significa que vocÃª estÃ¡ tentando adicionar  uma pasta como Source Folder do projeto, mas ela jÃ¡ estÃ¡ configurada como tal no projeto.
>
> <div align="center"><img src="https://i.imgur.com/htzQbY2.png" title="source: imgur.com" width="65%"/></div>
>
> Este erro pode acontecer nas seguintes situaÃ§Ãµes:
>
> - Ao tentar adicionar manualmente (pelo STS) uma pasta jÃ¡ listada no `build path` do projeto, que pode nÃ£o ter sido criada fisicamente, que pode ter sido excluÃ­da do projeto ou simplesmente ignorada nas configuraÃ§Ãµes do projeto;
> - Quando a mesma pasta estÃ¡ configurada duas vezes no `build path`;
> - Se o `pom.xml` estÃ¡ tentando redefinir algo que jÃ¡ foi configurado na IDE.
>
> Para resolver este problema, vamos seguir os passos abaixo:
>
> 1. Na **Guia Package Explorer**, clique com o botÃ£o direito do mouse na pasta do **Projeto Blog Pessoal** e no menu que serÃ¡ aberto, clique na opÃ§Ã£o **Buld Path ğŸ¡² Configure Build Path...**
>
> <div align="center"><img src="https://i.imgur.com/lK8vtAy.png" title="source: imgur.com" /></div>
>
> 2. SerÃ¡ aberta a janela **Properties for blogpessoal**:
>
> <div align="center"><img src="https://i.imgur.com/3Ocmgt2.png" title="source: imgur.com" /></div>
>
> 3. Clique na **Guia Source** e localize a pasta `blogpessoal/src/test/resources`
>
> <div align="center"><img src="https://i.imgur.com/LhReU52.png" title="source: imgur.com" /></div>
>
> 4. Observe que ela estarÃ¡ com um **X** na cor vermelha e a palavra **missing** entre parÃªnteses, indicando que ela nÃ£o estÃ¡ presente no projeto.
>
> <div align="center"><img src="https://i.imgur.com/jVxq95M.png" title="source: imgur.com" /></div>
>
> 5. Abra as opÃ§Ãµes da pasta, localize e selecione a propriedade **Excluded**, e na sequÃªncia clique no botÃ£o **Remove**, para limpar os valores atuais da propriedade.
>
> <div align="center"><img src="https://i.imgur.com/X8oR98K.png" title="source: imgur.com" /></div>
>
> A propriedade **Excluded** indica que a pasta estava sendo ignorada pelo projeto, ou seja, mesmo que ela existisse o Java  e o Spring iriam ignorar a sua existÃªncia. 
>
> 6. Observe que a propriedade **Excluded** estarÃ¡ com o valor **(None)**, como mostra a imagem abaixo:
>
> <div align="center"><img src="https://i.imgur.com/FjczgxF.png" title="source: imgur.com" /></div>
>
> 7. Depois de aplicar a alteraÃ§Ã£o, note que a pasta serÃ¡ automaticamente exibida na **Guia Package Explorer**, como mostra a imagem abaixo:
>
> <div align="center"><img src="https://i.imgur.com/tgLKBsI.png" title="source: imgur.com" /></div>

<br />

<h2>ğŸ‘£ Passo 03 - Configurar o Banco de dados H2</h2>

ApÃ³s criarmos a Source Folder **src/test/resources**, vamos criar o arquivo **application.properties**, onde vamos adicionar as configuraÃ§Ãµes necessÃ¡rias para conectar com o Banco de dados H2:

1. No lado esquerdo superior, na Guia **Package explorer**, na Source Folder **src/test/resources**, clique com o botÃ£o direito do mouse e clique na opÃ§Ã£o **New ğŸ¡ª File**.
2. No item **File name**, digite o nome do arquivo (**application.properties**) e clique em **Finish**. 

<div align="center"><img src="https://i.imgur.com/VSZCPTR.png" title="source: imgur.com" /></div>

3. Veja o arquivo criado na  **Package Explorer**:

<div align="center"><img src="https://i.imgur.com/vpbrBCc.png" title="source: imgur.com" /></div>

4. Insira no arquivo **application.properties** criado em **src/test/resources** o cÃ³digo abaixo, para configurar o Banco de dados H2:

```properties
spring.datasource.url=jdbc:h2:mem:test;MODE=MySQL
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=sa
```
<br />

| Linha                                   | DescriÃ§Ã£o                                                    |
| --------------------------------------- | ------------------------------------------------------------ |
| **spring.datasource.url**               | Define que o Banco de dados serÃ¡ gerado em memÃ³ria (mem) e se chamarÃ¡ test.<br />A opÃ§Ã£o MODE=MySQL farÃ¡ com que o Banco de dados H2 se comporte como o MySQL. Desta forma teremos uma maior compatibilidade com o Banco de dados principal (MySQL). |
| **spring.datasource.driver-Class-Name** | Define o Driver do Banco de dados (H2)                       |
| **spring.datasource.username**          | Define o usuÃ¡rio do H2 (sa)                                  |
| **spring.datasource.password**          | Define a senha do usuÃ¡rio do H2 (sa)                         |

<br />

Para concluir, nÃ£o esqueÃ§a de Salvar o cÃ³digo (**File ğŸ¡ª Save All**).

<br />

<h2>ğŸ‘£ Passo 04 - Criar os pacotes controller e util em src/test/java</h2>



Na Source Folder de Testes (**src/test/java**), observe que existe a mesma estrutura de pacotes da Source Folder Principal (**src/main/java**). 

<div align="center"><img src="https://i.imgur.com/SkJ4D76.png" title="source: imgur.com" width="45%"/></div>

Vamos criar os pacotes `controller` e `util` dentro da Source Folder `src/test/java`, seguindo a estrutura do pacote principal.

1. No lado esquerdo superior, na Guia **Package explorer**, clique com o botÃ£o direito do mouse sobre o package **com.generation.blogpessoal**, na Source Folder **src/test/java** e clique na opÃ§Ã£o  **New ğŸ¡ª Package**.

2. Na janela **New Java Package**, no item **Name**, acrescente no final do nome do pacote **.controller**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/uso8FfA.png" title="source: imgur.com" /></div>

3. Clique no botÃ£o **Finish** para concluir.

4. O Resultado vocÃª confere na imagem abaixo:


<div align="center"><img src="https://i.imgur.com/EarBjJP.png" title="source: imgur.com" width="45%"/></div>

5. No lado esquerdo superior, na Guia **Package explorer**, clique com o botÃ£o direito do mouse sobre o package **com.generation.blogpessoal**, na Source Folder **src/test/java** e clique na opÃ§Ã£o  **New ğŸ¡ª Package**.
6. Na janela **New Java Package**, no item **Name**, acrescente no final do nome do pacote **.util**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/Mhx4IMD.png" title="source: imgur.com" /></div>

7. Clique no botÃ£o **Finish** para concluir.
8. O Resultado vocÃª confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/nYl4hpL.png" title="source: imgur.com" width="45%"/></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_v3/tree/15_Ambiente_Testes" target="_blank"><b>CÃ³digo fonte do projeto</b></a></div>

<br /><br />
	

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
