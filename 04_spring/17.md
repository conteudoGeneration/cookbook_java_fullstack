<h1>Projeto 02 - Blog Pessoal - Spring Security - Ecossistema da Seguran√ßa - Parte 01</h1>



**O que veremos por aqui:**

1. O Ecossistema da Seguran√ßa
2. A classe UserDetailsImpl
3. A classe UserDetailsServiceImpl

Antes de finalizarmos o Ecossistema do Usu√°rio, vamos compreender e implementar o **Ecossistema da Seguran√ßa**, pois utilizaremos alguns de seus m√©todos durante a constru√ß√£o das **classes UsuarioService e UsuarioController**.

<br />

<h2>1.  Ecossistema da Seguran√ßa</h2>



O Ecossistema da Seguran√ßa √© respons√°vel por realizar a autentica√ß√£o e autoriza√ß√£o de usu√°rios com base nas credenciais armazenadas em um banco de dados. Para isso, √© necess√°rio que o usu√°rio envie seu e-mail e senha. O Spring Security validar√° essas informa√ß√µes, verificar√° as permiss√µes e, se estiver tudo correto, gerar√° um **Token JWT (JSON Web Token)**.

Esse token dever√° ser inclu√≠do no cabe√ßalho das requisi√ß√µes HTTP subsequentes, permitindo o acesso seguro aos endpoints protegidos da aplica√ß√£o.

O ecossistema da seguran√ßa √© composto por cinco classes principais:

- **UserDetailsServiceImpl**: localiza e retorna os dados do usu√°rio no banco de dados, implementando a interface `UserDetailsService`.
- **UserDetailsImpl**: representa os dados do usu√°rio autenticado, implementando a interface `UserDetails`.
- **JwtService**: realiza a gera√ß√£o, valida√ß√£o e extra√ß√£o de informa√ß√µes do token JWT.
- **JwtAuthFilter**: intercepta as requisi√ß√µes HTTP, valida o token e autentica o usu√°rio no contexto da aplica√ß√£o.
- **BasicSecurityConfig**: define as regras de seguran√ßa, como rotas p√∫blicas, autentica√ß√£o, autoriza√ß√£o e filtros personalizados.

Vamos iniciar a implementa√ß√£o dessas classes, que s√£o fundamentais para garantir a seguran√ßa da aplica√ß√£o.

<br />

<h2>üë£ Passo 01 - Criar o Pacote Security</h2>



Primeiro vamos criar a camada de seguran√ßa, ou seja, o pacote **security**, onde as  classes ser√£o implementadas:

1. No lado esquerdo superior, na Guia **Package explorer**, clique com o bot√£o direito do mouse sobre o pacote **com.generation.blogpessoal**, na source folder **src/main/java** e clique na op√ß√£o  **New ü°™ Package**.

2. Na janela **New Java Package**, no item **Name**, acrescente no final do nome do pacote **.security**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/pw8NoI1.png" title="source: imgur.com" /></div>

3. Clique no bot√£o **Finish** para concluir.

<br />

<h2>üë£ Passo 02 - Criar a Classe UserDetailsImpl</h2>



A classe **UserDetailsImpl** implementa a interface **UserDetails**, cuja principal fun√ß√£o √© fornecer ao Spring Security as informa√ß√µes essenciais do usu√°rio, tais como: nome de usu√°rio (login), senha, autoridades (permiss√µes/roles) e restri√ß√µes de seguran√ßa da conta (como conta expirada, bloqueada ou com credenciais inv√°lidas).

Ap√≥s o processo de autentica√ß√£o (login), a classe de servi√ßo **UserDetailsServiceImpl** √© respons√°vel por localizar o usu√°rio no banco de dados e instanciar um novo objeto da classe **UserDetailsImpl**, preenchendo os atributos com os dados do usu√°rio autenticado (login e senha). Esse objeto ser√° utilizado pelo Spring Security para validar o acesso aos recursos protegidos durante toda a sess√£o.

Al√©m disso, a classe **UserDetailsImpl** dever√° implementar todos os m√©todos definidos na interface **UserDetails**, incluindo aqueles que retornam as permiss√µes (roles) do usu√°rio e que indicam restri√ß√µes da conta, como:

- Se a conta est√° expirada (`isAccountNonExpired`)
- Se est√° bloqueada (`isAccountNonLocked`)
- Se as credenciais est√£o expiradas (`isCredentialsNonExpired`)
- Se a conta est√° habilitada (`isEnabled`)

Esses m√©todos s√£o fundamentais para o controle de seguran√ßa da aplica√ß√£o.

<br />

> [!NOTE]
>
> **ALERTA DE BSM**
>
> *Mantenha a Aten√ß√£o aos Detalhes* 
>
> Observe que no final do nome da classe `UserDetailsImpl` foi inserido o sufixo "Impl", que significa implements, ou seja, indica que esta classe √© uma classe concreta, que implementa a interface `UserDetails`.

<br />

Vamos criar e implementar a classe **UserDetailsImpl**:

1. Clique com o bot√£o direito do mouse sobre o **pacote com.generation.blogpessoal.security**, na source folder principal (**src/main/java**), e clique na op√ß√£o **New ü°™ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da classe (**UserDetailsImpl**), e na sequ√™ncia clique no bot√£o **Finish** para concluir.

Vejamos abaixo a implementa√ß√£o da classe **UserDetailsImpl**:

<div align="center"><img src="https://i.imgur.com/PrrOqxC.png" title="source: imgur.com" /></div>

<br />

**Linha 1:** Atrav√©s do comando **`package`**, indicamos o nome do pacote (camada) onde a classe foi criada. Essa informa√ß√£o √© inserida automaticamente pelo STS ao gerar a classe.

**Linhas 3 a 9:** Atrav√©s do comando **`import`**, declaramos os pacotes que cont√™m as classes utilizadas pela classe **`UserDetailsImpl`**. Esses pacotes fornecem as depend√™ncias necess√°rias para o funcionamento da autentica√ß√£o e autoriza√ß√£o com Spring Security.

**Linha 11:** Na assinatura da classe, utilizamos a palavra-chave **`implements`** para indicar que a classe **`UserDetailsImpl`** est√° implementando a interface **`UserDetails`**.

> Uma **interface em Java** √© um **tipo de refer√™ncia** que define um contrato que outras classes devem seguir. Diferentemente de uma classe abstrata, a interface √© uma estrutura pr√≥pria, composta prioritariamente por m√©todos abstratos (sem corpo) e constantes.
>
> Por defini√ß√£o:
>
> - Interfaces **n√£o podem ser instanciadas** diretamente.
> - Cont√™m apenas as **assinaturas dos m√©todos** (sem implementa√ß√£o), que devem ser implementadas pelas classes que as utilizam.
> - Todos os m√©todos s√£o implicitamente `public` e `abstract`; e todos os atributos s√£o `public`, `static` e `final`.
>
> O principal objetivo de uma interface √© permitir que diferentes classes compartilhem o mesmo conjunto de comportamentos, **independentemente da hierarquia de heran√ßa**, favorecendo o **baixo acoplamento** e a **flexibilidade** no c√≥digo.

**Linha 13:** O atributo `serialVersionUID` √© um identificador da vers√£o da classe, utilizado no processo de **serializa√ß√£o e desserializa√ß√£o** de objetos. Simplificando, o **`serialVersionUID`** garante que o objeto serializado √© compat√≠vel com a classe que est√° tentando l√™-lo.

Sempre que uma classe implementa a interface `Serializable`, o Java verifica se o identificador serial presente no objeto serializado √© igual ao da classe atual. Se forem diferentes, uma exce√ß√£o do tipo **`InvalidClassException`** ser√° lan√ßada, indicando incompatibilidade entre vers√µes da classe.

> **Serializa√ß√£o**
>
> √â o processo de transformar um objeto Java em uma sequ√™ncia de bytes. Essa sequ√™ncia pode ser armazenada em disco, transmitida em rede, entre outros. Junto com os dados, √© inclu√≠do o `serialVersionUID`, que funciona como a ‚Äúvers√£o‚Äù da classe.
>
> **Desserializa√ß√£o**
>
> √â o processo inverso: transformar a sequ√™ncia de bytes em um novo objeto. O `serialVersionUID` √© comparado com o da classe atual para verificar compatibilidade.
>
> Na pr√°tica, isso permite "fotografar" o estado de um objeto e restaur√°-lo posteriormente com os mesmos valores.
>
> **Por que o STS emite um aviso?**
>
> Quando uma classe implementa direta ou indiretamente a interface `Serializable`, o Eclipse recomenda declarar explicitamente o atributo `serialVersionUID`. Essa recomenda√ß√£o se aplica quando:
>
> - A classe implementa `Serializable`;
>- A classe implementa uma interface que herda `Serializable`;
> - A classe estende outra classe que implementa `Serializable`.
> 
> No nosso caso, a **interface `UserDetails`** herda `Serializable`. Por isso, a IDE recomenda declarar o `serialVersionUID` na classe `UserDetailsImpl`.
>
> <br />
>
> <div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="4%"/> <a href="https://www.oracle.com/br/technical-resources/articles/java/serialversionuid.html" target="_blank"><b>Documenta√ß√£o: <i>SerialVersionUID</i></b></a></div>
>
> <br />

**Linhas 15 e 16:** Declara os atributos **`username`** e **`password`**, que ser√£o preenchidos com os dados recuperados do banco de dados durante o processo de autentica√ß√£o. Esses atributos s√£o obrigat√≥rios na classe, pois s√£o utilizados pelos m√©todos `getUsername()` e `getPassword()` definidos na interface `UserDetails`.

**Linha 17:** Declara o atributo **`authorities`**, do tipo **`Collection<? extends GrantedAuthority>`**, que representa as permiss√µes (roles) atribu√≠das ao usu√°rio. Essas permiss√µes s√£o necess√°rias para o m√©todo `getAuthorities()` ‚Äî tamb√©m exigido pela interface `UserDetails` ‚Äî e ser√£o utilizadas pelo Spring Security na autoriza√ß√£o de acesso aos recursos protegidos, quando implementadas.

<br />

> [!IMPORTANT]
>
> Para simplificar a nossa implementa√ß√£o com Spring Security, <strong>n√£o implementaremos o controle de permiss√µes (roles)</strong> neste momento. Isso significa que todos os usu√°rios autenticados ter√£o os mesmos direitos de acesso na aplica√ß√£o.

<br />

**Linhas 19 a 22:** Cria o construtor da classe **`UserDetailsImpl`**, que recebe os atributos `username` e `password`. Esses dados s√£o extra√≠dos de um objeto da classe **`Usuario`**, obtido no processo de autentica√ß√£o via banco de dados (que veremos na implementa√ß√£o da classe `UserDetailsServiceImpl`).

Os valores s√£o atribu√≠dos por meio dos m√©todos `getUsuario()` e `getSenha()` do objeto recebido como par√¢metro.

<br />

> [!NOTE]
>
> **ALERTA DE BSM**
>
> *Mantenha aten√ß√£o aos detalhes.* 
>
> O construtor foi adaptado para receber apenas os atributos necess√°rios para autentica√ß√£o (usu√°rio e senha), mas pode ser modificado conforme as necessidades do projeto. Para evitar falhas de seguran√ßa ou inconsist√™ncias, evite modificar esta estrutura sem total compreens√£o do seu funcionamento

<br />

<div align="center"><img src="https://i.imgur.com/9RpX7lw.png" title="source: imgur.com" /></div>

**Linhas 23 a 27:** Implementa o m√©todo `getAuthorities()`, respons√°vel por **retornar os direitos de acesso do usu√°rio** (tamb√©m chamados de *autoriza√ß√µes* ou *roles*).

Como **n√£o estamos implementando controle de acesso baseado em perfis**, o m√©todo retorna **sempre uma `Collection` vazia**. Ainda assim, este m√©todo **n√£o pode retornar `null`**, pois a sua implementa√ß√£o √© obrigat√≥ria, por se tratar de um m√©todo da interface `UserDetails`.

O m√©todo est√° anotado com `@Override`, indicando que ele **sobrescreve** um m√©todo da interface `UserDetails`. Essa sobrescrita √© um exemplo de **polimorfismo de sobrescrita**, comum em implementa√ß√µes de interfaces em Java.

<br />

> [!NOTE]
>
> **ALERTA DE BSM**
>
> *Mantenha aten√ß√£o aos detalhes.* 
>
> Observe que, na assinatura do m√©todo `getAuthorities()`, o uso do **ponto de interroga√ß√£o (`?`)** na declara√ß√£o da `Collection` indica que ela pode armazenar objetos de **qualquer tipo** ‚Äî trata-se de um **tipo gen√©rico curinga**. Esse recurso √© utilizado para manter a flexibilidade, especialmente quando o tipo exato ainda n√£o foi definido ou n√£o √© necess√°rio. 
>
> Caso os direitos de acesso fossem de fato implementados, esse curinga (`?`) seria substitu√≠do pela **classe respons√°vel por representar os pap√©is (roles)** do usu√°rio, como `Role` ou `GrantedAuthority`, garantindo assim maior seguran√ßa e clareza no tipo de dado esperado.

<br />

> [!WARNING]
>
> Embora a `Collection` retornada por `getAuthorities()` esteja vazia, ela <u>**n√£o pode ser nula**</u>. Por isso, mesmo sem implementar controle de permiss√µes, retornamos uma cole√ß√£o vazia (`Collection.emptyList()`). Nesta implementa√ß√£o, todos os usu√°rios autenticados ter√£o os mesmos direitos de acesso √† aplica√ß√£o.

<br />

**Linhas 29 a 39:** Implementa os M√©todos **getUsername()** e **getPassword()**, que retornam os valores dos atributos `username` e `password` do usu√°rio. Esses m√©todos s√£o essenciais para que o Spring Security consiga identificar e validar o usu√°rio durante o processo de autentica√ß√£o.

Ambos os m√©todos tamb√©m est√£o anotados com `@Override`, indicando que s√£o implementa√ß√µes obrigat√≥rias da interface `UserDetails`.

<br />

<div align="center"><img src="https://i.imgur.com/EaCoqyC.png" title="source: imgur.com" /></div>

**Linhas 41 a 59:** Implementam os m√©todos que representam as **propriedades da conta do usu√°rio**, ou seja, caracter√≠sticas relacionadas ao status da conta. **N√£o confunda essas propriedades com os direitos de acesso (permiss√µes ou pap√©is).**

A tabela a seguir descreve o prop√≥sito de cada m√©todo:

| M√©todo                        | Descri√ß√£o                                                    |
| ----------------------------- | ------------------------------------------------------------ |
| **isAccountNonExpired()**     | Indica se a conta do usu√°rio **ainda est√° v√°lida**. Se estiver expirada, o acesso ser√° negado (`false`). |
| **isAccountNonLocked()**      | Informa se a conta do usu√°rio **est√° desbloqueada**. Contas bloqueadas n√£o podem ser autenticadas. |
| **isCredentialsNonExpired()** | Verifica se as **credenciais (senha)** do usu√°rio continuam v√°lidas. Senhas expiradas impedem a autentica√ß√£o. |
| **isEnabled()**               | Indica se o usu√°rio est√° **ativo no sistema**. Contas desativadas n√£o permitem login. |

Todos esses m√©todos retornam um valor **booleano (`true` ou `false`)**, e para simplificar a implementa√ß√£o da autentica√ß√£o com Spring Security, todos retornar√£o **`true`** por padr√£o neste exemplo.

<br />

> [!NOTE]
>
> **ALERTA DE BSM**
>
> *Mantenha aten√ß√£o aos detalhes.* 
>
> Se qualquer um dos quatro m√©todos acima retornar <code>false</code>, o usu√°rio n√£o conseguir√° se autenticar no sistema.

<br />

üíæ **Salve as altera√ß√µes antes de prosseguir ( File ü°™ Save All )!**

A seguir, veja a implementa√ß√£o completa da classe **`UserDetailsImpl`**:

```java
package com.generation.blogpessoal.security;

import java.util.Collection;
import java.util.Collections;

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import com.generation.blogpessoal.model.Usuario;

public class UserDetailsImpl implements UserDetails {

	private static final long serialVersionUID = 1L;

	private String username;
	private String password;

	public UserDetailsImpl(Usuario user) {
		this.username = user.getUsuario();
		this.password = user.getSenha();
	}

	@Override
	public Collection<? extends GrantedAuthority> getAuthorities() {

		return Collections.emptyList();  
	}

	@Override
	public String getPassword() {

		return password;
	}

	@Override
	public String getUsername() {

		return username;
	}

	@Override
	public boolean isAccountNonExpired() {
		return true;
	}

	@Override
	public boolean isAccountNonLocked() {
		return true;
	}

	@Override
	public boolean isCredentialsNonExpired() {
		return true;
	}

	@Override
	public boolean isEnabled() {
		return true;
	}

}
```

<br />

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetails.html" target="_blank"><b>Documenta√ß√£o: <i>Interface UserDetails</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/GrantedAuthority.html"><b>Documenta√ß√£o: <i>M√©todo GrantedAuthority</i></b></a></div>

<br />

<h2>üë£ Passo 03 - Criar a classe UserDetailsServiceImpl</h2>



A classe **UserDetailsServiceImpl** √© uma implementa√ß√£o da interface **UserDetailsService**, respons√°vel por validar a exist√™ncia de um usu√°rio no sistema por meio do banco de dados. Ela busca o usu√°rio utilizando o atributo login, que neste caso √© o e-mail, e retorna um objeto da classe **UserDetailsImpl** (implementada anteriormente), contendo os dados do usu√°rio encontrado.

A interface **UserDetailsService** permite autenticar um usu√°rio baseando-se na sua exist√™ncia no banco de dados (em nosso caso, na tabela **tb_usuarios**). √â importante destacar que, para garantir a seguran√ßa, a senha do usu√°rio deve estar **obrigatoriamente criptografada** no banco, usando um algoritmo hash adequado ‚Äî como ser√° implementado na classe **UsuarioService**.

Al√©m disso, o sistema deve garantir que o usu√°rio (e-mail) seja **√∫nico**, ou seja, n√£o podem existir dois registros com o mesmo e-mail.

<br />

> [!NOTE]
>
> **ALERTA DE BSM**
>
> *Mantenha a Aten√ß√£o aos Detalhes* 
>
> Observe que no final do nome da classe `UserDetailsServiceImpl` foi inserido o sufixo "Impl", que significa implements, ou seja, indica que esta classe √© uma classe concreta, que implementa a interface `UserDetailsService`.

<br />

> [!CAUTION]
>
> **Armazenar a senha criptografada no banco de dados n√£o √© opcional, √© uma exig√™ncia legal.** A LGPD (Lei Geral de Prote√ß√£o de Dados) determina que somente o pr√≥prio usu√°rio deve ter conhecimento da sua pr√≥pria senha.

<br />

Vamos criar e implementar a classe **UserDetailsServiceImpl**:

1. Clique com o bot√£o direito do mouse sobre o **pacote com.generation.blogpessoal.security**, na source folder principal (**src/main/java**), e clique na op√ß√£o **New ü°™ Class**
2. Na janela **New Java Class**, no item **Name**, digite o nome da classe (**UserDetailsServiceImpl**), e na sequ√™ncia clique no bot√£o **Finish** para concluir.

<br />

> [!WARNING]
>
> A anota√ß√£o `@Service` n√£o √© exclusiva da Spring Security. Ela pode ser aplicada a qualquer classe da aplica√ß√£o que represente um servi√ßo e que precise ser gerenciada pelo Spring, permitindo a inje√ß√£o de depend√™ncias e o gerenciamento do ciclo de vida do componente.

<br />

Vejamos abaixo a implementa√ß√£o da classe **UserDetailsServiceImpl**:

<div align="center"><img src="https://i.imgur.com/YgOu2cj.png" title="source: imgur.com" /></div>

**Linha 1:** Atrav√©s do comando `package`, estamos informando o nome do pacote (camada) onde a classe foi criada. Essa informa√ß√£o √© inserida automaticamente pelo STS ao criar a classe.

**Linhas 3 a 12:** Por meio do comando `import`, estamos indicando todos os pacotes que cont√™m as classes utilizadas na classe **UserDetailsServiceImpl**.

**Linha 14:** A classe est√° anotada com `@Service`, o que indica que se trata de uma **classe de servi√ßo**. Uma classe de servi√ßo √© respons√°vel por implementar as **regras de neg√≥cio** e o **tratamento de dados** relacionados a uma parte ou recurso espec√≠fico do sistema.

**Linha 15:** Na assinatura da classe, foi adicionada a implementa√ß√£o da interface **UserDetailsService**, utilizando a palavra-chave **`implements`**.

**Linhas 17 e 18:** A anota√ß√£o `@Autowired` (inje√ß√£o de depend√™ncia) cria um ponto de inje√ß√£o da interface **UsuarioRepository** na classe **UserDetailsServiceImpl**, permitindo o acesso aos m√©todos de intera√ß√£o com os objetos da classe **Usuario** que est√£o persistidos no banco de dados da aplica√ß√£o.

<div align="center"><img src="https://i.imgur.com/Mwh1vvN.png" title="source: imgur.com" /></div>

**Linha 20:** O m√©todo `loadUserByUsername(String username)` est√° anotado com `@Override`, o que indica que ele est√° sendo sobrescrito a partir da Interface `UserDetailsService`, conforme o conceito de **Polimorfismo de Sobrescrita**. Como essa interface faz parte do Spring Security, sua implementa√ß√£o √© obrigat√≥ria para que o sistema possa realizar a autentica√ß√£o do usu√°rio.

**Linha 21:** In√≠cio da implementa√ß√£o do m√©todo `loadUserByUsername`. Esse m√©todo ser√° automaticamente chamado pelo Spring Security **durante o processo de login**, recebendo como par√¢metro o valor digitado no campo de usu√°rio (geralmente o e-mail ou nome de usu√°rio).

**Linhas 23 a 25:** √â realizada uma valida√ß√£o para garantir que o par√¢metro `username` n√£o seja nulo ou vazio. Caso essa condi√ß√£o n√£o seja atendida, √© lan√ßada uma exce√ß√£o do tipo `UsernameNotFoundException`, informando que o campo de usu√°rio n√£o pode estar em branco. Essa √© uma **valida√ß√£o de seguran√ßa b√°sica**, que evita consultas desnecess√°rias ao banco de dados.

Observe que foi utilizado o m√©todo `trim`, da classe `String`, para remover todos os espa√ßos em branco existentes no in√≠cio e no final da string armazenada no par√¢metro `username`, antes de verificar se n√£o est√° vazio, garantindo que o valor informado seja tratado de forma precisa durante a autentica√ß√£o.

**Linha 27:** Cria-se um objeto `Optional<Usuario>` chamado `usuario`, que recebe o resultado da execu√ß√£o do m√©todo `findByUsuario(String usuario)`, que verifica se o usu√°rio existe.

**Linhas 29 a 33:** Se o usu√°rio for encontrado, o m√©todo retorna uma nova inst√¢ncia da classe `UserDetailsImpl`, passando o objeto `usuario` como argumento. 

O m√©todo `get()` √© utilizado para acessar o objeto `Usuario` encapsulado pelo `Optional`, sendo seguro cham√°-lo apenas ap√≥s a verifica√ß√£o com `isPresent()`. 

Caso o usu√°rio n√£o seja encontrado, o sistema lan√ßa uma exce√ß√£o `UsernameNotFoundException` com uma mensagem personalizada, que ser√° tratada pelo mecanismo interno do Spring Security, resultando em um retorno **HTTP Status 401 - UNAUTHORIZED**, indicando que o acesso foi negado.

<br />

> [!NOTE]
>
> **ALERTA DE BSM**
>
> *Mantenha a Aten√ß√£o aos Detalhes* 
>
> Ao criar uma classe de servi√ßo, lembre-se de utilizar a anota√ß√£o `@Service`, pois ela indica ao Spring que essa classe deve ser gerenciada como um componente de servi√ßo, permitindo a inje√ß√£o de depend√™ncias e a organiza√ß√£o adequada da l√≥gica de neg√≥cio na aplica√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/9B46Slv.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html" target="_blank"><b>Documenta√ß√£o: <i>Interface UserDetailsService</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status/403" target="_blank"><b>Documenta√ß√£o: HTTP Status Code 403 - Forbidden</b></a></div>

<br />

üíæ **Salve as altera√ß√µes antes de prosseguir ( File ü°™ Save All )!**

A seguir, veja a implementa√ß√£o completa da classe **`UserDetailsServiceImpl`**:

```java
package com.generation.blogpessoal.security;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import com.generation.blogpessoal.model.Usuario;
import com.generation.blogpessoal.repository.UsuarioRepository;

@Service
public class UserDetailsServiceImpl implements UserDetailsService {
	
	@Autowired
	private UsuarioRepository usuarioRepository;

	@Override
	public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

		if (username == null || username.trim().isEmpty()) {
			throw new UsernameNotFoundException("Usu√°rio (e-mail) n√£o pode ser vazio");
		}
		
		Optional<Usuario> usuario = usuarioRepository.findByUsuario(username);

		if (usuario.isPresent()) {
			return new UserDetailsImpl(usuario.get());
		}else {
			throw new UsernameNotFoundException("Usu√°rio n√£o encontrado: " + username);
		}
			
	}
}
```

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_spring/tree/11_Spring_Security" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
