<h1>Projeto 02 - Blog Pessoal - Classe Postagem</h1>



O que veremos por aqui:

1. Apresenta√ß√£o do Recurso Postagem
2. Criar a estrutura de Pacotes
3. Criar a Classe Model Postagem

<h2>1. O Recurso Postagem</h2>

Nesta etapa vamos come√ßar a construir o Recurso Postagem. Veja o Diagrama de Classes abaixo: 

```mermaid
classDiagram
    class Postagem {
        - Long id
        - String titulo
        - String texto
        - LocalDate data
        + getAll() ResponseEntity List ~Postagem~
        + getById(id: Long) ResponseEntity ~Postagem~
        + getByTitulo(String titulo) ResponseEntity List ~Postagem~
        + post(postagem: Postagem) ResponseEntity ~Postagem~
        + put(postagem: Postagem) ResponseEntity ~Postagem~
        + delete(id: Long) void
    }

```

<br />

Primeiro vamos construir a **Classe Postagem**, que servir√° de modelo para construir a tabela **tb_postagens** (Entidade) dentro do nosso Banco de dados **db_blogpessoal**. Os campos (Atributos) da tabela ser√£o os mesmos que est√£o definidos no Diagrama de Classes acima. Na pr√≥xima etapa vamos construir a **Interface PostagemRepository**, que ir√° nos auxiliar na intera√ß√£o com o Banco de dados. Os M√©todos descritos no Diagrama de Classes ser√£o implementados na etapa seguinte, na **Classe PostagemController**.

Depois de criar a Classe Model Postagem, vamos executar o projeto Blog Pessoal no STS. Ap√≥s a execu√ß√£o veremos que ser√° criado no MySQL, sem a necessidade de gerar c√≥digo SQL, o Banco de dados **db_blogpessoal** e a tabela **tb_postagens**. Veja abaixo como ficar√° a estrutura da nossa tabela atrav√©s do **Diagrama de Entidade e Relacionamentos (DER)**:

```mermaid
erDiagram
    POSTAGEM {
        bigint id PK
        varchar(100) titulo
        varchar(1000) texto
        datetime data   
    }


```

O **Dicion√°rio de dados da nossa tabela tb_postagens** ser√° o seguinte:

| Atributo   | Tipo de dado  | Descri√ß√£o                                         | Chave |
| ---------- | ------------- | ------------------------------------------------- | ----- |
| **id**     | BIGINT        | Identificador √∫nico                               | PK    |
| **titulo** | VARCHAR(100)  | T√≠tulo da postagem                                |       |
| **texto**  | VARCHAR(1000) | Conte√∫do da postagem                              |       |
| **data**   | DATETIME(6)   | Data e hora da publica√ß√£o/atualiza√ß√£o da postagem |       |

<br />

<h2>üë£ Passo 01 - Criar o Pacote Model</h2>

Na Source Folder Principal (**src/main/java**), observe que foi criado o pacote principal da nossa aplica√ß√£o (**com.generation.blogpessoal**), onde todo o nosso c√≥digo ser√° desenvolvido. Na figura abaixo, podemos visualizar o pacote:

<div align="center"><img src="https://i.imgur.com/vTW7QkW.png" title="source: imgur.com" /></div>

Vamos criar dentro do pacote principal, sub pacotes que chamaremos de **Camadas**. Dentro destes sub pacotes, iremos criar as Classes e Interfaces da nossa aplica√ß√£o, seguindo o modelo MVC.  Para criarmos o Recurso Postagem, vamos precisar de 3 Camadas:

| Camada         | Descri√ß√£o                                                    |
| -------------- | ------------------------------------------------------------ |
| **Model**     | Camada respons√°vel pela abstra√ß√£o dos nossos Objetos em registros das nossas tabelas, que ser√£o geradas no Banco de dados. As Classes criadas nesta camada representam os objetos que ser√£o persistidos no Banco de dados. |
| **Repository** | Camada respons√°vel por implementar as Interfaces, que cont√©m diversos M√©todos pr√©-implementados para a  manipula√ß√£o de dados de uma entidade, como M√©todos para salvar, deletar,  listar e recuperar dados da Classe. Para criar estas Interfaces basta Herdar (extends) a Interface JpaRepository. |
| **Controller** | Camada respons√°vel por receber todas as Requisi√ß√µes HTTP (HTTP Request), enviadas por um Cliente HTTP (Insomnia, Postman ou o Front-end da aplica√ß√£o), para a nossa aplica√ß√£o e responder (HTTP Response) as requisi√ß√µes de acordo com o resultado do processamento da requisi√ß√£o no Back-end. |

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a Camada Model. Um erro muito comum √© criar os pacotes na Source Folder de Testes (imagem abaixo), ao inv√©s de criar na Source Folder Principal.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="center"><img src="https://i.imgur.com/1SgI3ny.png" title="source: imgur.com" /></div>

Vamos come√ßar criando a Camada Model:

1. No lado esquerdo superior, na Guia **Package explorer**, clique com o bot√£o direito do mouse sobre a Package **com.generation.blogpessoal**, na Source Folder **src/main/java** e clique na op√ß√£o  **New ü°™ Package**.

<div align="center"><img src="https://i.imgur.com/fAgudU6.png" title="source: imgur.com" /></div>

2. Na janela **New Java Package**, no item **Name**, acrescente no final do nome da Package **.model**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/tjKWK8p.png" title="source: imgur.com" /></div>

3. Clique no bot√£o **Finish** para concluir.

A estrutura de pacotes da aplica√ß√£o ficar√° igual a figura abaixo:

<div align="center"><img src="https://i.imgur.com/DwBPt9a.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 02 - Criar a Classe Postagem na Camada Model</h2>

Agora vamos criar a Classe Model que chamaremos de **Postagem**.

1. Clique com o bot√£o direito do mouse sobre o **Pacote Model** (**com.generation.blogpessoal.model**), na Source Folder Principal (**src/main/java**), como mostra a figura abaixo:
2. Na sequ√™ncia, clique na op√ß√£o **New ü°™ Class**

<div align="center"><img src="https://i.imgur.com/1OmfACh.png" title="source: imgur.com" /></div>

3. Na janela **New Java Class**, no item **Name**, digite o nome da Classe (**Postagem**), como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/L4GTVy2.png" title="source: imgur.com" /></div>

4. Clique no bot√£o **Finish** para concluir.
4. Na imagem abaixo, vemos a Classe Postagem, criada dentro da camada model:

<div align="center"><img src="https://i.imgur.com/2SRpAEm.png" title="source: imgur.com" /></div>

Agora vamos criar o c√≥digo da **Classe Model Postagem**, como mostra a imagem abaixo:

 <div align="left"><img src="https://i.imgur.com/M5zecPp.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Atrav√©s do comando **package**, estamos informando o nome do pacote (camada), onde a Classe foi criada. Esta informa√ß√£o √© inserida automaticamente pelo STS ao criar a Classe.

**Linhas 3 a 13:** Atrav√©s do comando **import**, estamos indicando todos os pacotes que cont√©m as Classes que est√£o sendo utilizadas na Classe Postagem.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Observe que nas linhas 7 a 13, as Classes est√£o sendo importadas do pacote Jakarta. Este pacote est√° dispon√≠vel apenas a partir da vers√£o 3.0.0 do Spring. Para vers√µes anteriores do Spring, o pacote se chamava javax. Mantenha aten√ß√£o aos detalhes ao importar os pacotes ou utilize o atalho CTRL + SHIFT + O, para efetuar a importa√ß√£o autom√°tica.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 15:** A Anota√ß√£o **@Entity** indica que esta Classe define uma entidade, ou seja, ela ser√° utilizada para gerar uma tabela no Banco de dados da aplica√ß√£o.

**Linha 16:** A Anota√ß√£o **@Table** indica o nome da Tabela no Banco de dados. Caso esta anota√ß√£o n√£o seja declarada, o Banco de dados criar√° a tabela com o mesmo nome da Classe Model (Postagem). Observe que o nome da Tabela segue o padr√£o utilizado no SQL **tb_nome-da-tabela** (tb_postagens). O prefixo **tb** indica que se trata de uma Table (Tabela). O nome da Tabela √© recomendado que seja **o mesmo da Classe Model** (postagem), em **letras min√∫sculas**, **sem espa√ßos em branco ou caracteres especiais e acentos**. Observe que o **nome da tabela est√° no plural**, porque ser√£o armazenadas v√°rias postagens.

**Nas Linhas 21, 25, 29 e 32** foram criados os Atributos da Classe Postagem, que foram definidos no Diagrama de Classes acima. Veja na tabela abaixo a convers√£o de **Tipo de dados Java ü°™ MySQL**

| Atributo   | Tipo de dado Java                                            | Tipo de dado MySQL |
| ---------- | ------------------------------------------------------------ | ------------------ |
| **id**     | Long | BIGINT             |
| **titulo** | String | VARCHAR(100)       |
| **texto**  | String | VARCHAR(1000)      |
| **data**   | LocalDateTime | DATETIME(6)               |

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left">**DICA:** *Para relembrar os tipos de dados em Java, <a href="java_tipos.md">clique aqui</a> e explore os principais tipos de dados e Classes que o Java oferece.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

Observe que acima de cada Atributo foram adicionadas algumas Anota√ß√µes. Estas anota√ß√µes tem a fun√ß√£o de configurar os par√¢metros do Banco de dados e criar valida√ß√µes para os dados que ser√£o inseridos no Objeto da Classe Postagem (tamanho, formato e etc).

**Linha 19:** A Anota√ß√£o **@Id** inidica que o Atributo anotado ser√° a **Chave Prim√°ria** (Primary Key - PK) da Tabela **tb_postagens**.

**Linha 20:** A Anota√ß√£o **@GeneratedValue** indica que a **Chave Prim√°ria** ser√° gerada pelo Banco de dados. O par√¢metro **strategy** indica de que forma esta **Chave Prim√°ria** ser√° gerada. A Estrat√©gia **GenerationType.IDENTITY** indica que a Chave Prim√°ria ser√° gerada pelo Banco de dados atrav√©s da op√ß√£o **auto-incremento** (auto-increment) do SQL, que gera uma sequ√™ncia num√©rica iniciando em 1. Veja outras estrat√©gias de gera√ß√£o da Chave Prim√°ria no <a href="#anexo2"><b>Anexo II</b></a>.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *N√£o confundir o auto-incremento do Banco de Dados que inicia em 1 com o √≠ndice de um Array (Vetor ou Matriz) que inicia em 0.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Nas linhas 23 e 27:** A anota√ß√£o **@NotBlank** n√£o permite que o Atributo seja **Nulo ou contenha apenas espa√ßos em branco**. Voc√™ pode configurar uma mensagem para o usu√°rio atrav√©s do Atributo **message**.

**Nas linhas 24 e 28:** A anota√ß√£o **@Size** define o valor **M√≠nimo (min)** e o valor **M√°ximo (max)** de caracteres do Atributo. N√£o √© obrigat√≥rio configurar os 2 par√¢metros. Como o par√¢metro **max** foi configurado, observe que o mesmo valor informado ser√° inserido na defini√ß√£o dos Atributos **titulo** (**varchar(100)**) e texto (**varchar(1000)**) na tabela **tb_postagens** no Banco de dados. Voc√™ pode configurar uma mensagem para o usu√°rio atrav√©s do Atributo **message**.

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left">**DICA:** *Acesse o <a href="guia_jpa.md">Guia do JPA</a> e explore outras op√ß√µes de Valida√ß√£o para os Atributos. Essas valida√ß√µes ser√£o muito √∫teis em seus projetos futuros.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Na linha 31:** A anota√ß√£o **@UpdateTimestamp** configura o Atributo **data** como **Timestamp**, ou seja, o Spring se encarregar√° de obter a data e a hora do Sistema Operacional e inserir no Atributo **data** toda vez que um Objeto da Classe Postagem for criado ou atualizado. 

<br />

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://www.baeldung.com/jpa-entities#entity" target="_blank"><b>Documenta√ß√£o: <i>@Entity</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://www.baeldung.com/jpa-entities#table" target="_blank"><b>Documenta√ß√£o: <i>@Table</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://www.baeldung.com/jpa-entities#id" target="_blank"><b>Documenta√ß√£o: <i>@Id</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://www.baeldung.com/hibernate-identifiers" target="_blank"><b>Documenta√ß√£o: <i>@GeneratedValue</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://jakarta.ee/specifications/bean-validation/3.0/apidocs/jakarta/validation/constraints/notblank" target="_blank"><b>Documenta√ß√£o: <i>@NotBlank</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://jakarta.ee/specifications/bean-validation/3.0/apidocs/jakarta/validation/constraints/size" target="_blank"><b>Documenta√ß√£o: <i>@Size</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://thorben-janssen.com/persist-creation-update-timestamps-hibernate/" target="_blank"><b>Documenta√ß√£o: <i>@UpdateTimestamp</i></b></a></div>

<br />


<h2>üë£ Passo 03 - Criar os M√©todos Get e Set</h2>

Depois de criarmos os Atributos, precisamos criar os **M√©todos Get e Set** para todos os Atributos da Classe. O M√©todo Construtor n√£o ser√° necess√°rio porqu√™ o Spring utiliza um recurso chamado **Inje√ß√£o de Depend√™ncia** (veremos na Classe PostagemController).

1. Posicione o cursor do mouse no ponto onde ser√° criado os M√©todos Get e Set.
2. No menu **Source**, clique na op√ß√£o **Generate Getters and Setters...**

<div align="center"><img src="https://i.imgur.com/hgjkFLK.png" title="source: imgur.com" /></div>

3. Na tela **Generate Getters and Setters**, Clique no bot√£o **Select All** para selecionar todos os Atributos e clique no bot√£o **Generate**.

<div align="center"><img src="https://i.imgur.com/3M4zmbN.png" title="source: imgur.com" /></div>

4. A gera√ß√£o dos M√©todos ficar√° igual a imagem abaixo:

<div align="left"><img src="https://i.imgur.com/UFCS81z.png" title="source: imgur.com" /></div>

5. Para concluir, n√£o esque√ßa de **Salvar** a Classe.

<br />

<h2>üë£ Passo 04 - Executar o projeto</h2>



Existem duas maneiras de executar o seu Projeto Spring no STS:

**Forma 01**

Executar o projeto Spring a partir da Classe principal:

1. No **STS**, na **Package Explorer**, clique na pasta **src/main/java** e na sequ√™ncia clique no pacote principal **com.generation.blogpessoal**.
2. Clique com o bot√£o direito do mouse sobre o arquivo **BlogpessoalApplication.java**.

<div align="center"><img src="https://i.imgur.com/Hz7v2S0.png" title="source: imgur.com" /></div>

3. No menu que ser√° aberto, clique na op√ß√£o **Run AS ü°™ Spring Boot App** como mostra a Ô¨Ågura abaixo:

<div align="center"><img src="https://i.imgur.com/K9o5TpC.png" title="source: imgur.com" /></div>

<br />

**Forma 02**

Uma segunda forma de executar o seu Projeto Spring √© utilizando o **Spring Boot Dashboard**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/7DPZUc8.png" title="source: imgur.com" /></div>

1. Selecione o Projeto que voc√™ deseja executar, como mostra a imagem acima.
2. Clique no bot√£o <img src="https://i.imgur.com/AHCJCHf.png" title="source: imgur.com" width="4%"/> **Start** para **Executar ou Reiniciar** o Projeto.
3. Para **finalizar** o Projeto, clique no bot√£o <img src="https://i.imgur.com/1UcCtn9.png" title="source: imgur.com" width="4%"/> **Stop**.

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left">**DICA:** *Caso a Barra de Ferramentas Principal n√£o esteja vis√≠vel, utilize o Menu Window ü°™ Appearence ü°™ Show Toolbar.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

Observe no Console do STS, que ser√£o exibidas as linhas abaixo, indicando que a Tabela **tb_postagens** foi criada:

<div align="left"><img src="https://i.imgur.com/buddU3F.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 05 - Checando o Banco de Dados</h2>

Vamos checar se o Banco de Dados **db_blogpessoal** e a Tabela **tb_postagens** foram criados no MySQL.

1. Na Caixa de pesquisas, localize o <b>MySQL Workbench</b> e abra a aplica√ß√£o.

2. No <b>MySQL Workbench</b>, Clique sobre a <b>Conex√£o Local instance MySQL80</b>

<div align="center"><img  src="https://i.imgur.com/HBdNTkU.png" title="source: imgur.com" /></div>

3. Caso seja solicitada a senha, <b>digite a senha do usu√°rio root</b> e marque a op√ß√£o <b>Save password in vault</b> para gravar a senha e n√£o perguntar novamente.

<div align="center"><img src="https://i.imgur.com/xC6JFoe.png" title="source: imgur.com" /></div>

4. Ser√° aberta a janela principal do <b>MySQL Workbench</b>. 

<div align="center"><img src="https://i.imgur.com/jVDtxuJ.png" title="source: imgur.com" /></div>

5. Na janela **Schemas**, Clique no bot√£o <img src="https://i.imgur.com/UANRDni.png" title="source: imgur.com" /> (Atualizar)

<div align="center"><img src="https://i.imgur.com/BF4g9mh.png" title="source: imgur.com" /></div>

6. Verifique se o Banco de dados **db_blogpessoal** e se a tabela **tb_postagens** foram criados, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/eejb9X3.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_spring/tree/02_Classe_Model_Postagem" target="_blank"><b>C√≥digo fonte do Projeto</b></a></div>

<br />

<h2 id="anexo1">Anexo I - Principais Mensagens de Erro</h2>

| Erro                                                         | Descri√ß√£o                                                    |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ***Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.*** | A configura√ß√£o da conex√£o com o Banco de dados n√£o foi implementada. Configure a conex√£o com o Banco de dados no arquivo **application.properties**.<br />Caso o erro persista, experimente apagar a pasta **.m2**, localizada em: `C:\Users\<seu_usuario>\.m2` |
| ***Access denied for user 'root'@'localhost' (using password: YES)*** | O nome do usu√°rio ou a senha do seu Banco de dados est√° incorreta. Verifique qual foi a senha que voc√™ cadastrou na instala√ß√£o do seu MySQL e altere no arquivo **application.properties** |

<br />

<h2 id="anexo2">Anexo II - Estrat√©gias para gera√ß√£o da Chave Prim√°ria</h2>

| **Estrat√©gia**              | **Descri√ß√£o**                                                |
| --------------------------- | ------------------------------------------------------------ |
| **GenerationType.AUTO**     | Valor padr√£o, deixa com o provedor de persist√™ncia a escolha da estrat√©gia mais adequada de acordo com o Banco de dados. |
| **GenerationType.IDENTITY** | Informamos ao provedor de persist√™ncia que os valores a serem atribu√≠dos ao identificador √∫nico ser√£o gerados pela coluna de auto incremento do banco de dados. Assim, um valor para o identificador √© gerado para cada registro inserido no banco. Alguns bancos de dados podem n√£o suportar essa op√ß√£o. |
| **GenerationType.SEQUENCE** | Informamos ao provedor de persist√™ncia que os valores ser√£o gerados a partir de uma sequence. Caso n√£o seja especificado um nome para a sequence, ser√° utilizada uma sequence padr√£o, a qual ser√° global, para todas as entidades. Caso uma sequence seja especificada, o provedor passar√° a adotar essa sequence para cria√ß√£o das chaves prim√°rias. Alguns bancos de dados podem n√£o suportar essa op√ß√£o, como o MySQL por exemplo. |
| **GenerationType.TABLE**    | Com a op√ß√£o TABLE √© necess√°rio criar uma tabela para gerenciar as chaves prim√°rias. Por causa da sobrecarga de consultas necess√°rias para manter a tabela atualizada, essa op√ß√£o √© pouco recomendada. |

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
