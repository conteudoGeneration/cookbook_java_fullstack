<h1>Projeto 02 - Blog Pessoal - Classe PostagemController - M√©todo Consultar Postagens por T√≠tulo</h1>

O que veremos por aqui:

1. Criar o M√©todo getByTitulo(String titulo) para listar uma Postagem espec√≠fica

<h2>1. O Recurso Postagem</h2>

Nas etapas anteriores, come√ßamos a construir a Classe **PostagemController** e implementamos os M√©todos:

-  **getAll()**  ü°™ Retorna todos os Objetos da Classe Postagem persistidos no Banco de dados.
-  **getById(Long id)** ü°™ Retorna um Objeto espec√≠fico da Classe Postagem persistidos no Banco de dados. A Postagem √© identificada pelo Atributo id.   

Vamos continuar a constru√ß√£o da nossa Classe Controladora implementando o **M√©todo getByTitulo( String titulo )**, que retornar√° todos os Objetos da Classe Postagem persistidos no Banco de dados, cujo Atributo titulo contenha a String enviada no par√¢metro titulo do M√©todo.

<div align="center"><img src="https://i.imgur.com/aKmFiA1.png" title="source: imgur.com" width="50%"/></div>

<h2>üë£ Passo 01 - Implementar a Query Method</h2>

Para implementarmos o M√©todo de Consulta por t√≠tulo **getByTitulo(String titulo)** ser√° necess√°rio criar uma **Query Method** na Interface PostagemRepository. Desta forma, o Diagrama de Classes da nossa Interface sofrer√° uma altera√ß√£o:

<div align="center"><img src="https://i.imgur.com/EItgQkw.png" title="source: imgur.com" /></div>

> **Query Method** s√£o M√©todos de Consulta personalizados, que permitem criar consultas espec√≠ficas com qualquer Atributo da Classe associada a Interface Reposit√≥rio (Postagem). Como a Interface JpaRepository possui apenas um M√©todo de consulta espec√≠fico pelo id (**findById( Long id)**), que √© um Atributo comum em todas as Classes Model do Projeto, atrav√©s das **Query Methods** podemos ampliar as nossas op√ß√µes de consulta. As Query Methods s√£o declaradas na Interface Reposit√≥rio e implementadas nas Classes Controladoras e de Servi√ßos (Service, que veremos mais a frente). 

Na pr√°tica, as Query Methods permitem gerar instru√ß√µes de consulta em **JPQL** com base na combina√ß√£o entre palavras-chave e nomes de atributos da entidade. O Spring Data interpreta o nome do m√©todo e cria dinamicamente a consulta correspondente.

> **JPQL (Java Persistence Query Language)** √© a **linguagem de consulta orientada a objetos** utilizada no JPA (**Java Persistence API**). Ela √© similar ao SQL, mas opera sobre **entidades Java e seus atributos**, em vez de tabelas e colunas do banco de dados.
>
> Na pr√°tica, quando voc√™ escreve uma Query Method:
>
> 1. O **Spring Data JPA interpreta o nome do m√©todo**.
> 2. Ele **gera dinamicamente uma consulta em JPQL** com base nesse nome.
> 3. A consulta JPQL gerada √© convertida pelo **provider JPA (Hibernate)** em uma consulta **SQL nativa**, que ser√° executada no banco.
>
> Gra√ßas ao JPQL, o JPA consegue operar em qualquer Banco de dados Relacional, sem a necessidade de reescrever m√©todos ou consultas.

<br />

**Exemplo 01:**

**Query Method**

```java
public Optional <Postagem> findByTitulo(String titulo);
```

**Instru√ß√£o SQL equivalente**

```sql
SELECT * FROM tb_postagens WHERE titulo = "titulo";
```

| Palavra Chave     |      | Instru√ß√£o SQL                                                |
| ----------------- | ---- | ------------------------------------------------------------ |
| **find**          | ü°™    | SELECT                                                       |
| **By**            | ü°™    | WHERE                                                        |
| **Titulo**        | ü°™    | Atributo da Classe Postagem                                  |
| **String titulo** | ü°™    | Par√¢metro do M√©todo contendo o t√≠tulo que voc√™ deseja procurar. |

Como esta consulta retornar√° apenas um Objeto da Classe Postagem ou um Objeto Nulo, caso a consulta n√£o encontre nada, o M√©todo foi assinado com apenas um Objeto da Classe Postagem do tipo **Optional** para evitar o erro **NullPointerException** (Objeto Nulo). 

**Exemplo 02:**

**Query Method**

```java
public List <Postagem> findAllByTituloContainingIgnoreCase(String titulo);
```

**Instru√ß√£o SQL equivalente**

```sql
SELECT * FROM tb_postagens WHERE titulo LIKE "%titulo%";
```

<br />

| Palavra Chave        |      | Instru√ß√£o SQL                                                |
| -------------------- | ---- | ------------------------------------------------------------ |
| **find**             | ü°™    | SELECT                                                       |
| **All**              | ü°™    | *                                                            |
| **By**               | ü°™    | WHERE                                                        |
| **Titulo**           | ü°™    | Atributo da Classe Postagem                                  |
| **Containing**       | ü°™    | LIKE "%titulo%"                                              |
| **IgnoreCase**       | ü°™    | Ignorando letras mai√∫sculas ou min√∫sculas                    |
| **@Param("titulo")** | ü°™    | Define a vari√°vel String titulo como um par√¢metro da consulta. Esta anota√ß√£o √© opcional em consultas do tipo Like. |
| **String titulo**    | ü°™    | Par√¢metro do M√©todo contendo o t√≠tulo que voc√™ deseja procurar. |

Como esta consulta retornar√° um ou mais Objetos da Classe Postagem, o M√©todo foi assinado com uma **Collection List** de Objetos da Classe Postagem.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *A instru√ß√£o FROM tb_postagens ser√° inserida pelo JPA ao checar o nome da tabela gerada pela Classe Postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">**DICA:** *Acesse o <a href="guia_jpa.md">Guia do JPA</a> e explore outras op√ß√µes de Query Methods (M√©todos de Consulta), com exemplos implementados. Pedimos apenas que n√£o implemente os exemplos do Guia no Projeto Blog Pessoal.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

O Exemplo 02 ser√° criado dentro da <b>Interface PostagemRepository</b> e ser√° implementado na Classe **PostagemController**. Veja o c√≥digo abaixo, implementado na Interface:

<div align="left"><img src="https://i.imgur.com/09kpBmE.png" title="source: imgur.com" /></div>

Observe que a **Query Method do Exemplo 02** foi adicionada na **linha 12 da Interface PostagemRepository**. Observe que depois de Criar a Query Method foram importados mais 2 pacotes na Interface **PostagemRepository**, como mostra a imagem acima (indicados pelas Setas vermelhas).

Para concluir, n√£o esque√ßa de Salvar o c√≥digo (**File ü°™ Save All**) .

<br />

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html" target="_blank"><b>Documenta√ß√£o: <i>Query Methods</i></b></a></div>

<br />

<h2>üë£ Passo 02 - Criar o M√©todo getByTitulo(String titulo)</h2>

Vamos implementar o M√©todo **getByTitulo(String titulo)** na Classe Postagem Controller. Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens where titulo like "%titulo%";</code>.

<div align="left"><img src="https://i.imgur.com/YE9Imth.png" title="source: imgur.com" /></div>

**Linha 37:** a anota√ß√£o **@GetMapping** indica que o M√©todo getAll(), responder√° a todas as requisi√ß√µes do tipo **HTTP GET**, enviadas no endere√ßo **http://localhost:8080/postagens/titulo/{titulo}**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste Endpoint ser√° composto pelo Endere√ßo do Recurso (@RequestMapping) + a vari√°vel de caminho indicada na anota√ß√£o @GetMapping. Lembre-se que n√£o pode existir dois ou mais M√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 38:** O M√©todo **getByTitulo(String titulo)** ser√° do tipo **ResponseEntity** porqu√™ ele responder√° a **Requisi√ß√£o HTTP** (HTTP Request), com uma  **Resposta HTTP** (HTTP Response). 

‚úî<img src="https://i.imgur.com/I0U4xHJ.png?1" title="source: imgur.com" height="20px"/>: O M√©todo al√©m de retornar um objeto da **Classe ResponseEntity** (**OK ü°™200**), no par√¢metro **body** (Corpo da Resposta), ser√° retornado um Objeto da Classe **List (Collection)**, contendo todos os Objetos da Classe **Postagem** persistidos no Banco de dados, na tabela **tb_postagens**, cujo Atributo titulo contenha a String enviada como par√¢metro do M√©todo.

**Linha 39:** **return ResponseEntity.ok(postagemRepository.findAllByTituloContainingIgnoreCase(String titulo));** Executa o M√©todo **findAllByTituloContainingIgnoreCase(String titulo)** (**M√©todo personalizado, criado na Interface PostagemRepository**), e exibe o resultado (<img src="https://i.imgur.com/I0U4xHJ.png?1" title="source: imgur.com" height="20px"/>) no Corpo da Resposta. Mesmo que nenhuma postagem seja encontrada, a lista nunca ser√° `null` ‚Äî apenas vazia. Por isso, o `ResponseEntity.ok()` ser√° retornado com status `200 OK` em todos os casos.

Para concluir, n√£o esque√ßa de Salvar o c√≥digo (**File ü°™ Save All**) e verificar se o Projeto est√° em execu√ß√£o

<br />

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/GetMapping.html" target="_blank"><b>Documenta√ß√£o: <i>@GetMapping</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/ResponseEntity.html#ok-T-" target="_blank"><b>Documenta√ß√£o: <i>ResponseEntity</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.html" target="_blank"><b>Documenta√ß√£o: <i>HttpStatus</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="3%"/> <a href="https://docs.oracle.com/javase/tutorial/collections/interfaces/list.html" target="_blank"><b>Documenta√ß√£o: <i>Collection List</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="3%"/> <a href="https://docs.oracle.com/javase/tutorial/java/generics/types.html" target="_blank"><b>Documenta√ß√£o: <i>Java Generics</i></b></a></div>

<br />

<h2>üë£ Passo 03 - Testar no Insomnia</h2>

Agora vamos criar a Requisi√ß√£o para o **M√©todo getByTitulo(String titulo)**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New HTTP Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/nWwhslQ.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/2pdkp35.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Consultar Postagem por Titulo** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (http://localhost:8080) √© o endere√ßo do nosso servidor local. Quando a API estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da aplica√ß√£o na nuvem.
- A segunda parte do endere√ßo √© o **endpoint** configurado na anota√ß√£o ***@RequestMapping***, em nosso caso  **/postagens**. 
- A terceira parte (**/titulo/postagem**), titulo √© apenas um indicativo do conte√∫do da vari√°vel que dever√° ser preenchida. A palavra ***postagem*** √© o conte√∫do da vari√°vel de caminho (**@PathVariable**) titulo. Informe o texto que voc√™ deseja pesquisar.

7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="50px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/iUfzYul.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o al√©m de exibir os dados de todos os Objetos da Classe Postagem persistidos no Banco de dados, no Corpo da Resposta, respeitando o crit√©rio informado na consulta (palavra postagem), ela tamb√©m retornar√° um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_v3/tree/06_Classe_PostagemController_getByTitulo" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

 <br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
