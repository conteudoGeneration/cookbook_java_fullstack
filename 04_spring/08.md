<h1>Projeto 02 - Blog Pessoal - Classe PostagemController - M√©todo Consultar Postagens por Id</h1>



O que veremos por aqui:

1. Criar o M√©todo getById(Long id) para listar uma Postagem espec√≠fica

<br />

<h2>1. O Recurso Postagem</h2>



Na etapa anterior, come√ßamos a construir a classe **PostagemController** e implementamos o m√©todo **getAll()**, que retorna todos os objetos da classe Postagem persistidos no banco de dados. Agora, continuaremos a constru√ß√£o da nossa classe controladora, implementando o **m√©todo `getById(Long id)`**.

```mermaid
classDiagram
    class Postagem {
        - Long id
        - String titulo
        - String texto
        - LocalDateTime data
        
        + getAll() ResponseEntity List ~Postagem~
        + getById(Long id) ResponseEntity ~Postagem~
        + getByTitulo(String nome) ResponseEntity List ~Postagem~
        + post(Postagem postagem) ResponseEntity ~Postagem~
        + put(Postagem postagem) ResponseEntity ~Postagem~
        + delete(Long id) void
    }

```

<br />

<h2>üë£ Passo 01 - Criar o M√©todo getById(Long id)</h2>



Vamos implementar o M√©todo **getById(Long id)** na Classe Postagem Controller, que retornar√° um Objeto espec√≠fico persistido no Banco de dados, identificado pelo **id** (Identificador √∫nico do Objeto). Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens where id = id;</code>.

<div align="left"><img src="https://i.imgur.com/HhDa67g.png" title="source: imgur.com" /></div>

Para processar o m√©todo `findById(Long id)`, utilizaremos dois recursos do Java que tornam o c√≥digo mais limpo e assertivo: **Optional** e **Express√µes Lambda**.

**Optional**

 √â um cont√™iner que pode ou n√£o conter um valor n√£o nulo. No nosso contexto, sua fun√ß√£o √© evitar o lan√ßamento de uma exce√ß√£o `NullPointerException` caso a postagem procurada n√£o seja encontrada. O m√©todo `findById(id)` retorna um `Optional<Postagem>`, que conter√° a postagem se ela existir. Caso contr√°rio, o Optional estar√° vazio, evitando o uso direto de `null` e tornando o tratamento de valores ausentes mais seguro e leg√≠vel.

**M√©todo `map()`**

Presente na classe `Optional`, transforma o valor contido no Optional **caso ele esteja presente**. Em outras palavras, executa uma fun√ß√£o (geralmente uma express√£o lambda) apenas se houver valor. Caso contr√°rio, o retorno continuar√° sendo um Optional vazio. Combinado com `orElse()`, √© poss√≠vel executar uma a√ß√£o alternativa quando o valor estiver ausente, como lan√ßar uma exce√ß√£o.

**Express√µes Lambda**

S√£o fun√ß√µes an√¥nimas (sem nome, tipo de retorno ou modificador de acesso). Em Java, permitem escrever m√©todos de forma mais concisa, diretamente no local de uso. A sintaxe √©:

```java
(argumento) -> { corpo da fun√ß√£o }
```

Esse recurso √© inspirado no paradigma de **programa√ß√£o funcional** e √© semelhante √†s **Arrow Functions** do JavaScript/TypeScript.

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left">**DICA:** *Caso voc√™ tenha alguma d√∫vida sobre Optional e Express√µes Lambda, no Cookbook de Java do Bloco 1 e consulte os respectivos t√≥picos.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 30:** A anota√ß√£o `@GetMapping("/{id}")` mapeia todas as requisi√ß√µes **HTTP GET** enviadas para o endere√ßo especificado do recurso Postagem para o m√©todo correspondente. 

Assim, o m√©todo `getById(Long id)` ser√° acionado quando uma requisi√ß√£o GET for enviada para:

```
http://localhost:8080/postagens/{id}
```

Onde `{id}` √© uma **vari√°vel de caminho** (*Path Variable*) que representa o identificador da postagem.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste endpoint ser√° composto pelo Endere√ßo do Recurso (@RequestMapping) + a vari√°vel de caminho indicada na anota√ß√£o @GetMapping. Lembre-se que n√£o pode existir dois ou mais M√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 31:** O m√©todo **getById(@PathVariable Long id)** retorna um objeto do tipo **ResponseEntity**, pois ele trata uma **requisi√ß√£o HTTP** e retorna uma **resposta HTTP** com status e conte√∫do apropriados. O par√¢metro do m√©todo √© do tipo **Long** e representa o **id** da postagem a ser buscada.

**@PathVariable Long id:** Essa anota√ß√£o indica que o valor informado na URL ser√° injetado diretamente no par√¢metro `id` do m√©todo. Isso permite buscar dinamicamente a postagem desejada com base no ID informado.

**Exemplo:**

**http://localhost:8080/postagens/1**

No exemplo acima, o par√¢metro **Long id**, do M√©todo **getById( Long id )**, receber√° o valor 1 (Id que ser√° procurado na tabela tb_postagens)

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo getById devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<img src="https://i.imgur.com/QKIS6Rm.png" title="source: imgur.com" height="20px"/>: O m√©todo retorna uma inst√¢ncia de **ResponseEntity** com status **200 OK**, contendo no corpo da resposta o objeto da classe **Postagem**, caso ele seja encontrado no banco de dados (tabela `tb_postagens`). Aqui tamb√©m est√° sendo utilizado o recurso de **Java Generics** para indicar que o corpo da resposta ser√° do tipo **Postagem**.

**Linha 32:**

**return postagemRepository.findById(id):** Executa o m√©todo **findById(id)**, fornecido pela interface **JpaRepository**. Esse m√©todo retorna um objeto do tipo **Optional**, que conter√° a postagem se ela for encontrada pela chave prim√°ria (**id**) ou estar√° vazio se n√£o for encontrada.

**.map(resposta -> ResponseEntity.ok(resposta)):** Caso a postagem seja encontrada, o m√©todo **map()** ser√° executado. Ele recebe a postagem como par√¢metro (no exemplo, chamada de `resposta`) e a encapsula dentro de um `ResponseEntity.ok(...)`, retornando uma resposta HTTP com status **200 OK** e o corpo contendo a postagem.

**.orElse(ResponseEntity.notFound().build()):** Caso o `Optional` esteja vazio, ou seja, nenhuma postagem com o `id` informado tenha sido encontrada, o m√©todo **orElse(...)** ser√° acionado. Ele retorna uma resposta HTTP com status **404 Not Found** e sem corpo.

> **Resumindo:** O uso combinado de `Optional`, `map()` e `orElse()` permite tratar de forma segura e elegante a exist√™ncia ou aus√™ncia do objeto buscado, evitando `NullPointerException` e mantendo o c√≥digo mais limpo e leg√≠vel.

Depois de Criar o M√©todo, observe que foram importados mais 2 pacotes, como mostra a imagem abaixo (Setas vermelhas):

<div align="left"><img src="https://i.imgur.com/DNdKAzV.png" title="source: imgur.com" /></div>

Para concluir, n√£o esque√ßa de Salvar o c√≥digo (**File ü°™ Save All**) e verificar se o Projeto est√° em execu√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/GetMapping.html" target="_blank"><b>Documenta√ß√£o: <i>@GetMapping</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="4%"/> <a href="https://www.baeldung.com/spring-pathvariable" target="_blank"><b>Documenta√ß√£o: <i>@PathVariable</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/ResponseEntity.html#ok-T-" target="_blank"><b>Documenta√ß√£o: <i>ResponseEntity</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.html" target="_blank"><b>Documenta√ß√£o: <i>HttpStatus</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="4%"/> <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html#findById-ID-" target="_blank"><b>Documenta√ß√£o: <i>.findById(Long id)</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="4%"/> <a href="https://docs.google.com/document/d/1IQwgepFjSVCsMWiLHCidJyAj3jF2xp5h/edit" target="_blank"><b>Documenta√ß√£o: <i>Optional</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="4%"/> <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html" target="_blank"><b>Documenta√ß√£o: <i>Express√µes Lambda</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="4%"/> <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Long.html" target="_blank"><b>Documenta√ß√£o: <i>Long</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="4%"/> <a href="https://www.w3schools.com/java/java_wrapper_Classes.asp" target="_blank"><b>Artigo: <i>Classes Wrappers (Long)</i></b></a></div>

<br />

<h2>üë£ Passo 02 - Testar no Insomnia</h2>



Agora vamos criar a Requisi√ß√£o para o **M√©todo getById()**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New HTTP Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/reMehb6.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8TEvnhM.png" title="source: imgur.com" /></div>

4. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Consultar postagem por ID** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (**http://localhost:8080**) √© o endere√ßo do nosso servidor local. Quando a API estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da aplica√ß√£o na nuvem.
- A segunda parte do endere√ßo √© o **endpoint** configurado na anota√ß√£o ***@RequestMapping***, em nosso caso  **/postagens**. 
- A terceira parte (**/1**) √© a vari√°vel de caminho (**@PathVariable**) **id**. Informe o id que voc√™ deseja procurar.

5. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

6. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/TbYy29Y.png" title="source: imgur.com" /></div>

7. Observe que a aplica√ß√£o quando encontra o Objeto no Banco de dados, al√©m de exibir os dados do Objeto no Corpo da Resposta, respeitando o crit√©rio informado na consulta (id 1), ela tamb√©m retorna um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

8. Caso o Objeto Postagem n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), marcado em laranja na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/5lCAhBv.png" title="source: imgur.com" /></div>

9. Caso o Projeto Spring n√£o esteja em Execu√ß√£o, o Insomnia retornar√° a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/Y2iNu9v.png" title="source: imgur.com" /></div>

10. Execute o seu Projeto e teste novamente!

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href=https://github.com/rafaelq80/backend_blogpessoal_spring/tree/05_Classe_PostagemController_getById" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
