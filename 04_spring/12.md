<h1>Projeto 02 - Blog Pessoal - Classe PostagemController - M√©todo Deletar</h1>

O que veremos por aqui:

1. Criar o m√©todo delete(Long id) para excluir uma Postagem no Banco de Dados

<h2>1. O Recurso Postagem</h2>

Nas etapas anteriores, constru√≠mos a Classe **PostagemController** e implementamos os m√©todos:

- **getAll()**  ü°™ Retorna todos os objetos da Classe Postagem.

- **getById(Long id)** ü°™ Retorna um objeto espec√≠fico da Classe Postagem persistidos no Banco de dados. A Postagem √© identificada pelo Atributo id.   

- **getByTitulo(String titulo)** ü°™ Retorna  todos os objetos da Classe Postagem persistidos no Banco de dados, cujo Atributo titulo contenha a String enviada no par√¢metro titulo do m√©todo.   

- **m√©todo post(Postagem postagem)** ü°™ Persiste (salva) um novo objeto da Classe Postagem no Banco de dados

- **m√©todo put(Postagem postagem)** ü°™ Atualiza um objeto da Classe Postagem persistido no Banco de dados.

<div align="center"><img src="https://i.imgur.com/aKmFiA1.png" title="source: imgur.com" width="50%"/></div>

Vamos finalizar a constru√ß√£o da Classe Controladora com o **m√©todo delete(Long id)**.

<br />

<h2>üë£ Passo 01 - Criar o m√©todo delete(Long id)</h2>

Vamos implementar o m√©todo **delete(Long id)** na Classe Postagem Controller. Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>DELETE FROM tb_postagens WHERE id = id;</code>.

<div align="left"><img src="https://i.imgur.com/lHEatPH.png" title="source: imgur.com" /></div>

**Linha 65:** A anota√ß√£o **@ResponseStatus** indica que o m√©todo **delete(Long id)**, ter√° um Status HTTP espec√≠fico quando a requisi√ß√£o for bem sucedida, ou seja, ser√° retornado o **HTTP Status NO_CONTENT ü°™ 204**, ao inv√©s do **HTTP Status OK ü°™ 200** como resposta padr√£o do m√©todo.

**Linha 66:** A anota√ß√£o **`@DeleteMapping("/{id}")`** √© utilizada para mapear todas as requisi√ß√µes **HTTP DELETE** direcionadas a um endpoint espec√≠fico do recurso **Postagem**. Ela indica que o m√©todo `delete(Long id)` ser√° respons√°vel por **responder √†s requisi√ß√µes de exclus√£o** enviadas para o endere√ßo **`http://localhost:8080/postagens/{id}`**.

Nesse contexto, **`{id}`** representa uma **vari√°vel de caminho** (*Path Variable*), que ser√° preenchida com o valor do **`id` da postagem a ser exclu√≠da**. O Spring captura esse valor e o repassa como argumento para o m√©todo `delete`.

**Linha 67:** O m√©todo `delete(@PathVariable Long id)` foi definido com o tipo **`void`** porque, ao excluir um objeto da classe `Postagem` no banco de dados, esse objeto **deixa de existir**, e, portanto, **n√£o h√° conte√∫do a ser retornado** na resposta.

A anota√ß√£o `@ResponseStatus(HttpStatus.NO_CONTENT)` informa que, ao concluir a exclus√£o com sucesso, a API deve responder com o **c√≥digo HTTP 204 ‚Äì No Content**, conforme a especifica√ß√£o REST. Esse status indica que a requisi√ß√£o foi processada corretamente, mas **n√£o h√° corpo de resposta** a ser enviado ao cliente.

**@PathVariable Long id:** Essa anota√ß√£o informa ao Spring que o valor enviado na **URL**, na posi√ß√£o correspondente √† vari√°vel de caminho `{id}`, deve ser **injetado no par√¢metro `id`** do m√©todo `delete(Long id)`. Em outras palavras, o valor passado na URL ser√° interpretado como o identificador da postagem que ser√° exclu√≠da.

<br />

**Exemplo:**

**http://localhost:8080/postagens/1**

No exemplo acima, o par√¢metro **Long id**, do m√©todo **delete( Long id )**, receber√° o valor **1** (Id que ser√° procurado na tabela tb_postagens)

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do m√©todo delete devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 68:** Cria-se um **objeto do tipo `Optional<Postagem>`** chamado `postagem`, que receber√° o resultado da execu√ß√£o do m√©todo `findById(id)`. Como esse m√©todo pode **n√£o encontrar um registro** correspondente ao `id` informado, ele retorna um `Optional` que pode estar **vazio**. Utilizar `Optional` evita o uso direto de `null`, reduzindo o risco de exce√ß√µes do tipo **`NullPointerException`**, e permitindo um tratamento mais seguro da aus√™ncia de dados.

**Linhas 70 e 71:**  Por meio de uma estrutura condicional `if`, verificamos se o objeto `Optional postagem` est√° vazio, ou seja, se a postagem **n√£o foi encontrada** no banco de dados. Caso esteja vazio, √© lan√ßada uma exce√ß√£o do tipo `ResponseStatusException`, com o **status HTTP 404 ‚Äì NOT FOUND**, informando que o recurso solicitado n√£o existe.

**Linha 73:** Se a postagem for encontrada, o m√©todo padr√£o da interface `JpaRepository` ‚Äî `deleteById(Long id)` ‚Äî ser√° executado, removendo o registro correspondente do banco de dados. Como o m√©todo foi anotado com `@ResponseStatus(HttpStatus.NO_CONTENT)`, ser√° retornado o **status HTTP 204 ‚Äì No Content**, indicando que a exclus√£o foi realizada com sucesso e que **n√£o h√° corpo de resposta** a ser enviado.

> O **m√©todo delete**, por padr√£o, deve ser **idempotente**, ou seja, chamadas repetidas com o mesmo `id` devem ter o mesmo efeito (apagar o recurso e retornar o HTTP Status 204 ou retornar HTTP Status 404 se ele n√£o existir).

Depois de Criar o m√©todo, observe que foram importados mais 3 pacotes, como mostra a imagem abaixo (indicados pelas Setas vermelhas):

<div align="left"><img src="https://i.imgur.com/SzboE1I.png" title="source: imgur.com" /></div>

Para concluir, n√£o esque√ßa de Salvar o c√≥digo (**File ü°™ Save All**) e verificar se o Projeto est√° em execu√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/DeleteMapping.html" target="_blank"><b>Documenta√ß√£o: <i>@DeleteMapping</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://www.baeldung.com/spring-pathvariable" target="_blank"><b>Documenta√ß√£o: <i>@PathVariable</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/ResponseEntity.html#created-java.net.URI-" target="_blank"><b>Documenta√ß√£o: <i>ResponseEntity</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.html#NO_CONTENT" target="_blank"><b>Documenta√ß√£o: <i>HttpStatus</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wDz2IzB.png" title="source: imgur.com" width="25px"/> <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html#deleteById-ID-" target="_blank"><b>Documenta√ß√£o: <i>.deleteById()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/wMe2uG1.png" title="source: imgur.com" width="3%"/> <a href="https://docs.google.com/document/d/1IQwgepFjSVCsMWiLHCidJyAj3jF2xp5h/edit" target="_blank"><b>Documenta√ß√£o: <i>Optional</i></b></a></div>

<br />

<h2>üë£ Passo 02 - Testar no Insomnia</h2>

Agora vamos criar a requisi√ß√£o para o **delete(Long id)**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/rZ0KTLu.png" title="source: imgur.com" /></div>

4. Selecione o m√©todo HTTP que ser√° utilizado (**DELETE**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/qvMhoEx.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/wi2QFdM.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da requisi√ß√£o. A requisi√ß√£o **Deletar Postagem** foi configurada da seguinte maneira:

   - A primeira parte do endere√ßo (**http://localhost:8080**) √© o endere√ßo do nosso servidor local. Quando a API estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da aplica√ß√£o na nuvem.
   - A segunda parte do endere√ßo √© o **endpoint** configurado na anota√ß√£o ***@RequestMapping***, em nosso caso  **/postagens/**. 
   - A terceira parte (**/3**) √© a var√°vel de caminho (**@PathVariable**) id. Informe o id da postagem que voc√™ deseja apagar.
   
7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/SspTgpZ.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o retorna apenas um **HTTP Status 204 ü°™ NO_CONTENT** (indicado em verde na imagem acima). Este Status indica que a requisi√ß√£o foi bem sucedida!, o objeto foi apagado e o seu conte√∫do n√£o existe mais. Observe no Corpo da Resposta que n√£o foi retornado nenhum objeto (indicado pela seta verde), porque ele foi apagado.

10. Caso o objeto n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), como mostra a figura abaixo (marcado em laranja).

<div align="center"><img src="https://i.imgur.com/HuQst2w.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_v3/tree/09_Classe_PostagemController_delete" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>


<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
